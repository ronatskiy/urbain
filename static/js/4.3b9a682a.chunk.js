(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{95:function(e,t,r){"use strict";r.r(t);var o=r(1),i=r(3),a=r(5),n=r(4),c=r(6),l=function(){function e(){Object(o.a)(this,e)}return Object(i.a)(e,[{key:"propagate",value:function(e,t,r){}}]),e}(),s=(r(37),r(9)),p=r(28),u=r(22),h=r(30),f=r(2),d=r(8),y=r(49),v=r(48),g=r(18),m=r(54),S=r(55);r.d(t,"default",function(){return b});var b=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(a.a)(this,Object(n.a)(t).call(this))).soiSafetyCoefficient=1.5,e.maxPatchError=.001,e}return Object(c.a)(t,e),Object(i.a)(t,[{key:"propagate",value:function(e,t){if(!e instanceof m.a)throw new Error("Patched conics propagation requires TrajectoryDynamic instance");e.clearAfterEpoch(t);var r=e.flightEvents.filter(function(e){return e instanceof S.a&&e.epoch>=t}),o=0,i=r.length>0&&r[0].epoch,a=e.getComponentByEpoch(t),n=Math.max(t,a.epoch),c=!1;a.maxEpoch=!1;do{i!==n&&(c=this._findNextTrajectory(a,n+1,i)),c?(e.addComponent(c.trajectory),a.addFlightEvent(new v.default(c.epoch,c.oldSoi,c.newSoi)),n=c.epoch,a.maxEpoch=n,(a=c.trajectory).addFlightEvent(new y.default(c.epoch,c.oldSoi,c.newSoi))):!1!==i&&(a.maxEpoch=i,a=this._createAfterBurnTrajectory(a,r[o].vector,i),e.addComponent(a),c=!0,i=void 0!==r[o+=1]&&r[o].epoch)}while(c)}},{key:"_findNextTrajectory",value:function(e,t,r){var o=d.a.starSystem.getObject(e.referenceFrame.originId),i=o.type!==g.a.TYPE_STAR&&this._findOwnSoiCrossing(o,e,t),a=this._findChildSoiCrossing(o,e,t,!1===r?t+e.period:r);if(!1===a&&!1===i)return!1;var n=!a||i&&i.epoch<a.epoch?i:a;return!(!1!==r&&n.epoch>r)&&{trajectory:this._createNextSoiTrajectory(e,n.newSoi,n.epoch),oldSoi:o,newSoi:n.newSoi,epoch:n.epoch}}},{key:"_findOwnSoiCrossing",value:function(e,t,r){var o=t.keplerianObject,i=o.getSphereCrossingTrueAnomaly(e.data.patchedConics.soiRadius);if(!i)return!1;for(var a=o.getEpochByTrueAnomaly(i[0]);a<r;)a+=o.period;return{epoch:a,newSoi:e.data.patchedConics.parentSoi}}},{key:"_findChildSoiCrossing",value:function(e,t,r,o){var i=this,a=t.keplerianObject,n=[];if(a.isHyperbolic&&r===o){var c=0,l=!0,s=!1,p=void 0;try{for(var u,h=e.data.patchedConics.childSois[Symbol.iterator]();!(l=(u=h.next()).done);l=!0){var d=u.value,y=d.trajectory.getKeplerianObjectByEpoch(r,t.referenceFrame).getApoapsisRadius()+d.data.patchedConics.soiRadius*this.soiSafetyCoefficient;y>c&&(c=y)}}catch(T){s=!0,p=T}finally{try{l||null==h.return||h.return()}finally{if(s)throw p}}if(0===c)return!1;var v=a.getSphereCrossingTrueAnomaly(c);o=a.getEpochByTrueAnomaly(v[0])}var g=!0,m=!1,S=void 0;try{for(var b,w=function(){var e=b.value,c=e.trajectory.getKeplerianObjectByEpoch(r,t.referenceFrame),l=e.data.patchedConics.soiRadius,s=i._getPotentialApproachIntervals(c,a,r,o,l*i.soiSafetyCoefficient);if(!1===s)return"continue";var p=i._getPotentialApproachIntervals(a,c,r,o,l*i.soiSafetyCoefficient),u=Object(f.i)(s,p);if(!1===u)return"continue";!0===u&&(u=[[r,o]]),u.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0});var h=!0,d=!1,y=void 0;try{for(var v,g=u[Symbol.iterator]();!(h=(v=g.next()).done);h=!0){var m=v.value;if(m[0]>o)break;if(!(m[1]<r)){m[0]<r&&(m[0]=r),m[1]>o&&(m[1]=o);for(var S=a.isElliptic&&c.isElliptic?Math.min(Math.min(a.period,c.period),m[1]-m[0])/10:(m[1]-m[0])/10,w=void 0,E=void 0,_=m[0],j=!1,C=!1,A=function(e){return e[0].position.sub_(e[1]._position).mag},k=function(e,t){return(e[0]._position.mag*e[0]._velocity.projectionOn(e[0]._position)+e[1]._position.mag*e[1]._velocity.projectionOn(e[1]._position)-e[1]._position.dot(e[0]._velocity)-e[0]._position.dot(e[1]._velocity))/t},O=function(r){return[t.getStateInOwnFrameByEpoch(r),e.getStateByEpoch(r,t.referenceFrame)]};_<m[1];){var x=O(_),B=A(x);if(B<l){w=_-S,E=_,C=!0;break}var P=k(x,B);if(!1!==j&&j<0&&P>0){w=_-S,E=_;var R=void 0,F=void 0,I=j,M=P;do{if((B=A(x=O(R=w+(E-w)*I/(I-M))))<l){E=R,C=!0;break}(F=k(x,B))>0?(E=R,M=F):(w=R,I=F)}while(Math.abs(F)>1e-6&&E-w>1);if(C)break}j=P,_+=S}if(C){if(w<m[0]){n.push({epoch:m[0],newSoi:e});break}var V=void 0,N=A(O(w))-l,H=A(O(E))-l;do{(V=A(O(_=w+(E-w)*N/(N-H)))-l)<0?(E=_,H=V):(w=_,N=V)}while(Math.abs(V)>i.maxPatchError);n.push({epoch:_,newSoi:e});break}}}}catch(T){d=!0,y=T}finally{try{h||null==g.return||g.return()}finally{if(d)throw y}}},E=e.data.patchedConics.childSois[Symbol.iterator]();!(g=(b=E.next()).done);g=!0)w()}catch(T){m=!0,S=T}finally{try{g||null==E.return||E.return()}finally{if(m)throw S}}if(!n.length)return!1;for(var _=n[0],j=0;j<n.length;j++){var C=n[j];C.epoch<_.epoch&&(_=C)}return _}},{key:"_getPotentialApproachIntervals",value:function(e,t,r,o,i){var a=this._getRadialTaBounds(e,t,i);if(!1===a)return!1;var n,c=this._getVerticalTaBounds(e,t,i);if(c)n=Object(f.h)(c,a);else{if(!0===a)return!0;n=a}if(!1===n)return!1;var l,s,p=t.period,u=t.isElliptic?Math.floor((r-t.epoch)/p)*p:0,h=0,d=[];do{var y=!0,v=!1,g=void 0;try{for(var m,S=n[Symbol.iterator]();!(y=(m=S.next()).done);y=!0){var b=m.value;if(l=t.getEpochByTrueAnomaly(b[0])+u,(s=t.getEpochByTrueAnomaly(b[1])+u)<l&&(l-=p),s>h&&(h=s),!(s<r)){if(d.length>1e4)throw new Error("Infinite loop detected");d.push([l,s])}}}catch(w){v=!0,g=w}finally{try{y||null==S.return||S.return()}finally{if(v)throw g}}u+=p}while(h<o&&t.isElliptic);return d}},{key:"_getVerticalTaBounds",value:function(e,t,r){var o=e.getNormalVector(),i=t.getNormalVector(),a=e.getPeriapsisVector(),n=o.cross(i),c=t.getPeriapsisVector(),l=o.angle(i),s=n.angle(a);a.cross(n).angle(o)>Math.PI/2&&(s=f.b-s);var p=n.angle(c);return n.cross(c).angle(i)>Math.PI/2&&(p=f.b-p),new u.a(t.ecc,t.sma,p,l,s,t.m0,t.epoch,t.mu,!1).getPlaneCrossingTrueAnomaly(r)}},{key:"_getRadialTaBounds",value:function(e,t,r){var o=e.getPeriapsisRadius()-r,i=e.getApoapsisRadius()+r,a=t.getSphereCrossingTrueAnomaly(o),n=t.getSphereCrossingTrueAnomaly(i);return e.isHyperbolic?t.isHyperbolic?!a||[[-1/0,a[1]-f.b],[a[0],1/0]]:a?[a]:t.getApoapsisRadius()>=o:t.isHyperbolic?!!n&&(a?[[n[1]-f.b,a[1]-f.b],[a[0],n[0]]]:[[n[1]-f.b,n[0]]]):a?n?[[a[0],n[0]],[n[1],a[1]]]:[a]:n?[[n[1],n[0]]]:t.getPeriapsisRadius()<i&&t.getApoapsisRadius()>o}},{key:"_createNextSoiTrajectory",value:function(e,t,r){var o=d.a.starSystem.getReferenceFrame(s.d.buildId(t.id,s.c.INERTIAL_ECLIPTIC)),i=o.stateVectorFromBaseReferenceFrameByEpoch(r,e.getStateByEpoch(r)),a=new p.a(o.id,u.a.createFromState(i,t.physicalModel.mu,r));return a.minEpoch=r,a.maxEpoch=!1,a.setVisualModel(new h.a(a,{color:e.visualModel.config.color,minEpoch:!1,maxEpoch:"copy"})),a}},{key:"_createAfterBurnTrajectory",value:function(e,t,r){var o=e.getStateInOwnFrameByEpoch(r);o._velocity.add_(f.a.twoAxis(o._velocity,null,o._position).rotate_(t));var i=new p.a(e.referenceFrame.id,u.a.createFromState(o,e.mu,r));return i.minEpoch=r,i.maxEpoch=!1,i.setVisualModel(new h.a(i,{color:e.visualModel.config.color,minEpoch:!1,maxEpoch:"copy"})),i}}]),t}(l)}}]);
//# sourceMappingURL=4.3b9a682a.chunk.js.map