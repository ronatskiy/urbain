(window.webpackJsonp=window.webpackJsonp||[]).push([[5],[,function(e,t,a){"use strict";a.d(t,"c",function(){return u}),a.d(t,"a",function(){return m}),a.d(t,"b",function(){return d}),a.d(t,"j",function(){return p}),a.d(t,"f",function(){return f}),a.d(t,"l",function(){return v}),a.d(t,"g",function(){return y}),a.d(t,"h",function(){return g}),a.d(t,"i",function(){return E}),a.d(t,"d",function(){return j}),a.d(t,"e",function(){return O}),a.d(t,"k",function(){return _});var n=a(2),i=a(3),s=a(7),r=a(4),o=a(6),c=a(19),l=a(59),h=a(5),u=function(e){function t(e){var a;if(Object(n.a)(this,t),a=Object(s.a)(this,Object(r.a)(t).call(this)),void 0===e&&(e=3),e instanceof Array)for(var i=0;i<e.length;++i)a[i]=e[i];else for(var o=0;o<e;++o)a[o]=0;return Object.setPrototypeOf(Object(c.a)(Object(c.a)(a)),t.prototype),a}return Object(o.a)(t,e),Object(i.a)(t,[{key:"copy",value:function(){return new t(this)}},{key:"set",value:function(e){var t=1===arguments.length?arguments[0]:arguments;null==t.length&&(t=[t]);for(var a=0;a<this.length;++a)this[a]=t[a];return this}},{key:"dot",value:function(e){for(var t=0,a=0;a<this.length;++a)t+=this[a]*e[a];return t}},{key:"cross",value:function(e){return new t([this[1]*e[2]-this[2]*e[1],this[2]*e[0]-this[0]*e[2],this[0]*e[1]-this[1]*e[0]])}},{key:"angle",value:function(e){var t=this.dot(e)/this.mag/e.mag;return t<=-1?Math.PI:t>=1?0:Math.acos(t)}},{key:"add_",value:function(e){for(var t=0;t<this.length;++t)this[t]+=e[t];return this}},{key:"sub_",value:function(e){for(var t=0;t<this.length;++t)this[t]-=e[t];return this}},{key:"mul_",value:function(e){for(var t=0;t<this.length;++t)this[t]*=e;return this}},{key:"div_",value:function(e){for(var t=0;t<this.length;++t)this[t]/=e;return this}},{key:"rotate_",value:function(e,t){return new m(e,t).rotate_(this)}},{key:"unit_",value:function(){return this.div_(this.mag)}},{key:"add",value:function(e){return this.copy().add_(e)}},{key:"sub",value:function(e){return this.copy().sub_(e)}},{key:"mul",value:function(e){return this.copy().mul_(e)}},{key:"div",value:function(e){return this.copy().div_(e)}},{key:"unit",value:function(){return this.copy().unit_()}},{key:"rotate",value:function(e,t){return this.copy().rotate_(e,t)}},{key:"rotateX",value:function(e){var a=Math.sin(e),n=Math.cos(e);return new t([this[0],this[1]*n-this[2]*a,this[1]*a+this[2]*n])}},{key:"rotateY",value:function(e){var a=Math.sin(e),n=Math.cos(e);return new t([this[0]*n+this[2]*a,this[1],-this[0]*a+this[2]*n])}},{key:"rotateZ",value:function(e){var a=Math.sin(e),n=Math.cos(e);return new t([this[0]*n-this[1]*a,this[0]*a+this[1]*n,this[2]])}},{key:"x",get:function(){return this[0]},set:function(e){this[0]=e}},{key:"y",get:function(){return this[1]},set:function(e){this[1]=e}},{key:"z",get:function(){return this[2]},set:function(e){this[2]=e}},{key:"quadrance",get:function(){for(var e=0,t=0;t<this.length;++t)e+=this[t]*this[t];return e}},{key:"mag",get:function(){return Math.sqrt(this.quadrance)}}]),t}(Object(l.a)(Array)),m=function(){function e(t,a){Object(n.a)(this,e),this.t=1,this.v=new u(3),t instanceof Array&&this.setAxisAngle(t||[1,0,0],a||0)}return Object(i.a)(e,[{key:"copy",value:function(){var t=new e;return t.t=this.t,t.v=this.v.copy(),t}},{key:"quadrance",value:function(){return this.t*this.t+this.v[0]*this.v[0]+this.v[1]*this.v[1]+this.v[2]*this.v[2]}},{key:"length",value:function(){return Math.sqrt(this.quadrance())}},{key:"invert_",value:function(){var e=this.quadrance();return this.t/=e,this.v.div_(-e),this}},{key:"invert",value:function(){return this.copy().invert_()}},{key:"normalize_",value:function(){var e=this.length();return this.t/=e,this.v.div_(e),this}},{key:"normalize",value:function(){return this.copy().normalize_()}},{key:"rotate_",value:function(e){var t=this.v.cross(e).mul_(2),a=this.v.cross(t);return e[0]+=this.t*t[0]+a[0],e[1]+=this.t*t[1]+a[1],e[2]+=this.t*t[2]+a[2],e}},{key:"rotate",value:function(e){return this.rotate_(e.copy())}},{key:"mul_",value:function(e){var t=this.t,a=this.v[0],n=this.v[1],i=this.v[2],s=e.t,r=e.v[0],o=e.v[1],c=e.v[2];return this.t=t*s-a*r-n*o-i*c,this.v[0]=t*r+a*s+n*c-i*o,this.v[1]=t*o-a*c+n*s+i*r,this.v[2]=t*c+a*o-n*r+i*s,this}},{key:"mul",value:function(e){return this.copy().mul_(e)}},{key:"setAxisAngle",value:function(e,t){return this.t=Math.cos(t/2),this.v.set(e),this.v.mul_(Math.sin(t/2)/this.v.mag),this}},{key:"setFromEuler",value:function(e,t,a,n){var i=Math.cos(e/2),s=Math.cos(t/2),r=Math.cos(a/2),o=Math.sin(e/2),c=Math.sin(t/2),l=Math.sin(a/2);return"XYZ"===(n=n||"ZYX")?(this.v.set([o*s*r+i*c*l,i*c*r-o*s*l,i*s*l+o*c*r]),this.t=i*s*r-o*c*l):"YXZ"===n?(this.v.set([o*s*r+i*c*l,i*c*r-o*s*l,i*s*l-o*c*r]),this.t=i*s*r+o*c*l):"ZXY"===n?(this.v.set([o*s*r-i*c*l,i*c*r+o*s*l,i*s*l+o*c*r]),this.t=i*s*r-o*c*l):"ZYX"===n?(this.v.set([o*s*r-i*c*l,i*c*r+o*s*l,i*s*l-o*c*r]),this.t=i*s*r+o*c*l):"YZX"===n?(this.v.set([o*s*r+i*c*l,i*c*r+o*s*l,i*s*l-o*c*r]),this.t=i*s*r-o*c*l):"XZY"===n?(this.v.set([o*s*r-i*c*l,i*c*r-o*s*l,i*s*l+o*c*r]),this.t=i*s*r+o*c*l):"ZXZ"===n&&(this.v.set([Math.cos((e-a)/2)*c,Math.sin((e-a)/2)*c,Math.sin((e+a)/2)*s]),this.t=Math.cos((e+a)/2)*s),this}},{key:"toThreejs",value:function(){return new h.w(this.v[0],this.v[1],this.v[2],this.t)}}],[{key:"copy",value:function(e){return e.copy()}},{key:"mul",value:function(e,t){return e.copy().mul_(t)}},{key:"transfer",value:function(t,a){var n=t.angle(a);return n?new e(t.cross(a),n):new e}},{key:"twoAxis",value:function(t,a,n){var i,s,r;return t&&a?(i=new u([0,0,1]),s=t.cross(a)):t&&n?(i=new u([0,1,0]),s=n.cross(t)):a&&n&&(i=new u([1,0,0]),s=a.cross(n)),r=e.transfer(i,s),t?e.transfer(r.rotate_(new u([1,0,0])),t).mul_(r):e.transfer(r.rotate_(new u([0,1,0])),a).mul_(r)}},{key:"slerp",value:function(e,t,a){if(0==a)return e.copy();if(1==a)return t.copy();var n=t.copy(),i=e.t*t.t+e.v[0]*t.v[0]+e.v[1]*t.v[1]+e.v[2]*t.v[2];if(i<0&&(n.t=-t.t,n.v[0]=-t.v[0],n.v[1]=-t.v[1],n.v[2]=-t.v[2],i=-i),i>=1)return e.copy();var s=Math.sqrt(1-i*i);if(s<.001)return n.t=(e.t+n.t)/2,n.v[0]=(e.v[0]+n.v[0])/2,n.v[1]=(e.v[1]+n.v[1])/2,n.v[2]=(e.v[2]+n.v[2])/2,n;var r=Math.atan2(s,i),o=Math.sin((1-a)*r)/s,c=Math.sin(a*r)/s;return n.t=e.t*o+n.t*c,n.v[0]=e.v[0]*o+n.v[0]*c,n.v[1]=e.v[1]*o+n.v[1]*c,n.v[2]=e.v[2]*o+n.v[2]*c,n}},{key:"invert",value:function(e){return e.invert()}}]),e}(),d=2*Math.PI;function p(e,t,a,n,i){var s,r=0,o=t;do{var c=e(o),l=e(o+a),h=(l-c)/a;if(null===c||null===l)return null;s=Math.abs(c),o-=c/h,r+=1}while(s>n&&r<i);return s>n?null:o}function f(e){return e/180*Math.PI}function v(e){return 180*e/Math.PI}function y(e,t){var a=Math.acos(t);return e>0?a:d-a}function b(e,t){return!(!e||!t)&&(e[0]<=t[0]&&t[1]<=e[1]?t:t[0]<=e[0]&&e[1]<=t[1]?e:e[0]<=t[0]&&t[0]<=e[1]?[t[0],e[1]]:e[0]<=t[1]&&t[1]<=e[1]&&[e[0],t[1]])}function g(e,t){var a=[];if(!1===e||!1===t)return!1;if(!0===e)return t;if(!0===t)return e;var n=!0,i=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var c=r.value,l=[c[0],c[1]>c[0]?c[1]:d],h=!(c[1]>c[0])&&[0,c[1]],u=!0,m=!1,p=void 0;try{for(var f,v=t[Symbol.iterator]();!(u=(f=v.next()).done);u=!0){var y=f.value,g=[y[0],y[1]>y[0]?y[1]:d],E=!(y[1]>y[0])&&[0,y[1]],j=void 0;(j=b(l,g))&&a.push(j),(j=b(l,E))&&a.push(j),(j=b(h,g))&&a.push(j),(j=b(h,E))&&a.push(j)}}catch(O){m=!0,p=O}finally{try{u||null==v.return||v.return()}finally{if(m)throw p}}}}catch(O){i=!0,s=O}finally{try{n||null==o.return||o.return()}finally{if(i)throw s}}return!!a.length&&a}function E(e,t){var a=[];if(!1===e||!1===t)return!1;if(!0===e)return t;if(!0===t)return e;var n=!0,i=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var c=r.value,l=c[0],h=c[1],u=!0,m=!1,d=void 0;try{for(var p,f=t[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var v=p.value,y=v[0],b=v[1];l<=y&&y<h?a.push([y,h<b?h:b]):l<b&&b<=h?a.push([l,b]):l<y&&b<h?a.push([y,b]):y<l&&h<b&&a.push([l,h])}}catch(g){m=!0,d=g}finally{try{u||null==f.return||f.return()}finally{if(m)throw d}}}}catch(g){i=!0,s=g}finally{try{n||null==o.return||o.return()}finally{if(i)throw s}}return!!a.length&&a}function j(e,t,a){var n=(t=(t%d+d)%d)-(e=(e%d+d)%d);return Math.abs(n)>Math.PI&&(n=n>0?n-d:n+d),(e+n*a+d)%d}function O(e,t,a){return e+(t-e)*a}function _(e){return Math.abs(e)>=1e9?(e/1e9).toFixed(3)+" G":Math.abs(e)>=1e6?(e/1e6).toFixed(3)+" M":Math.abs(e)>=1e3?(e/1e3).toFixed(3)+" K":Math.abs(e)<=1e-9?(e/1e-9).toFixed(3)+" n":Math.abs(e)<=1e-6?(e/1e-6).toFixed(3)+" \xb5":Math.abs(e)<=.001?(e/.001).toFixed(3)+" m":e.toPrecision(6)+" "}},,,,,,,function(e,t,a){"use strict";var n,i=a(2),s=a(3),r=a(5),o=a(15),c=a.n(o),l=function(){function e(t){Object(i.a)(this,e),this.domElement=t,this.listeners={},this.handlers={}}return Object(s.a)(e,[{key:"addListener",value:function(e,t,a){var n=this;this.handlers[e]||(this.listeners[e]=[],this.handlers[e]=function(t){return n.handleEvent(e,t)},this.domElement.addEventListener(e,this.handlers[e])),this.listeners[e].push({handler:t,priority:a})}},{key:"removeListener",value:function(e,t){for(var a=this.listeners[e],n=0;n<a.length;n++)if(a[n].handler===t){a.splice(n,1);break}0===a.length&&(this.domElement.removeEventListener(e,this.handlers[e]),delete this.handlers[e],delete this.listeners[e])}},{key:"handleEvent",value:function(e,t){var a=this.listeners[e];if(a){var n=a.reduce(function(e,t){return Math.max(e,t.priority)},a[0].priority),i=!0,s=!1,r=void 0;try{for(var o,c=a[Symbol.iterator]();!(i=(o=c.next()).done);i=!0){var l=o.value;l.priority===n&&l.handler(t)}}catch(h){s=!0,r=h}finally{try{i||null==c.return||c.return()}finally{if(s)throw r}}}}}]),e}(),h=a(1),u=a(10),m=a(9),d=function(){function e(t,a,n){var s=this;Object(i.a)(this,e),this.epoch=t,this.timeScale=a,this.isTimeRunning=n,this.mouseState={x:0,y:0,leftButton:!1,rightButton:!1},this.timeLineCanvasDomElement=document.getElementById("timeLineCanvas"),this.canvasContext=this.timeLineCanvasDomElement.getContext("2d"),this.canvasRect={},this.updateCanvasStyle(),this.initValues(),this.timeLineCanvasDomElement.addEventListener("mousedown",this.onMouseDown.bind(this)),window.addEventListener("mouseup",this.onMouseUp.bind(this)),window.addEventListener("mousemove",this.onMouseMove.bind(this)),this.timeLineCanvasDomElement.addEventListener("mousewheel",this.onMouseWheel.bind(this)),window.addEventListener("keypress",function(e){" "===e.key&&s.togglePause()}),window.addEventListener("resize",this.updateCanvasStyle.bind(this)),window.oncontextmenu=function(){return!1}}return Object(s.a)(e,[{key:"initValues",value:function(){this.scales={minute:60,fiveMinutes:300,tenMinutes:600,thirtyMinutes:1800,hour:3600,threeHours:10800,sixHours:21600,day:86400,week:604800,month:2592e3,threeMonths:7776e3,year:31557600,fiveYears:157788e3},this.span=86400*this.timeScale*5,this.markDistance=300,this.scaleType="month",this.leftEpoch=this.epoch-this.span/2,this.updateScaleType(),this.getDateByEpoch=e.getDateByEpoch,this.getEpochByDate=e.getEpochByDate,this.roundDateUp=e.roundDateUp,this.nextRenderingDate=e.nextRenderingDate,this.formatDate=e.formatDate,this.formatDateFull=e.formatDateFull}},{key:"setTimeScale",value:function(e){u.a.dispatch(u.a.TIME_SCALE_CHANGED,{old:this.timeScale,new:e}),this.timeScale=e}},{key:"togglePause",value:function(){this.isTimeRunning=!this.isTimeRunning,u.a.dispatch(this.isTimeRunning?u.a.TIME_UNPAUSED:u.a.TIME_PAUSED)}},{key:"tick",value:function(e){this.mouseState.leftButton?this.epoch=this.leftEpoch+(this.mouseState.x-this.canvasRect.left)*this.span/this.timeLineCanvasDomElement.width:this.isTimeRunning&&(this.leftEpoch<this.epoch&&this.epoch<this.leftEpoch+this.span&&(this.leftEpoch+=this.timeScale*e),this.epoch+=this.timeScale*e),u.a.dispatch(u.a.EPOCH_CHANGED,{epoch:this.epoch,date:this.getDateByEpoch(this.epoch)}),this.redraw()}},{key:"forceEpoch",value:function(e){this.leftEpoch+=e-this.epoch,this.epoch=e,this.tick(0)}},{key:"useCurrentTime",value:function(){this.forceEpoch(this.getEpochByDate(new Date))}},{key:"redraw",value:function(){this.canvasContext.fillStyle="#222",this.canvasContext.fillRect(0,0,this.timeLineCanvasDomElement.width,this.timeLineCanvasDomElement.height),this.canvasContext.fillStyle=this.isTimeRunning?"#2846ed":"#393b40",this.drawCurrentTimeMark(),this.canvasContext.strokeStyle="#fdfdfd",this.canvasContext.fillStyle="#fdfdfd",this.canvasContext.font="11px sans-serif";for(var e=this.roundDateUp(this.getDateByEpoch(this.leftEpoch),this.scaleType),t=this.getEpochByDate(e);t<this.leftEpoch+this.span;)this.drawMark(this.getCanvasPositionByEpoch(t),this.formatDate(e,this.scaleType)),e=this.nextRenderingDate(e,this.scaleType),t=this.getEpochByDate(e)}},{key:"getCanvasPositionByEpoch",value:function(e){return(e-this.leftEpoch)*this.timeLineCanvasDomElement.width/this.span}},{key:"updateCanvasStyle",value:function(){this.canvasRect=this.timeLineCanvasDomElement.getBoundingClientRect(),this.timeLineCanvasDomElement.width=this.canvasRect.right-this.canvasRect.left,this.timeLineCanvasDomElement.height=this.canvasRect.bottom-this.canvasRect.top}},{key:"updateScaleType",value:function(){var e=this.markDistance*this.span/this.timeLineCanvasDomElement.width,t=!1;for(var a in this.scales)t?Math.abs(this.scales[t]/e-1)>Math.abs(this.scales[a]/e-1)&&(t=a):t=a;this.scaleType=t}},{key:"drawMark",value:function(e,t){this.canvasContext.beginPath(),this.canvasContext.moveTo(e,0),this.canvasContext.lineTo(e,this.timeLineCanvasDomElement.height/2),this.canvasContext.stroke(),this.canvasContext.fillText(t,e-this.canvasContext.measureText(t).width/2,this.timeLineCanvasDomElement.height-2)}},{key:"drawCurrentTimeMark",value:function(){this.canvasContext.fillRect(0,0,this.getCanvasPositionByEpoch(this.epoch),this.timeLineCanvasDomElement.height)}},{key:"onMouseDown",value:function(e){return 0===e.button?this.mouseState.leftButton=!0:2===e.button&&(this.mouseState.rightButton=!0),!1}},{key:"onMouseUp",value:function(e){return 0===e.button?this.mouseState.leftButton=!1:2===e.button&&(this.mouseState.rightButton=!1),!1}},{key:"onMouseMove",value:function(e){return this.mouseState.rightButton&&(this.leftEpoch+=(this.mouseState.x-e.x)*this.span/this.timeLineCanvasDomElement.width),this.mouseState.x=e.x,this.mouseState.y=e.y,!1}},{key:"getMinScale",value:function(){var e=this;return Object.keys(this.scales).reduce(function(t,a){return e.scales[t]<e.scales[a]?t:a})}},{key:"getMaxScale",value:function(){var e=this;return Object.keys(this.scales).reduce(function(t,a){return e.scales[t]>e.scales[a]?t:a})}},{key:"onMouseWheel",value:function(e){var t=e.deltaY>0?1.3:1/1.3,a=Math.min(Math.max(this.span*t,(this.canvasRect.right-this.canvasRect.left)/this.markDistance*this.scales[this.getMinScale()]),(this.canvasRect.right-this.canvasRect.left)/this.markDistance*this.scales[this.getMaxScale()]);return this.leftEpoch+=(this.mouseState.x-this.canvasRect.left)*(this.span-a)/(this.canvasRect.right-this.canvasRect.left),this.span=a,this.updateScaleType(),!1}}],[{key:"getDateByEpoch",value:function(e){return new Date(1e3*(946728e3+e))}},{key:"getEpochByDate",value:function(e){return e/1e3-946728e3}},{key:"roundDateUp",value:function(e,t){var a=new Date(e);if("minute"===t)a.setSeconds(60,0);else if("fiveMinutes"===t)a.setMinutes(5+a.getMinutes()-a.getMinutes()%5,0,0);else if("tenMinutes"===t)a.setMinutes(10+a.getMinutes()-a.getMinutes()%10,0,0);else if("thirtyMinutes"===t)a.setMinutes(30+a.getMinutes()-a.getMinutes()%30,0,0);else if("hour"===t)a.setMinutes(60,0,0);else if("threeHours"===t)a.setHours(3+a.getHours()-a.getHours()%3,0,0,0);else if("sixHours"===t)a.setHours(6+a.getHours()-a.getHours()%6,0,0,0);else if("day"===t)a.setHours(24,0,0,0);else if("week"===t)a.setHours(0,0,0,0),a.setDate(7+a.getDate()-a.getDay());else if("month"===t)a.setHours(0,0,0,0),a.setDate(1),a.setMonth(a.getMonth()+1);else if("threeMonths"===t)a.setHours(0,0,0,0),a.setDate(1),a.setMonth(3+a.getMonth()-a.getMonth()%3);else if("year"===t)a.setHours(0,0,0,0),a.setMonth(0,1);else{if("fiveYears"!==t)return;a.setHours(0,0,0,0),a.setFullYear(5+a.getFullYear()-a.getFullYear()%5,0,1)}return a}},{key:"nextRenderingDate",value:function(e,t){var a=new Date(e);if("minute"===t)a.setMinutes(a.getMinutes()+1);else if("fiveMinutes"===t)a.setMinutes(a.getMinutes()+5);else if("tenMinutes"===t)a.setMinutes(a.getMinutes()+10);else if("thirtyMinutes"===t)a.setMinutes(a.getMinutes()+30);else if("hour"===t)a.setHours(a.getHours()+1);else if("threeHours"===t)a.setHours(a.getHours()+3);else if("sixHours"===t)a.setHours(a.getHours()+6);else if("day"===t)a.setDate(a.getDate()+1);else if("week"===t)a.setDate(a.getDate()+7);else if("month"===t)a.setMonth(a.getMonth()+1);else if("threeMonths"===t)a.setMonth(a.getMonth()+3);else if("year"===t)a.setFullYear(a.getFullYear()+1,a.getMonth(),a.getDate());else{if("fiveYears"!==t)return;a.setFullYear(a.getFullYear()+5,a.getMonth(),a.getDate())}return a}},{key:"formatDate",value:function(e,t){if("minute"===t||"fiveMinutes"===t||"tenMinutes"===t||"thirtyMinutes"===t||"hour"===t||"threeHours"===t||"sixHours"===t){var a=e.getYear()+1900;return a+="-"+(e.getMonth()+1+"").padStart(2,"0"),a+="-"+(e.getDate()+"").padStart(2,"0"),a+=" "+(e.getHours()+"").padStart(2,"0"),a+=":"+(e.getMinutes()+"").padStart(2,"0")}if("day"===t||"week"===t){var n=e.getYear()+1900;return n+="-"+(e.getMonth()+1+"").padStart(2,"0"),n+="-"+(e.getDate()+"").padStart(2,"0")}if("month"===t||"threeMonths"===t){return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()]+" "+(e.getYear()+1900)}return"year"===t||"fiveYears"===t?e.getYear()+1900+"":e.toString()}},{key:"formatDateFull",value:function(e){var t=e.getYear()+1900;return t+="-"+(e.getMonth()+1+"").padStart(2,"0"),t+="-"+(e.getDate()+"").padStart(2,"0"),t+=" "+(e.getHours()+"").padStart(2,"0"),t+=":"+(e.getMinutes()+"").padStart(2,"0"),t+=":"+(e.getSeconds()+"").padStart(2,"0")}}]),e}(),p=a(53),f=function(){function e(t,a,n){Object(i.a)(this,e),this.raycaster=new r.y,this.mouse=new r.E,this.camera=a,this.domElement=t,this.setPixelPrecision(n),this.updatePixelAngleSize(),this.domElement.addEventListener("mousemove",this.onMouseMove.bind(this)),this.domElement.addEventListener("resize",this.updatePixelAngleSize.bind(this))}return Object(s.a)(e,[{key:"onMouseMove",value:function(e){this.mouse.x=e.clientX/this.domElement.width*2-1,this.mouse.y=-e.clientY/this.domElement.height*2+1}},{key:"setPixelPrecision",value:function(e){this.raycaster.pixelPrecision=e}},{key:"updatePixelAngleSize",value:function(){this.raycaster.pixelAngleSize=Object(h.f)(this.camera.fov)/this.domElement.height}},{key:"getPixelAngleSize",value:function(){return this.raycaster.pixelAngleSize}},{key:"intersectObjects",value:function(e){return this.raycaster.setFromCamera(this.mouse,this.camera),this.raycaster.intersectObjects(e)}},{key:"getPixelDistance",value:function(e){this.raycaster.setFromCamera(this.mouse,this.camera);var t=(new r.F).subVectors(e,K.camera.lastPosition);return Math.acos(this.raycaster.ray.direction.dot(t)/t.length())/this.raycaster.pixelAngleSize}}]),e}(),v=a(7),y=a(4),b=a(6),g=a(19),E=a(18),j=a(20),O=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(v.a)(this,Object(y.a)(t).call(this))).selectableObjects=[],e.selectedObject=null,e.bestIntersection=null,e.selectionMouseButton=0,e.pointSize=5,e.setThreeObj(new r.n(new r.A(1,10,10),new r.o({color:16776960}))),j.c.addEventListener("click",e.onMouseClick.bind(Object(g.a)(Object(g.a)(e))),1),j.c.addEventListener("mousedown",e.onMouseDown.bind(Object(g.a)(Object(g.a)(e))),1),e.mouseMoveListener=e.onMouseMove.bind(Object(g.a)(Object(g.a)(e))),e}return Object(b.a)(t,e),Object(s.a)(t,[{key:"addSelectableObject",value:function(e){this.selectableObjects.push(e)}},{key:"removeSelectableObject",value:function(e){for(var t in this.selectableObjects)if(this.selectableObjects[t]===e){delete this.selectableObjects[t];break}this.selectableObjects=this.selectableObjects.filter(function(e){return e})}},{key:"render",value:function(){var e=j.c.raycaster.intersectObjects(this.selectableObjects);if(e.length>0){this.bestIntersection=e[0];for(var t=1;t<e.length;t++)e[t].distance<this.bestIntersection.distance&&(this.bestIntersection=e[t]);this.threeObj.visible=!0,this.threeObj.position.copy(this.bestIntersection.point);var a=this.pointSize*this.bestIntersection.point.length()*j.c.raycaster.getPixelAngleSize();this.threeObj.scale.x=a,this.threeObj.scale.y=a,this.threeObj.scale.z=a}else this.threeObj.visible=!1,this.bestIntersection=null}},{key:"onMouseDown",value:function(e){e.button===this.selectionMouseButton&&(document.addEventListener("mousemove",this.mouseMoveListener),this.hasMouseMoved=!1,this.mouseClickStart=[e.clientX,e.clientY])}},{key:"onMouseMove",value:function(e){this.mouseClickStart[0]===e.clientX&&this.mouseClickStart[1]===e.clientY||(this.hasMouseMoved=!0)}},{key:"onMouseClick",value:function(e){var t=this.selectedObject;if(e.button===this.selectionMouseButton&&(document.removeEventListener("mousemove",this.mouseMoveListener),!this.hasMouseMoved&&(this.deselect(),this.bestIntersection))){for(var a=this.bestIntersection.object.userData.trajectory;a.parent;)a=a.parent;a!==t&&this.select(a)}}},{key:"forceSelection",value:function(e){this.deselect(),this.select(e)}},{key:"getSelectedObject",value:function(){return this.selectedObject}},{key:"select",value:function(e){this.selectedObject=e,this.selectedObject.select(),j.a.dispatch(j.a.SELECT,{trajectory:this.selectedObject})}},{key:"deselect",value:function(){this.selectedObject&&(j.a.dispatch(j.a.DESELECT,{trajectory:this.selectedObject}),this.selectedObject.deselect(),this.selectedObject=null)}}]),t}(E.a),_=function(){function e(t,a){var n=this;Object(i.a)(this,e),this.jqDom=c()(t),this.name=this.jqDom.data("panelName"),this.jqCollapseButton=this.jqDom.find(".collapseButton[data-panel-name='"+this.name+"']"),this.jqCollapseButton.click(function(){return n.toggleCollapse()}),this.isCollapsed=!!a,this.isCollapsed?this.collapse():this.expand()}return Object(s.a)(e,[{key:"show",value:function(){this.jqDom.show()}},{key:"hide",value:function(){this.jqDom.hide()}},{key:"toggleCollapse",value:function(){this.isCollapsed?this.expand():this.collapse()}},{key:"collapse",value:function(){this.jqCollapseButton.html("Show"),this.isCollapsed=!0,this.jqDom.find(".panelContent[data-panel-name='"+this.name+"']").hide()}},{key:"expand",value:function(){this.jqCollapseButton.html("Hide"),this.isCollapsed=!1,this.jqDom.find(".panelContent[data-panel-name='"+this.name+"']").show()}}]),e}(),M=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(v.a)(this,Object(y.a)(t).call(this,e))).maxTimeScale=15552e3,a.jqSlider=a.jqDom.find("#timeScaleSlider"),a.jqSlider.on("input change",function(){return K.time.setTimeScale(a.getCurrentTimeScale())}),a.jqSlider.val(a.getNeededSliderValue(K.time.timeScale)),a.jqScaleText=a.jqDom.find("#timeScaleValue"),a.jqScaleText.html(a.formatTimeScale(K.time.timeScale)),document.addEventListener(u.a.TIME_SCALE_CHANGED,function(e){a.jqSlider.val(a.getNeededSliderValue(e.detail.new)),a.jqScaleText.html(a.formatTimeScale(e.detail.new))}),a.jqDateText=a.jqDom.find("#currentDateValue"),document.addEventListener(u.a.EPOCH_CHANGED,function(e){return a.updateTime(e.detail.date)}),a.jqDom.find("#setRealTimeScale").click(function(){return K.time.setTimeScale(1)}),a.jqDom.find("#useCurrentTime").click(function(){return K.time.useCurrentTime()}),a}return Object(b.a)(t,e),Object(s.a)(t,[{key:"updateTime",value:function(e){this.jqDateText.html(K.time.formatDateFull(e))}},{key:"getCurrentTimeScale",value:function(){var e=this.jqSlider.val();return Math.sign(e)*e*e*e*e*this.maxTimeScale}},{key:"getNeededSliderValue",value:function(e){var t=Math.sqrt(Math.sqrt(Math.abs(e)/this.maxTimeScale));return Math.sign(e)*Math.min(1,t)}},{key:"formatTimeScale",value:function(e){var t=e<0?"-":"",a=Math.abs(e);return 0===a?"0":a<60?t+a.toPrecision(2)+" s/s":a<3600?t+(a/60).toPrecision(2)+" min/s":a<86400?t+(a/3600).toPrecision(2)+" h/s":a<2592e3?t+(a/86400).toPrecision(2)+" days/s":a<31557600?t+(a/2592e3).toPrecision(2)+" months/s":t+(a/31557600).toPrecision(2)+" years/s"}}]),t}(_),k=a(32),w=function(e){function t(e,a){var n;return Object(i.a)(this,t),(n=Object(v.a)(this,Object(y.a)(t).call(this,e))).camera=a,n.jqTarget=n.jqDom.find("#targetSelect"),n.jqTarget.on("change",function(){return n.camera.changeOrigin(0|n.jqTarget.val())}),n.jqFrameType=n.jqDom.find("#rfTypeSelect"),n.jqFrameType.on("change",function(){return n.camera.changeReferenceFrameType(0|n.jqFrameType.val())}),u.a.addListener(u.a.STAR_SYSTEM_LOADED,function(e){n.starSystem=e.detail.starSystem,n.jqTarget.html(""),n.updateTargetList(),n.updateTarget(n.camera.orbitingPoint),n.updateFrameTypeList(),n.updateFrameType(n.camera.frameType)}),u.a.addListener(u.a.CAMERA_RF_CHANGED,function(e){n.updateTarget(e.detail.new.originId),n.updateFrameTypeList(),n.updateFrameType(e.detail.new.type)}),u.a.addListener(u.a.OBJECT_ADDED,function(){n.updateTargetList()}),n}return Object(b.a)(t,e),Object(s.a)(t,[{key:"updateTargetList",value:function(){var e=this;this.starSystem&&c.a.each(this.starSystem.getObjectNames(),function(t,a){0===e.jqTarget.find("option[value='"+t+"']").length&&e.jqTarget.append(c()("<option>",{value:t}).text(a))})}},{key:"updateFrameTypeList",value:function(){var e=this,a=0|this.jqFrameType.val();this.jqFrameType.html(""),c.a.each(this.camera.getAvailableFrameTypes(),function(n,i){e.jqFrameType.append(c()("<option>",{value:i,selected:i==a}).text(t.frameTypeNames[i]))})}},{key:"updateTarget",value:function(e){this.jqTarget.val(e)}},{key:"updateFrameType",value:function(e){this.jqFrameType.val(e)}}]),t}(_);w.frameTypeNames=(n={},Object(k.a)(n,m.c.INERTIAL_ECLIPTIC,"Ecliptic"),Object(k.a)(n,m.c.INERTIAL_BODY_EQUATORIAL,"Equatorial"),Object(k.a)(n,m.c.INERTIAL_BODY_FIXED,"Body fixed"),Object(k.a)(n,m.c.INERTIAL_PARENT_BODY_EQUATORIAL,"Parent equatorial"),n);var S=a(30),T=function(e){function t(e,a){var n;return Object(i.a)(this,t),(n=Object(v.a)(this,Object(y.a)(t).call(this,e,!0))).vectorOfEpoch=a,n.jqMag=n.jqDom.find(".vec-magnitude"),n.jqX=n.jqDom.find(".vec-x"),n.jqY=n.jqDom.find(".vec-y"),n.jqZ=n.jqDom.find(".vec-z"),n}return Object(b.a)(t,e),Object(s.a)(t,[{key:"set",value:function(e,t){this.vectorOfEpoch=e,this.update(t)}},{key:"update",value:function(e){var t=this.vectorOfEpoch;(e||0===e)&&t instanceof S.a&&(t=t.evaluate(e)),!t instanceof h.c||(this.jqMag.html(Object(h.k)(t.mag)),this.jqX.html(Object(h.k)(t.x)),this.jqY.html(Object(h.k)(t.y)),this.jqZ.html(Object(h.k)(t.z)))}}]),t}(_),A=a(16),P=function(e){function t(e,a){var n;return Object(i.a)(this,t),(n=Object(v.a)(this,Object(y.a)(t).call(this,e))).selection=a,n.precision=5,n.renderListener=n.render.bind(Object(g.a)(Object(g.a)(n))),document.addEventListener(u.a.SELECT,n.handleSelect.bind(Object(g.a)(Object(g.a)(n)))),document.addEventListener(u.a.DESELECT,n.handleDeselect.bind(Object(g.a)(Object(g.a)(n)))),n.jqDom.find("#unloadObject").on("click",function(){var e=a.getSelectedObject().object;a.deselect(),K.starSystem.deleteObject(e.id)}),n.jqDom.find("#showAnglesOfSelectedOrbit").on("change",function(){K.settings.ui.showAnglesOfSelectedOrbit=this.checked,u.a.dispatch(u.a.SHOW_ORBIT_ANGLES_CHANGED,{value:this.checked})}),n.positionPanel=new T(n.jqDom.find(".js-metrics-panel-cartesian-position-vector"),null),n.velocityPanel=new T(n.jqDom.find(".js-metrics-panel-cartesian-velocity-vector"),null),n.hide(),n}return Object(b.a)(t,e),Object(s.a)(t,[{key:"render",value:function(e){var t=this.selection.getSelectedObject(),a=null;if(t)try{var n=t.getReferenceFrameByEpoch(e.detail.epoch);n&&(a=K.starSystem.getObject(n.originId),this.jqDom.find("#relativeTo").html(a.name)),this.updateMain(t,e.detail.epoch,a),this.updateCartesian(t,e.detail.epoch),this.updateKeplerian(t,e.detail.epoch)}catch(i){}}},{key:"updateMain",value:function(e,t,a){var n=e.getKeplerianObjectByEpoch(t),i=n.sma,s=i*(1-n.e),r=i*(1+n.e),o=a.physicalModel?a.physicalModel.radius:0,c=e.getStateInOwnFrameByEpoch(t);this.jqDom.find("#elements-orbit-alt").html((s-o).toPrecision(this.precision)+" x "+(r-o).toPrecision(this.precision)),this.jqDom.find("#elements-orbit-avg").html(""+(i-o).toPrecision(this.precision)),this.jqDom.find("#elements-alt").html(""+(c.position.mag-o).toPrecision(this.precision)),this.jqDom.find("#elements-speed").html(""+(1e3*c.velocity.mag).toPrecision(this.precision)),a.physicalModel&&a.physicalModel.j2&&a.physicalModel.j2&&this.jqDom.find("#elements-precession").html(""+Object(h.l)(86400*n.getNodalPrecessionRate(a.physicalModel.eqRadius,a.physicalModel.j2)).toPrecision(this.precision))}},{key:"updateCartesian",value:function(e,t){var a=e.getStateInOwnFrameByEpoch(t);this.positionPanel.set(a.position),this.velocityPanel.set(a.velocity)}},{key:"updateKeplerian",value:function(e,t){var a=e.getKeplerianObjectByEpoch(t);this.jqDom.find("#elements-ecc").html(""+a.e.toPrecision(this.precision)),this.jqDom.find("#elements-sma").html(""+Object(h.k)(a.sma)),this.jqDom.find("#elements-inc").html(""+Object(h.l)(a.inc).toPrecision(this.precision)),this.jqDom.find("#elements-aop").html(""+Object(h.l)(a.aop).toPrecision(this.precision)),this.jqDom.find("#elements-raan").html(""+Object(h.l)(a.raan).toPrecision(this.precision)),this.jqDom.find("#elements-ta").html(""+Object(h.l)(a.getTrueAnomalyByEpoch(t)).toPrecision(this.precision)),this.jqDom.find("#elements-period").html(""+(a.period/86400).toPrecision(this.precision))}},{key:"handleSelect",value:function(){this.show();var e=this.selection.getSelectedObject().object;e?c()("#metricsOf").html(e.name):c()("#relativeTo,#metricsOf").html(""),e.type===A.a.TYPE_SPACECRAFT||e.type===A.a.TYPE_UNKNOWN?this.jqDom.find("#unloadObject").show():this.jqDom.find("#unloadObject").hide(),document.addEventListener(u.a.RENDER,this.renderListener)}},{key:"handleDeselect",value:function(){this.hide(),document.removeEventListener(u.a.RENDER,this.renderListener)}}]),t}(_),N=a(12),B=a(22),C=a(23),D=a(17),x=a(34),I=a(25),L=function(){function e(){Object(i.a)(this,e)}return Object(s.a)(e,null,[{key:"getPlotData",value:function(e,t,a,n,i,s,r){for(var o=(n-a)/(r-1),c=(s-i)/(r-1),l=[],h=a,u=0;h<=n;){var m=i,d=0;for(l[u]=[];m<=s;){var p=this.calcDeltaV(e.getStateByEpoch(h),t.getStateByEpoch(h+m),h,m,e.mu);l[u][d]=p,m+=c,d++}h+=o,u++}return l}},{key:"plot",value:function(e){var t=1e99,a=0,n=document.getElementById("lambertCanvas").getContext("2d");n.clearRect(0,0,300,300);var i=!0,s=!1,r=void 0;try{for(var o,c=e[Symbol.iterator]();!(i=(o=c.next()).done);i=!0){var l=o.value,h=!0,u=!1,m=void 0;try{for(var d,p=l[Symbol.iterator]();!(h=(d=p.next()).done);h=!0){var f=d.value;!1!==f&&(f<t&&(t=f),f>a&&(a=f))}}catch(E){u=!0,m=E}finally{try{h||null==p.return||p.return()}finally{if(u)throw m}}}}catch(E){s=!0,r=E}finally{try{i||null==c.return||c.return()}finally{if(s)throw r}}for(var v in e)for(var y in e[v]){var b=e[v][y];if(!1===b)n.fillStyle="rgba(255,0,0,1)";else{var g=Math.round(255*(1-(b-t)/(a-t)));n.fillStyle="rgba("+g+","+g+","+g+", 1)"}n.fillRect(0|v,0|y,1,1)}}},{key:"getDeltaV",value:function(e,t,a,n,i){return e.velocity.sub_(a.getStateByEpoch(n)._velocity).mag+t.velocity.sub_(a.getStateByEpoch(i)._velocity).mag}},{key:"calcDeltaV",value:function(e,t,a,n,i){var s=this.solve(e,t,a,n,i);return!!s&&this.getDeltaV(e,t,s,a,a+n)}},{key:"findBestTransfer",value:function(e,t,a,n,i,s,r){for(var o,c=this,l=1e-6*(r-s),u=(r-s)/49,m=1e100,d=s;d<=r;d+=u){var p=this.solveFullTransfer(e,t,a,n,i,d);if(null!==p){var f=p.totalDeltaV;f<m&&(o=d,m=f)}}return null===(o=Object(h.j)(function(o){if(o<s)return null;if(o>r)return null;var h=c.solveFullTransfer(e,t,a,n,i,o-l/2),u=c.solveFullTransfer(e,t,a,n,i,o+l/2);return null===h||null===u?null:(u.totalDeltaV-h.totalDeltaV)/l},o,.001*u,1e-6,10))?{totalDeltaV:null}:this.solveFullTransfer(e,t,a,n,i,o)}},{key:"solveFullTransfer",value:function(e,t,a,n,i,s){if(s<=0)return null;var r=K.starSystem.getCommonParentObject(e.id,t.id,i,i+s);if(!(r instanceof C.a))return null;var o,c,l,u,d,p,f=m.d.buildId(r.id,r.type===A.a.TYPE_STAR?m.c.INERTIAL_ECLIPTIC:m.c.INERTIAL_BODY_EQUATORIAL),v=K.starSystem.getReferenceFrame(f),y=r.physicalModel.mu,b=e instanceof C.a,g=t instanceof C.a;b&&(l=K.starSystem.getReferenceFrame(m.d.buildId(e.id,m.c.INERTIAL_BODY_EQUATORIAL)),d=e.data.patchedConics.soiRadius),g&&(p=t.data.patchedConics.soiRadius,u=K.starSystem.getReferenceFrame(m.d.buildId(t.id,m.c.INERTIAL_BODY_EQUATORIAL)));for(var E,j,O,_,M,k=0,w=0,S=new h.c(3),T=new h.c(3),P=0;;){if(_=i+k,M=i+s-w,o=e.trajectory.getStateByEpoch(_,v),b&&(o._position=l.transformPositionByEpoch(_,S,v)),c=t.trajectory.getStateByEpoch(M,v),g&&(c._position=u.transformPositionByEpoch(M,T,v)),null===(O=this.solve(o,c,_,M-_,y)))return null;P++;var N=[new h.c(3),0],L=[new h.c(3),0];if(b){E=O.getStateByEpoch(_)._velocity.sub_(o._velocity);var R=o._position.cross(E);k=(N=this.getSoiEdgePositionAndTime(v.rotateVectorByEpoch(_,E,l),v.rotateVectorByEpoch(_,R,l),a,d,e.physicalModel.mu,1))[1]}if(g){j=O.getStateByEpoch(M)._velocity.sub_(c._velocity);var F=c._position.cross(j);w=(L=this.getSoiEdgePositionAndTime(v.rotateVectorByEpoch(M,j,u),v.rotateVectorByEpoch(M,F,u),n,p,t.physicalModel.mu,-1))[1]}if(P>10||(!b||S.sub(N[0]).mag<10)&&(!g||T.sub(L[0]).mag<10)){S=N[0],T=L[0];break}S=N[0],T=L[0]}var q=0,V=0,Y=new x.a,U=new I.a(f,O);if(U.minEpoch=i+k,U.maxEpoch=i+s-w,Y.addComponent(U),b){var z=B.a.createFromState(new D.a(S,v.rotateVectorByEpoch(_,E,l)),e.physicalModel.mu,i+k);q=z.getPeriapsisSpeed()-Math.sqrt(e.physicalModel.mu/z.getPeriapsisRadius());var H=new I.a(l.id,z);H.minEpoch=i,H.maxEpoch=i+k,Y.addComponent(H)}else q=o.velocity.sub(O.getStateByEpoch(i)._velocity).mag;if(g){var Q=B.a.createFromState(new D.a(T,v.rotateVectorByEpoch(M,j,u)),t.physicalModel.mu,i+s-w);V=Q.getPeriapsisSpeed()-Math.sqrt(t.physicalModel.mu/Q.getPeriapsisRadius());var G=new I.a(u.id,Q);G.minEpoch=i+s-w,G.maxEpoch=i+s,Y.addComponent(G)}else V=c.velocity.sub(O.getStateByEpoch(i+s)._velocity).mag;return{trajectory:Y,ejectionDeltaV:q,insertionDeltaV:V,totalDeltaV:q+V}}},{key:"getSoiEdgePositionAndTime",value:function(e,t,a,n,i,s){var r=1/(2/n-e.quadrance/i),o=1-a/r,c=s*Math.acos((r*(1-o*o)/n-1)/o),l=Math.atan(o*Math.sin(c)/(r*(1-o*o)/n)),u=new h.a(t,l-Math.PI/2).rotate_(e.unit().mul_(n)),m=this.getEccentricAnomalyByTrueAnomaly(c,o),d=o>1?(o*Math.sinh(m)-m)/Math.sqrt(i/r/r/Math.abs(r)):(m-o*Math.sin(m))/Math.sqrt(i/r/r/r);return[u,Math.abs(d)]}},{key:"solve",value:function(e,t,a,n,i){var s=this,r=e.position,o=t.position,c=r.cross(o),l=r.mag,u=o.mag,m=r.angle(o);c.angle(e._position.cross(e._velocity))>Math.PI/2&&(m=2*Math.PI-m,c.mul_(-1));var d,p,f,v=Math.sign(Math.sin(m)),y=c.angle(new h.c([0,0,1])),b=new h.c([0,0,1]).cross(c),g=b.angle(new h.c([1,0,0]));new h.c([1,0,0]).cross(b).angle(new h.c([0,0,1]))>Math.PI/2&&(g=2*Math.PI-g);var E=Math.sqrt(l*l+u*u-2*r.dot(o))/2,j=(Math.pow(l+u+2*E,1.5)-v*Math.pow(l+u-2*E,1.5))/(6*Math.sqrt(i));if(n>j){var O=(u-l)/2,_=E/O,M=Math.sqrt(E*E-O*O),k=Object(h.j)(function(e){return s.getTimeByY(e,O,M,_,l,u,E,m,i)-n},1e4,1,1,30);if(null===k)return null;var w=-(u+l)/2/_,S=M*Math.sqrt(w*w/O/O-1),T=O*Math.sqrt(1+k*k/M/M),A=Math.sqrt((w-T)*(w-T)+(S-k)*(S-k)),P=(w-T)/A,N=(S-k)/A;f=Object(h.g)(v*((w+E)*N-S*P)/l,-((w+E)*P+S*N)/l),d=A/2/(p=_*(T-w)/2)}else{if(null===(p=Object(h.j)(function(e){var t=Math.acosh(1+(l+u+2*E)/2/Math.abs(e)),a=Math.acosh(1+(l+u-2*E)/2/Math.abs(e));return Math.sqrt(Math.abs(Math.pow(e,3))/i)*(Math.sinh(t)-t-v*(Math.sinh(a)-a))-n},l,10,1,30)))return null;p>0&&(p=-p);var C=r.rotate(b,-y).mul_(-1),D=o.rotate(b,-y).add_(C),x=l-2*p,I=u-2*p,L=-Math.sign(D.y)*D.angle(new h.c([1,0,0]));C=C.rotateZ(L);var R=((D=D.rotateZ(L)).x*D.x-I*I+x*x)/2/D.x,F=Math.sqrt(x*x-R*R);(m>Math.PI?C.y<0:C.y>0)&&(F=-F);var q=p*(1-(d=-C.sub_(new h.c([R,F,0])).mag/2/p)*d);f=Math.acos((q/l-1)/d);var V=Math.acos((q/u-1)/d);(f>V||V-m<0)&&(f=-f)}var Y=new h.a(c,-f).rotate(r),U=b.angle(Y);return b.cross(Y).angle(c)>Math.PI/2&&(U=2*Math.PI-U),new B.a(d,p,U,y,g,f,a,i,!0)}},{key:"getTimeByY",value:function(e,t,a,n,i,s,r,o,c){var l=(s+i)/2,u=-l/n,m=a*Math.sqrt(u*u/t/t-1),d=t*Math.sqrt(1+e*e/a/a),p=(l+n*d)/2,f=Math.sqrt((u-d)*(u-d)+(m-e)*(m-e)),v=f/2/p,y=(u-d)/f,b=(m-e)/f,g=-((u+r)*y+m*b)/i,E=Math.sign(Math.sin(o))*((u+r)*b-m*y)/i,j=Object(h.g)(E,g),O=Math.sqrt(c/p/p/p),_=this.getEccentricAnomalyByTrueAnomaly(j,v),M=this.getEccentricAnomalyByTrueAnomaly(j+o,v);return j+o>2*Math.PI&&(M+=2*Math.PI),(M-_-v*(Math.sin(M)-Math.sin(_)))/O}},{key:"getEccentricAnomalyByTrueAnomaly",value:function(e,t){if(t<1){var a=Math.cos(e);return Object(h.g)(Math.sqrt(1-t*t)*Math.sin(e)/(1+t*a),(t+a)/(1+t*a))}return 2*Math.atanh(Math.tan(e/2)/Math.sqrt((t+1)/(t-1)))}}]),e}(),R=a(29),F=function(e){function t(e,a){var n;return Object(i.a)(this,t),n=Object(v.a)(this,Object(y.a)(t).call(this)),void 0===a&&(a=m.a),n.referenceFrame=K.starSystem.getReferenceFrame(a),n.quaternion=h.a.transfer(new h.c([0,1,0]),e),n.setThreeObj(new r.b((new r.F).fromArray([1,0,0]),new r.F,e.mag)),n}return Object(b.a)(t,e),Object(s.a)(t,[{key:"render",value:function(e){this.threeObj.quaternion.copy(this.quaternion.mul(this.referenceFrame.getQuaternionByEpoch(e)).toThreejs()),this.threeObj.position.copy(K.getVisualCoords(this.referenceFrame.getOriginPositionByEpoch(e)))}}]),t}(E.a),q=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(v.a)(this,Object(y.a)(t).call(this,e,!0))).maxTransferTime=1262304e3,a.jqSlider=a.jqDom.find("#transferTimeSlider"),a.jqSlider.on("input change",function(){return a.changeTransferTime(a.getCurrentTransferTime())}),a.transferTime=a.getCurrentTransferTime(),a.jqTransferTimeText=a.jqDom.find("#transferTimeValue"),a.jqTransferTimeText.html(a.formatTransferTime(a.transferTime)),a.jqDateText=a.jqDom.find("#departureDateValue"),a.jqDom.find("#useCurrentTime").click(function(){return a.useCurrentTime()}),a.jqOrigin=a.jqDom.find("#originSelect"),a.jqOrigin.on("change",function(){return a.changeOrigin(0|a.jqOrigin.val())}),a.jqTarget=a.jqDom.find("#targetSelect"),a.jqTarget.on("change",function(){return a.changeTarget(0|a.jqTarget.val())}),a.useCurrentTime(),a.origin=399,a.jqOrigin.val(a.origin),u.a.addListener(u.a.STAR_SYSTEM_LOADED,function(){a.jqOrigin.html(""),a.jqTarget.html(""),a.updateTargetList(),a.updateOriginList()}),a}return Object(b.a)(t,e),Object(s.a)(t,[{key:"solve",value:function(){if(this.origin&&this.target){var e=K.starSystem.getCommonParentObject(this.origin,this.target,this.departureTime,this.departureTime+this.transferTime),t=m.d.buildId(e.id,m.c.INERTIAL_ECLIPTIC),a=K.starSystem.getObject(this.origin),n=K.starSystem.getObject(this.target),i=a.trajectory.getStateByEpoch(this.departureTime,t),s=n.trajectory.getStateByEpoch(this.departureTime+this.transferTime,t),r=L.solveFullTransfer(a,n,a.physicalModel?a.physicalModel.radius+200:0,n.physicalModel?n.physicalModel.radius+200:0,this.departureTime,this.transferTime);if(r){var o=r.trajectory;o.setObject(new A.a(-1,A.a.TYPE_UNKNOWN,a.name+"->"+n.name+" transfer")),this.visualModel&&(this.visualModel.drop(),this.visualModel2&&this.visualModel2.drop(),this.visualModel3&&this.visualModel3.drop(),this.vector1.drop(),this.vector2.drop()),this.visualModel=new R.a(o.components[0],"yellow"),o.components[1]&&(this.visualModel2=new R.a(o.components[1],"red")),o.components[2]&&(this.visualModel3=new R.a(o.components[2],"red")),this.vector1=new F(i.position,t),this.vector2=new F(s.position,t),this.jqDom.find("#deltaVEjection").html(r.ejectionDeltaV.toPrecision(4)),this.jqDom.find("#deltaVInsertion").html(r.insertionDeltaV.toPrecision(4)),this.jqDom.find("#deltaVTotal").html((r.ejectionDeltaV+r.insertionDeltaV).toPrecision(4))}}}},{key:"collapse",value:function(){this.visualModel&&(this.visualModel.drop(),this.visualModel2.drop(),this.visualModel3.drop(),this.vector1.drop(),this.vector2.drop(),this.visualModel=null),Object(N.a)(Object(y.a)(t.prototype),"collapse",this).call(this)}},{key:"useCurrentTime",value:function(){this.departureTime=K.currentEpoch,this.updateTime(K.currentDate),this.solve()}},{key:"changeOrigin",value:function(e){this.origin=e,this.solve()}},{key:"changeTarget",value:function(e){this.target=e,this.solve()}},{key:"changeTransferTime",value:function(e){this.transferTime=e,this.jqTransferTimeText.html(this.formatTransferTime(this.transferTime)),this.solve()}},{key:"getCurrentTransferTime",value:function(){var e=this.jqSlider.val();return e*e*e*e*this.maxTransferTime}},{key:"getNeededSliderValue",value:function(e){var t=Math.sqrt(Math.sqrt(e/this.maxTransferTime));return Math.max(0,Math.min(1,t))}},{key:"updateOriginList",value:function(){var e=this;c.a.each(K.starSystem.getObjectNames(),function(t,a){0===e.jqOrigin.find("option[value='"+t+"']").length&&e.jqOrigin.append(c()("<option>",{value:t}).text(a))})}},{key:"updateTargetList",value:function(){var e=this;c.a.each(K.starSystem.getObjectNames(),function(t,a){0===e.jqTarget.find("option[value='"+t+"']").length&&e.jqTarget.append(c()("<option>",{value:t}).text(a))})}},{key:"updateTime",value:function(e){this.jqDateText.html(K.time.formatDateFull(e))}},{key:"formatTransferTime",value:function(e){var t=e<0?"-":"",a=Math.abs(e);return 0===a?"0":a<60?t+a.toPrecision(3)+" s":a<3600?t+(a/60).toPrecision(3)+" min":a<86400?t+(a/3600).toPrecision(3)+" h":a<2592e3?t+(a/86400).toPrecision(3)+" days":a<31557600?t+(a/2592e3).toPrecision(3)+" months":t+(a/31557600).toPrecision(3)+" years"}}]),t}(_),V=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(v.a)(this,Object(y.a)(t).call(this,e))).jqPause=a.jqDom.find("#createOrbit"),a.jqPause.click(function(){var e=K.camera.orbitingPoint,t=K.starSystem.getObject(e);if(t.physicalModel){var a=2*t.physicalModel.radius,n=-11e6-K.starSystem.created;K.starSystem.created+=1;var i=new A.a(n,A.a.TYPE_UNKNOWN,"Created #"+K.starSystem.created),s=new I.a(m.d.buildId(e,m.c.INERTIAL_BODY_EQUATORIAL),new B.a(.2,a,Math.PI/6,Math.PI/3,Math.PI/6,0,K.currentEpoch,t.physicalModel.mu));s.setVisualModel(new R.a(s,{color:"yellow"})),s.minEpoch=!1,s.maxEpoch=!1,s.isEditable=!0;var r=new x.a,o=K.getPropagator("patchedConics");r.addComponent(s),r.isEditable=!0,r.propagator=new o,s.setUpdateCallback(function(){r.propagator.propagate(r,s.keplerianObject.epoch,{epoch:s.keplerianObject.epoch+s.keplerianObject.period})}),i.setTrajectory(r),K.starSystem.addObject(n,i),K.selection.forceSelection(i.trajectory),r.propagator.propagate(r,s.keplerianObject.epoch,{epoch:s.keplerianObject.epoch+s.keplerianObject.period})}}),a}return Object(b.a)(t,e),t}(_),Y=function e(){Object(i.a)(this,e),this.timePanel=new M(c()("#timePanel")),this.cameraPanel=new w(c()("#cameraPanel"),K.camera),this.metricsPanel=new P(c()("#metricsPanel"),K.selection),this.creationPanel=new V(c()("#creationPanel")),this.lambertPanel=new q(c()("#lambertPanel"))},U=function(){function e(t){Object(i.a)(this,e),this.id=t,this.name=null,this.stars=null,this.mainObject=null,this.referenceFrames={},this.objects={},this.created=0}return Object(s.a)(e,[{key:"unload",value:function(){Object.entries(this.objects).map(function(e){return e[1].drop()}),this.stars&&this.stars.drop()}},{key:"addStars",value:function(e){return this.stars=e,this}},{key:"addReferenceFrame",value:function(e){this.referenceFrames[e.id]=e}},{key:"getReferenceFrame",value:function(e){return void 0===this.referenceFrames[e]&&(this.referenceFrames[e]=m.d.createById(e)),this.referenceFrames[e]}},{key:"addObject",value:function(e,t){this.objects[e]=t,u.a.dispatch(u.a.OBJECT_ADDED,{object:t})}},{key:"getObject",value:function(e){return void 0===this.objects[e]?null:this.objects[e]}},{key:"deleteObject",value:function(e){this.objects[e].drop(),delete this.objects[e]}},{key:"getCommonParentObject",value:function(e,t,a,n){void 0===n&&(n=a);for(var i,s=[e];i=this.getObject(s[s.length-1]).getParentObjectIdByEpoch(a);)s.push(i);for(s.push(0),i=t;null!==(i=this.getObject(i).getParentObjectIdByEpoch(n));)if(-1!==s.indexOf(i))return this.getObject(i);return null}},{key:"isBody",value:function(e){return void 0===this.objects[e]?null:this.objects[e]instanceof C.a}},{key:"getObjectNames",value:function(){for(var e={},t=Object.values(this.objects),a=0;a<t.length;a++){var n=t[a];e[n.id]=n.name}return e}},{key:"getBodies",value:function(){for(var e=[],t=Object.values(this.objects),a=0;a<t.length;a++){var n=t[a];n instanceof C.a&&e.push(n)}return e}}]),e}(),z=function(){function e(t){Object(i.a)(this,e),this.settings={fov:60,animationDuration:200,pixelsToObjectUnderMouse:20},this.domElement=t,this.threeCamera=new r.r(this.settings.fov,t.width/t.height,1,1e15),this.threeCamera.position.fromArray([0,0,0]),this.listenersAdded=!1}return Object(s.a)(e,[{key:"init",value:function(e,t){this.position=t,this.referenceFrame=K.starSystem.getReferenceFrame(e),this.orbitingPoint=this.referenceFrame.originId,this.frameType=this.referenceFrame.type,this.quaternion=this._getQuaternionByPosition(this.position),this.lastPosition=this.referenceFrame.transformPositionByEpoch(K.currentEpoch,this.position,m.a),this.currentMousePos=new h.c([0,0]),this.accountedMousePos=new h.c([0,0]),this.isMouseDown=!1,this.isShiftDown=!1,this.rightButtonDown=!1,this.isLookingAside=!1,this.zoomingAside=0,this.isAnimnating=!1,this.listenersAdded||(K.addEventListener("mousedown",this.onMouseDown.bind(this),1),K.addEventListener("mousemove",this.onMouseMove.bind(this),1),K.addEventListener("mouseup",this.onMouseUp.bind(this),1),K.addEventListener("wheel",this.onMouseWheel.bind(this),1),this.listenersAdded=!0)}},{key:"_getQuaternionByPosition",value:function(e,t){var a=new h.c([0,0,1]),n=new h.c([0,1,0]),i=(new h.a).setAxisAngle(a.cross(e),Math.acos(e.dot(a)/e.mag)),s=i.rotate(n),r=(new h.a).setAxisAngle(e.cross(t||new h.c([0,0,1])),Math.PI/2).rotate(e);return(new h.a).setAxisAngle(s.cross(r),Math.acos(s.dot(r)/r.mag)).mul_(i)}},{key:"getAvailableFrameTypes",value:function(e){if(void 0===e&&(e=this.orbitingPoint),0==e)return[m.c.INERTIAL_ECLIPTIC];var t=K.starSystem.isBody(e);return null===t?[]:t?[m.c.INERTIAL_ECLIPTIC,m.c.INERTIAL_BODY_EQUATORIAL,m.c.INERTIAL_BODY_FIXED]:[m.c.INERTIAL_ECLIPTIC,m.c.INERTIAL_PARENT_BODY_EQUATORIAL]}},{key:"changeReferenceFrameType",value:function(e){this.changeReferenceFrame(m.d.buildId(this.orbitingPoint,e),!0)}},{key:"changeOrigin",value:function(e){var t=-1!==this.getAvailableFrameTypes(e).indexOf(this.frameType)?this.frameType:m.c.INERTIAL_ECLIPTIC;this.changeReferenceFrame(m.d.buildId(e,t),!0)}},{key:"changeReferenceFrame",value:function(e,t){var a=K.starSystem.getReferenceFrame(e);this.position=this.referenceFrame.transformPositionByEpoch(K.currentEpoch,this.position,a),this.isLookingAside=!1,this.zoomingAside=0,this.orbitingPoint=a.originId,this.frameType=a.type,t?this.startAnimation(a):this.quaternion=this._getQuaternionByPosition(this.position),u.a.dispatch(u.a.CAMERA_RF_CHANGED,{old:this.referenceFrame,new:a}),this.referenceFrame=a}},{key:"startAnimation",value:function(e){if(e){var t=this.referenceFrame.getQuaternionByEpoch(K.currentEpoch).invert_().mul_(e.getQuaternionByEpoch(K.currentEpoch));this.quaternion=t.invert_().mul_(this.quaternion)}this.animationStartingTime=(new Date).getTime(),this.animationDuration=this.settings.animationDuration,this.animationStartingQuaternion=this.quaternion.copy(),this.isAnimnating=!0}},{key:"animate",value:function(){var e=((new Date).getTime()-this.animationStartingTime)/this.animationDuration,t=this._getQuaternionByPosition(this.position);if(e>=1)return this.quaternion=t,this.isAnimnating=!1,void(this.isLookingAside=!1);this.quaternion=h.a.slerp(this.animationStartingQuaternion,t,e)}},{key:"findObjectUnderMouse",value:function(){var e=0,t=!1,a=!0,n=!1,i=void 0;try{for(var s,r=K.starSystem.getBodies()[Symbol.iterator]();!(a=(s=r.next()).done);a=!0){var o=s.value;if(K.raycaster.getPixelDistance(o.getPositionByEpoch(K.currentEpoch,m.a))<this.settings.pixelsToObjectUnderMouse){!1===t&&(t=o.id);var c=o.physicalModel.radius;c&&c>e&&(e=c,t=o.id)}}}catch(l){n=!0,i=l}finally{try{a||null==r.return||r.return()}finally{if(n)throw i}}return t}},{key:"onMouseWheel",value:function(e){if(e.deltaY){var t=e.shiftKey?1+(K.settings.ui.camera.zoomFactor-1)/10:K.settings.ui.camera.zoomFactor,a=e.deltaY<0?1/t:t,n=this.findObjectUnderMouse(),i=this.orbitingPoint;if(n===this.orbitingPoint&&(n=!1),!1!==n?(this.position=this.referenceFrame.transformPositionByEpoch(K.currentEpoch,this.position,1e5*n+1e3),i=n):this.zoomingAside=0,K.starSystem.getObject(i).physicalModel&&K.starSystem.getObject(i).physicalModel.radius){var s=this.position.mag;this.position.mul_((K.starSystem.getObject(i).physicalModel.radius+(s-K.starSystem.getObject(i).physicalModel.radius)*a)/s)}else this.position.mul_(a);!1!==n?(this.position=K.starSystem.getReferenceFrame(1e5*n+1e3).transformPositionByEpoch(K.currentEpoch,this.position,this.referenceFrame),this.isLookingAside=!0,this.zoomingAside++):this.isLookingAside&&this.startAnimation(),3===this.zoomingAside&&this.changeOrigin(n,!0)}}},{key:"onMouseDown",value:function(e){switch(this.accountedMousePos=new h.c([e.clientX,e.clientY]),this.currentMousePos=this.accountedMousePos.copy(),this.isMouseDown=!0,e.button){case 0:case 1:break;case 2:this.rightButtonDown=!0}}},{key:"onMouseMove",value:function(e){this.isMouseDown&&(this.isShiftDown=!!e.shiftKey,this.currentMousePos.set(e.clientX,e.clientY))}},{key:"onMouseUp",value:function(e){this.isMouseDown=!1,this.rightButtonDown=!1}},{key:"onResize",value:function(){this.threeCamera.aspect=this.domElement.width/this.domElement.height,this.threeCamera.updateProjectionMatrix()}},{key:"getTopDirection",value:function(e){return this.referenceFrame.getQuaternionByEpoch(e).mul_(this.quaternion).rotate_(new h.c([0,1,0]))}},{key:"update",value:function(e){var t=this.referenceFrame.getQuaternionByEpoch(e),a=this.currentMousePos.sub(this.accountedMousePos);if(this.isAnimnating&&this.animate(),a[0]||a[1]){var n=(this.isShiftDown?.1:1)*K.settings.ui.camera.mouseSensitivity,i=new h.c([0,0,1]),s=this.position.angle(i),r=this.rightButtonDown?this.quaternion.rotate(new h.c([0,0,1])).cross(i):this.position.cross(i),o=new h.a(r,Math.min(Math.max(a[1]*n,s-Math.PI+1e-5),s-1e-5)),c=new h.a(i,-a[0]*n).mul_(o);this.rightButtonDown||c.rotate_(this.position),this.quaternion=c.mul_(this.quaternion),this.accountedMousePos=this.currentMousePos.copy()}this.threeCamera.quaternion.copy(t.mul_(this.quaternion).toThreejs()),this.lastPosition=this.referenceFrame.transformPositionByEpoch(e,this.position,m.a)}}]),e}(),H=function(){function e(t,a,n,s){Object(i.a)(this,e),this.idx=t,this.alias=a,this.label=n,this.moduleName=s}return Object(s.a)(e,[{key:"load",value:function(){var e=this;K.isModuleLoaded(this.moduleName)?K.getModule(this.moduleName).loadStarSystem(this.alias):K.loadModule(this.moduleName,function(t){return t.loadStarSystem(e.alias)})}},{key:"value",get:function(){return this.alias}}]),e}(),Q=function(){function e(){Object(i.a)(this,e),this._starSystems=[],this._loadedIdx=null,this.add("solar_system","SolarSystem","Solar System"),this.add("ksp","KSP","KSP System")}return Object(s.a)(e,[{key:"add",value:function(e,t,a){var n=this._starSystems.length;this._starSystems.push(new H(n,e,a,t))}},{key:"loadDefault",value:function(){this.loadByIdx(this.defaultStarSystemIdx)}},{key:"loadByIdx",value:function(e){if(e!==this._loadedIdx){var t=this._findStarSystemByIdx(e);t&&(t.load(),this._loadedIdx=e)}}},{key:"getCurrentStarSystem",value:function(){if(null!==this._loadedIdx)return this._starSystems[this._loadedIdx]}},{key:"_findStarSystemByIdx",value:function(e){return this._starSystems[e]}},{key:"starSystems",get:function(){return this._starSystems}},{key:"defaultStarSystemIdx",get:function(){return 0}},{key:"defaultStarSystem",get:function(){return this._starSystems[this.defaultStarSystemIdx]}}]),e}();a.d(t,"a",function(){return K});var K=new(function(){function e(){Object(i.a)(this,e),this.modules={},this.propagators={},this.renderLoopActive=!1,this.starSystemManager=new Q,this._initSettings()}return Object(s.a)(e,[{key:"init",value:function(e,t){this.renderLoopFunction=t,this.scene=new r.z,this.scene.add(new r.a(16773077,.15)),this.textureLoader=new r.D,this.renderer=new r.H({antialias:!0,logarithmicDepthBuffer:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.domElement=e,this.domElement.appendChild(this.renderer.domElement),window.addEventListener("resize",this.onWindowResize.bind(this)),this.rendererEvents=new l(this.renderer.domElement),this.selection=new O,this.time=new d(0,1,!0),this.camera=new z(this.renderer.domElement),this.raycaster=new f(this.renderer.domElement,this.camera.threeCamera,7),this.ui=new Y,this.starSystemManager.loadDefault(),u.a.dispatch(u.a.INIT_DONE)}},{key:"loadStarSystem",value:function(e,t){var a=this;c.a.getJSON("./star_systems/"+e,function(e){a.starSystem&&a.starSystem.unload(),a.starSystem=new U(e.id),p.a.loadFromConfig(a.starSystem,e),a.camera.init(m.d.buildId(a.starSystem.mainObject,m.c.INERTIAL_BODY_EQUATORIAL),new h.c([3e4,3e4,2e4])),t&&t(a.starSystem),u.a.dispatch(u.a.STAR_SYSTEM_LOADED,{starSystem:a.starSystem}),a.startRendering()})}},{key:"startRendering",value:function(){this.renderLoopActive=!0,requestAnimationFrame(this.renderLoopFunction)}},{key:"stopRendering",value:function(){this.renderLoopActive=!1}},{key:"forceEpoch",value:function(e){return this.time.forceEpoch(e)}},{key:"_initSettings",value:function(){this.settings={ui:{showBodyLabels:!0,showAnglesOfSelectedOrbit:!0,camera:{mouseSensitivity:.007,zoomFactor:1.5}}}}},{key:"addEventListener",value:function(e,t,a){this.rendererEvents.addListener(e,t,a)}},{key:"removeEventListener",value:function(e,t){this.rendererEvents.removeListener(e,t)}},{key:"onWindowResize",value:function(){this.renderer.setSize(window.innerWidth,window.innerHeight),this.camera.onResize()}},{key:"tick",value:function(e){this.time.tick(e),this.camera.update(this.time.epoch),u.a.dispatch(u.a.RENDER,{epoch:this.time.epoch}),this.renderLoopActive&&this.renderer.render(this.scene,this.camera.threeCamera)}},{key:"getVisualCoords",value:function(e){return(new r.F).fromArray(e.sub(this.camera.lastPosition))}},{key:"getSimCoords",value:function(e){return new h.c(e.toArray()).add_(this.camera.lastPosition)}},{key:"loadModule",value:function(e,t){var n=this,i="Module"+e;a(72)("./"+e+"/"+i).then(function(a){n.modules[e]=new a.default,n.modules[e].init(),t&&t(n.modules[e])})}},{key:"getModule",value:function(e){if(void 0===this.modules[e])throw new Error("Unknown module: "+e);return this.modules[e]}},{key:"isModuleLoaded",value:function(e){return void 0!==this.modules[e]}},{key:"getClass",value:function(e){var t=e.indexOf(".");if(-1===t)throw new Error("Incorrect class alias! Period expected in "+e);return this.getModule(e.substr(0,t)).getClass(e.substr(t+1))}},{key:"addPropagator",value:function(e,t){this.propagators[e]=t}},{key:"getPropagator",value:function(e){return this.propagators[e]}},{key:"currentEpoch",get:function(){return this.time.epoch}},{key:"currentDate",get:function(){return this.time.getDateByEpoch(this.time.epoch)}}]),e}())},function(e,t,a){"use strict";var n=a(2),i=a(3),s=a(7),r=a(4),o=a(6),c=a(30),l=a(8),h=function(e){function t(e,a){var i;return Object(n.a)(this,t),(i=Object(s.a)(this,Object(r.a)(t).call(this))).objectId=e,i.referenceFrame=a,i}return Object(o.a)(t,e),Object(i.a)(t,[{key:"evaluate",value:function(e){return l.a.starSystem.getObject(this.objectId).trajectory.getStateByEpoch(e,this.referenceFrame)}}]),t}(c.a),u=a(1),m=a(21),d=a(27),p=a(17),f=function(e){function t(e,a){var i;return Object(n.a)(this,t),(i=Object(s.a)(this,Object(r.a)(t).call(this))).origin=e,i.isInertial=a,i.body=l.a.starSystem.getObject(i.origin),i}return Object(o.a)(t,e),Object(i.a)(t,[{key:"getQuaternionByEpoch",value:function(e){return this.body.orientation.getQuaternionByEpoch(e)}},{key:"getOriginStateByEpoch",value:function(e){return l.a.starSystem.getObject(this.origin).trajectory.getStateByEpoch(e,O)}},{key:"getOriginPositionByEpoch",value:function(e){return this.getOriginStateByEpoch(e).position}},{key:"getRotationVelocityByEpoch",value:function(e){return new u.c([0,0,this.body.orientation.angularVel])}},{key:"stateVectorFromBaseReferenceFrameByEpoch",value:function(e,t){var a=this.getOriginStateByEpoch(e),n=this.getQuaternionByEpoch(e).invert_(),i=n.rotate(t.position.sub_(a.position)),s=n.rotate(t.velocity.sub_(a.velocity));if(!this.isInertial){var r=i.cross(this.getRotationVelocityByEpoch(e));s.add_(r)}return new p.a(i,s)}},{key:"stateVectorToBaseReferenceFrameByEpoch",value:function(e,t){var a,n=this.getOriginStateByEpoch(e),i=this.getQuaternionByEpoch(e),s=i.rotate(t.position).add_(n.position);if(this.isInertial)a=i.rotate(t.velocity).add_(n.velocity);else{var r=t.position.cross(this.getRotationVelocityByEpoch(e));a=i.rotate(t.velocity.sub_(r)).add_(n.velocity)}return new p.a(s,a)}}]),t}(d.a),v=function(e){function t(){var e;return Object(n.a)(this,t),(e=Object(s.a)(this,Object(r.a)(t).call(this))).setId(O),e}return Object(o.a)(t,e),t}(d.a),y=a(40),b=a(37),g=a(23),E=function(e){function t(e,a,i,o,c){var l;return Object(n.a)(this,t),(l=Object(s.a)(this,Object(r.a)(t).call(this,e,c))).bodyFixedQuaternion=(new u.a).setFromEuler(0,-a,i,"ZYX"),l.bodyFixedPosition=new u.c([l.body.physicalModel.radius+o,0,0]).rotateY(-a).rotateZ(i),l}return Object(o.a)(t,e),Object(i.a)(t,[{key:"getQuaternionByEpoch",value:function(e){return this.body.orientation.getQuaternionByEpoch(e).mul_(this.bodyFixedQuaternion)}},{key:"getRotationVelocityByEpoch",value:function(e){return this.bodyFixedQuaternion.invert().rotate(new u.c([0,0,this.body.orientation.angularVel]))}},{key:"getOriginStateByEpoch",value:function(e){var t=l.a.starSystem.getObject(this.origin).trajectory.getStateByEpoch(e,O),a=this.body.orientation.getQuaternionByEpoch(e),n=this.bodyFixedPosition.cross(new u.c([0,0,this.body.orientation.angularVel])),i=a.rotate(this.bodyFixedPosition).add_(t.position),s=a.rotate_(n.mul_(-1)).add_(t.velocity);return new p.a(i,s)}}]),t}(f);a.d(t,"d",function(){return j}),a.d(t,"a",function(){return O}),a.d(t,"b",function(){return _}),a.d(t,"c",function(){return M});var j=function(){function e(){Object(n.a)(this,e)}return Object(i.a)(e,null,[{key:"create",value:function(e,t,a){var n=null;return t==M.INERTIAL_ECLIPTIC?n=new y.a(new h(a.origin,O),new u.a):t==M.INERTIAL_BODY_EQUATORIAL?n=l.a.starSystem.getObject(a.origin)instanceof g.a?new b.a(new h(a.origin,O),new m.a(function(e){var t=l.a.starSystem.getObject(a.origin).orientation.getQuaternionByEpoch(e).rotate_(new u.c([0,0,1])),n=t.cross(new u.c([0,0,1]));return 0===n.mag?new u.a:u.a.transfer(new u.c([0,0,1]),t).mul_(u.a.transfer(new u.c([1,0,0]),n))})):null:t==M.INERTIAL_PARENT_BODY_EQUATORIAL?n=new b.a(new h(a.origin,O),new m.a(function(e){var t=l.a.starSystem.getObject(a.origin).getParentObjectIdByEpoch(e),n=l.a.starSystem.getObject(t);if(n instanceof g.a){var i=n.orientation.getQuaternionByEpoch(e).rotate_(new u.c([0,0,1])),s=i.cross(new u.c([0,0,1]));return u.a.transfer(new u.c([0,0,1]),i).mul_(u.a.transfer(new u.c([1,0,0]),s))}return new u.a})):t==M.INERTIAL_BODY_FIXED?n=l.a.starSystem.getObject(a.origin)instanceof g.a?new f(a.origin,!0):null:t==M.INERTIAL_TOPOCENTRIC?n=l.a.starSystem.getObject(a.origin)instanceof g.a?new E(a.origin,a.lat,a.lon,a.height,!0):null:t==M.BODY_FIXED?n=l.a.starSystem.getObject(a.origin)instanceof g.a?new f(a.origin,!1):null:t==M.TOPOCENTRIC?n=l.a.starSystem.getObject(a.origin)instanceof g.a?new E(a.origin,a.lat,a.lon,void 0,!1):null:t==M.BASE&&(n=new v),n?n.setId(e):null}},{key:"getOriginIdByReferenceFrameId",value:function(e){return Math.sign(e)*Math.floor(Math.abs(e)/1e5)}},{key:"getTypeByReferenceFrameId",value:function(e){return Math.floor(Math.abs(e)%1e5/1e3)}},{key:"createById",value:function(e){var t=this.getTypeByReferenceFrameId(e);return t===M.INERTIAL_ECLIPTIC||t===M.INERTIAL_BODY_EQUATORIAL||t===M.INERTIAL_BODY_FIXED||t===M.BODY_FIXED||t===M.INERTIAL_PARENT_BODY_EQUATORIAL?this.create(e,t,{origin:this.getOriginIdByReferenceFrameId(e)}):null}},{key:"buildId",value:function(e,t){return t===M.INERTIAL_ECLIPTIC||t===M.INERTIAL_BODY_EQUATORIAL||t===M.INERTIAL_BODY_FIXED||t===M.BODY_FIXED||t===M.INERTIAL_PARENT_BODY_EQUATORIAL?(e?Math.sign(e):1)*(1e5*Math.abs(e)+1e3*t):null}}]),e}(),O=1e3,_=new v,M={BASE:0,INERTIAL_ECLIPTIC:1,INERTIAL_BODY_EQUATORIAL:2,INERTIAL_BODY_FIXED:3,INERTIAL_TOPOCENTRIC:4,BODY_FIXED:6,TOPOCENTRIC:7,INERTIAL_PARENT_BODY_EQUATORIAL:8}},function(e,t,a){"use strict";a.d(t,"a",function(){return s});var n=a(2),i=a(3),s=function(){function e(){Object(n.a)(this,e)}return Object(i.a)(e,null,[{key:"dispatch",value:function(e,t){var a;a=t?new CustomEvent(e,{detail:t}):new CustomEvent(e),document.dispatchEvent(a)}},{key:"addListener",value:function(e,t){return document.addEventListener(e,t)}},{key:"removeListener",value:function(e,t){return document.removeEventListener(e,t)}}]),e}();s.LOADING_BODIES_DONE="urb_load_bodies_done",s.LOADING_FRAMES_DONE="urb_load_frames_done",s.LOADING_TRAJECTORIES_DONE="urb_load_traj_done",s.RENDER="urb_render",s.INIT_DONE="urb_init_done",s.STAR_SYSTEM_LOADED="urb_star_system_loading_done",s.SELECT="urb_select",s.DESELECT="urb_deselect",s.SHOW_ORBIT_ANGLES_CHANGED="urb_show_orbit_angles_change",s.CAMERA_RF_CHANGED="urb_camera_rf_change",s.OBJECT_ADDED="urb_object_added",s.TIME_SCALE_CHANGED="urb_time_scale_change",s.TIME_PAUSED="urb_time_paused",s.TIME_UNPAUSED="urb_time_unpaused",s.EPOCH_CHANGED="urb_epoch_change"},,,,,,function(e,t,a){"use strict";a.d(t,"a",function(){return r});var n=a(2),i=a(3),s=a(9),r=function(){function e(t,a,i,s){Object(n.a)(this,e),this.id=t,this.type=a,this.name=i,this.data=s||{}}return Object(i.a)(e,[{key:"setTrajectory",value:function(e){this.trajectory=e,this.trajectory.setObject(this)}},{key:"getParentObjectIdByEpoch",value:function(e){if(!this.trajectory)return null;var t=this.trajectory.getReferenceFrameByEpoch(e);return t?t.originId:null}},{key:"getPositionByEpoch",value:function(e,t){return this.trajectory.getPositionByEpoch(e,t||s.a)}},{key:"drop",value:function(){this.trajectory&&(this.trajectory.drop(),delete this.trajectory)}}]),e}();r.TYPE_UNKNOWN=0,r.TYPE_STAR=1,r.TYPE_PLANET=2,r.TYPE_PLANETOID=3,r.TYPE_SATELLITE=4,r.TYPE_ASTEROID=5,r.TYPE_COMET=6,r.TYPE_SPACECRAFT=7,r.TYPE_POINT=8},function(e,t,a){"use strict";a.d(t,"a",function(){return r});var n=a(2),i=a(3),s=a(1),r=function(){function e(t,a){Object(n.a)(this,e),this._position=t?t.copy():new s.c,this._velocity=a?a.copy():new s.c}return Object(i.a)(e,[{key:"copy",value:function(){return new e(this._position,this._velocity)}},{key:"rotate_",value:function(e){return e.rotate_(this._position),e.rotate_(this._velocity),this}},{key:"rotate",value:function(e){return this.copy().rotate_(e)}},{key:"position",get:function(){return this._position.copy()}},{key:"velocity",get:function(){return this._velocity.copy()}}],[{key:"create",value:function(e,t,a,n,i,r){return new this(new s.c([e||0,t||0,a||0]),new s.c([n||0,i||0,r||0]))}}]),e}()},function(e,t,a){"use strict";a.d(t,"a",function(){return o});var n=a(2),i=a(3),s=a(10),r=a(8),o=function(){function e(){Object(n.a)(this,e),this.threeObj=null,this.scene=r.a.scene}return Object(i.a)(e,[{key:"setThreeObj",value:function(e){this.threeObj=e,this.scene.add(this.threeObj),this.renderListener=this._onRender.bind(this),document.addEventListener(s.a.RENDER,this.renderListener)}},{key:"_onRender",value:function(e){try{this.render(e.detail.epoch)}catch(t){this.threeObj.visible=!1}}},{key:"render",value:function(e){}},{key:"drop",value:function(){this.threeObj&&(this.scene.remove(this.threeObj),this.threeObj.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}),delete this.threeObj),document.removeEventListener(s.a.RENDER,this.renderListener)}}]),e}();o.texturePath="texture/"},,function(e,t,a){"use strict";a.d(t,"b",function(){return s});var n=a(8);a.d(t,"c",function(){return n.a});var i=a(10);function s(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"viewport-id";function i(a){n.a.renderLoopActive&&(n.a.tick((a-t)/1e3),t=a,e.update(),requestAnimationFrame(i))}n.a.init(document.getElementById(a),function(e){t=e,requestAnimationFrame(i)}),n.a.loadModule("PatchedConics"),n.a.loadModule("SolarSystem")}a.d(t,"a",function(){return i.a})},function(e,t,a){"use strict";a.d(t,"a",function(){return c});var n=a(2),i=a(3),s=a(7),r=a(4),o=a(6),c=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(s.a)(this,Object(r.a)(t).call(this))).func=e,a}return Object(o.a)(t,e),Object(i.a)(t,[{key:"evaluate",value:function(e){return this.func(e)}}]),t}(a(30).a)},function(e,t,a){"use strict";a.d(t,"a",function(){return o});var n=a(2),i=a(3),s=a(1),r=a(17),o=function(){function e(t,a,i,s,r,o,c,l,h){Object(n.a)(this,e),this._mu=l,this._sma=a,this._e=t,this._inc=s,this._raan=r,this._aop=i,this._epoch=c,void 0===h||!0===h?this.ta=o:this.m0=o,this.updateMeanMotion()}return Object(i.a)(e,[{key:"setUpdateCallback",value:function(e){this.updateCallback=e}},{key:"copy",value:function(){return new e(this._e,this._sma,this._aop,this._inc,this._raan,this.m0,this._epoch,this._mu,!1)}},{key:"updateMeanMotion",value:function(){this.meanMotion=Math.sqrt(this._mu/Math.abs(this._sma))/Math.abs(this._sma)}},{key:"getNodalPrecessionRate",value:function(e,t){return-1.5*e*e*t*Math.cos(this.inc)*this.meanMotion/Math.pow(this.sma*(1-this.e*this.e),2)}},{key:"getNodalPrecessionByEpoch",value:function(e,t,a){return(a-this._epoch)*this.getNodalPrecessionRate(e,t)}},{key:"addPrecession",value:function(e,t,a){return this.m0=this.getMeanAnomalyByEpoch(a),this._raan+=this.getNodalPrecessionByEpoch(e,t,a),this._epoch=a,this}},{key:"getMeanAnomalyByEpoch",value:function(e){return this.m0+this.meanMotion*(e-this._epoch)}},{key:"getEccentricAnomalyByEpoch",value:function(e){return this.getEccentricAnomalyByMeanAnomaly(this.getMeanAnomalyByEpoch(e))}},{key:"getTrueAnomalyByEpoch",value:function(e){return this.getTrueAnomalyByMeanAnomaly(this.getMeanAnomalyByEpoch(e))}},{key:"getMeanAnomalyByEccentricAnomaly",value:function(e){return this.isElliptic?e-this._e*Math.sin(e):this._e*Math.sinh(e)-e}},{key:"getMeanAnomalyByTrueAnomaly",value:function(e){return this.getMeanAnomalyByEccentricAnomaly(this.getEccentricAnomalyByTrueAnomaly(e))}},{key:"getEccentricAnomalyByMeanAnomaly",value:function(e){var t,a,n=e,i=0;if(this.isElliptic)for(n/=2*Math.PI,n=2*Math.PI*(n-Math.floor(n)),a=(t=this._e<.8?n:Math.PI)-this._e*Math.sin(t)-n;Math.abs(a)>1e-8&&i<30;)a=(t-=a/(1-this._e*Math.cos(t)))-this._e*Math.sin(t)-n,i+=1;else for(t=(Math.log(2*(Math.abs(n)+1/3))+1)/this._e+(1-1/this._e)*Math.asinh(Math.abs(n)/this._e),t*=Math.sign(n),a=this._e*Math.sinh(t)-t-n;Math.abs(a)>1e-8&&i<30;)t-=a/(this._e*Math.cosh(t)-1),a=this._e*Math.sinh(t)-t-n,i+=1;return t}},{key:"getEccentricAnomalyByTrueAnomaly",value:function(e){if(this.isElliptic){var t=Math.cos(e),a=(this._e+t)/(1+this._e*t);return(e+s.b)%s.b<=Math.PI?Math.acos(a):s.b-Math.acos(a)}return 2*Math.atanh(Math.tan(e/2)/Math.sqrt((this._e+1)/(this._e-1)))}},{key:"getTrueAnomalyByMeanAnomaly",value:function(e){return this.getTrueAnomalyByEccentricAnomaly(this.getEccentricAnomalyByMeanAnomaly(e))}},{key:"getTrueAnomalyByEccentricAnomaly",value:function(e){if(this.isElliptic){var t=Math.atan2(Math.sqrt(1-this._e*this._e)*Math.sin(e),Math.cos(e)-this._e);return t>=0?t:t+2*Math.PI}return 2*Math.atan(Math.sqrt((this._e+1)/(this._e-1))*Math.tanh(e/2))}},{key:"getOwnCoordsByTrueAnomaly",value:function(e){var t=this._sma*(1-this._e*this._e)/(1+this._e*Math.cos(e));return new s.c([t*Math.cos(e),t*Math.sin(e),0])}},{key:"getAsymptoteTa",value:function(){return!this.isElliptic&&Math.acos(-1/this._e)}},{key:"getPeriapsisRadius",value:function(){return this._sma*(1-this._e)}},{key:"getApoapsisRadius",value:function(){return this._sma*(1+this._e)}},{key:"getPeriapsisSpeed",value:function(){return Math.sqrt(this._mu*(2/this.getPeriapsisRadius()-1/this._sma))}},{key:"getApoapsisSpeed",value:function(){return Math.sqrt(this._mu*(2/this.getApoapsisRadius()-1/this._sma))}},{key:"getEpochByTrueAnomaly",value:function(e){if(null===e)return null;var t=this.getMeanAnomalyByTrueAnomaly(e)-this.m0;return t<0&&this.isElliptic&&(t+=s.b),this._epoch+t/this.meanMotion}},{key:"getSphereCrossingTrueAnomaly",value:function(e){var t=this.getApoapsisRadius();if(t>0&&e>t||e<this.getPeriapsisRadius())return!1;var a=Math.acos((this._sma*(1-this._e*this._e)/e-1)/this._e);return[a,s.b-a]}},{key:"getPlaneCrossingTrueAnomaly",value:function(e){var t=this._sma*(1-this._e*this._e)*Math.sin(this._inc)/e,a=this._e,n=Math.cos(this._aop),i=Math.sin(this._aop),r=this._planeCrossingHelper(t*n,t*i-a),o=this._planeCrossingHelper(-t*n,-t*i-a),c=null,l=null;return(!1!==r||!1!==o)&&(this.isHyperbolic?r instanceof Array?!o instanceof Array?[r]:[[Math.min(r[0],o[0]),Math.max(r[0],o[0])],[Math.min(r[1],o[1]),Math.max(r[1],o[1])]]:o instanceof Array?[o]:!1!==r&&!1!==o?[[Math.min(o,r),Math.max(o,r)]]:(console.log("Error! getPlaneCrossingTrueAnomaly() not implemented!"),!1):(!1!==r&&(c=(this._aop+r[0])%s.b<(this._aop+r[1])%s.b?[r[1],r[0]]:[r[0],r[1]]),!1!==o?(l=(this._aop+o[0])%s.b<(this._aop+o[1])%s.b?[o[1],o[0]]:[o[0],o[1]],c?[[c[0],l[1]],[l[0],c[1]]]:[l]):[c]))}},{key:"_planeCrossingHelper",value:function(e,t){var a=e*e+t*t,n=Math.sqrt(e*e*(a-1)),i=Math.atan2(((t*n-t*t)/a+1)/e,(t-n)/a);if(isNaN(i))return!1;var r=Math.atan2(((-t*n-t*t)/a+1)/e,(t+n)/a);if(this.isElliptic)return[i<0?i+s.b:i,r<0?r+s.b:r];var o=this.getAsymptoteTa();return i=this._validateHyperbolicTa(o,i),r=this._validateHyperbolicTa(o,r),!1!==i&&!1!==r&&i!==r?[Math.min(i,r),Math.max(i,r)]:!1!==i?i:!1!==r&&r}},{key:"_validateHyperbolicTa",value:function(e,t){return t>Math.PI&&(t-=s.b),!(t>e||t<-e)&&(!(Math.abs(t-Math.sign(t)*e)<1e-14)&&t)}},{key:"getStateByEpoch",value:function(e){if(this.isElliptic){var t=this.getEccentricAnomalyByEpoch(e),a=Math.cos(t),n=Math.sin(t),i=Math.sqrt(this._mu/this._sma)/(1-this._e*a),o=new s.c([this._sma*(a-this._e),this._sma*Math.sqrt(1-this._e*this._e)*n,0]),c=new s.c([-i*n,i*Math.sqrt(1-this._e*this._e)*a,0]);return new r.a(o.rotateZ(this._aop).rotateX(this._inc).rotateZ(this._raan),c.rotateZ(this._aop).rotateX(this._inc).rotateZ(this._raan))}var l=this.getTrueAnomalyByEpoch(e),h=this.getOrbitalFrameQuaternion(),u=this.getOwnCoordsByTrueAnomaly(l),m=Math.atan(this._e*Math.sin(l)/(1+this._e*Math.cos(l))),d=new s.c([Math.sqrt(this._mu*(2/u.mag-1/this._sma)),0,0]);return new r.a(h.rotate_(u),h.rotate_(d.rotateZ(l+Math.PI/2-m)))}},{key:"getNormalVector",value:function(){var e=new s.a(new s.c([0,0,1]),this._raan);return new s.a(e.rotate_(new s.c([1,0,0])),this._inc).rotate_(new s.c([0,0,1]))}},{key:"getPeriapsisVector",value:function(){return this.getOrbitalFrameQuaternion().rotate_(new s.c([1,0,0]))}},{key:"getOrbitalFrameQuaternion",value:function(){return new s.a(new s.c([0,0,1]),this._raan).mul_(new s.a(new s.c([1,0,0]),this._inc)).mul_(new s.a(new s.c([0,0,1]),this._aop))}},{key:"isHyperbolic",get:function(){return this._e>1}},{key:"isElliptic",get:function(){return this._e<1}},{key:"mu",get:function(){return this._mu},set:function(e){this._mu=e,this.updateMeanMotion(),this.updateCallback&&this.updateCallback()}},{key:"sma",get:function(){return this._sma},set:function(e){this._sma=e,this.updateMeanMotion(),this.updateCallback&&this.updateCallback()}},{key:"e",get:function(){return this._e},set:function(e){this._e=e,this.updateCallback&&this.updateCallback()}},{key:"ecc",get:function(){return this._e},set:function(e){this.e=e}},{key:"inc",get:function(){return this._inc},set:function(e){this._inc=e,this.updateCallback&&this.updateCallback()}},{key:"raan",get:function(){return this._raan},set:function(e){this._raan=e,this.updateCallback&&this.updateCallback()}},{key:"aop",get:function(){return this._aop},set:function(e){this._aop=e,this.updateCallback&&this.updateCallback()}},{key:"ta",get:function(){return this.getTrueAnomalyByEpoch(this._epoch)},set:function(e){this.m0=this.getMeanAnomalyByTrueAnomaly(e),this.updateCallback&&this.updateCallback()}},{key:"epoch",get:function(){return this._epoch},set:function(e){this._epoch=e,this.updateCallback&&this.updateCallback()}},{key:"period",get:function(){return this.isElliptic?2*Math.PI*Math.sqrt(this._sma*this._sma*this._sma/this._mu):0}}],[{key:"createFromState",value:function(t,a,n){if(n=n||0,!t)return null;var i=t.position,s=t.velocity,r=i.cross(s),o=Math.atan2(r.x,-r.y),c=Math.atan2(Math.sqrt(Math.pow(r.x,2)+Math.pow(r.y,2)),r.z),l=a*i.mag/(2*a-i.mag*Math.pow(s.mag,2)),h=Math.sqrt(1-Math.min(1,Math.pow(r.mag,2)/(a*l))),u=i.rotateZ(-o).rotateX(-c),m=Math.atan2(u.y,u.x),d=i.dot(s),p=Math.acos(Math.min(1,Math.max(-1,(l*(1-h*h)/i.mag-1)/h)))*Math.sign(d);return new e(h,l,m-p>0?m-p:2*Math.PI+(m-p),c,o,p,n,a,!0)}}]),e}()},function(e,t,a){"use strict";a.d(t,"a",function(){return h});var n=a(2),i=a(3),s=a(7),r=a(4),o=a(12),c=a(6),l=a(19),h=function(e){function t(e,a,i,o,c,h,u){var m;return Object(n.a)(this,t),(m=Object(s.a)(this,Object(r.a)(t).call(this,e,a,i,o))).visualModel=c,m.physicalModel=h,m.orientation=u,m.visualModel&&m.visualModel.setObject(Object(l.a)(Object(l.a)(m))),m}return Object(c.a)(t,e),Object(i.a)(t,[{key:"drop",value:function(){this.visualModel&&(this.visualModel.drop(),delete this.visualModel),Object(o.a)(Object(r.a)(t.prototype),"drop",this).call(this)}}]),t}(a(16).a)},,function(e,t,a){"use strict";a.d(t,"a",function(){return c});var n=a(2),i=a(3),s=a(7),r=a(4),o=a(6),c=function(e){function t(e,a){var i;return Object(n.a)(this,t),(i=Object(s.a)(this,Object(r.a)(t).call(this,e))).keplerianObject=a,i}return Object(o.a)(t,e),Object(i.a)(t,[{key:"setUpdateCallback",value:function(e){var t=this;this.keplerianObject.setUpdateCallback(function(){return e(t)})}},{key:"getKeplerianObjectByEpoch",value:function(e,t){return this.validateEpoch(e),this._transformKeplerianObject(this.keplerianObject,t)}},{key:"mu",get:function(){return this.keplerianObject.mu},set:function(e){this.keplerianObject.mu=e}},{key:"sma",get:function(){return this.keplerianObject.sma},set:function(e){this.keplerianObject.sma=e}},{key:"ecc",get:function(){return this.keplerianObject.ecc},set:function(e){this.keplerianObject.ecc=e}},{key:"inc",get:function(){return this.keplerianObject.inc},set:function(e){this.keplerianObject.inc=e}},{key:"raan",get:function(){return this.keplerianObject.raan},set:function(e){this.keplerianObject.raan=e}},{key:"aop",get:function(){return this.keplerianObject.aop},set:function(e){this.keplerianObject.aop=e}},{key:"ta",get:function(){return this.keplerianObject.ta},set:function(e){this.keplerianObject.ta=e}},{key:"epoch",get:function(){return this.keplerianObject.epoch},set:function(e){this.keplerianObject.epoch=e}}]),t}(a(39).a)},,function(e,t,a){"use strict";a.d(t,"a",function(){return l});var n=a(2),i=a(3),s=a(1),r=a(17),o=a(9),c=a(8),l=function(){function e(){Object(n.a)(this,e)}return Object(i.a)(e,[{key:"setId",value:function(e){return this.id=e,this.originId=o.d.getOriginIdByReferenceFrameId(e),this.type=o.d.getTypeByReferenceFrameId(e),this}},{key:"getQuaternionByEpoch",value:function(e){return new s.a}},{key:"getOriginPositionByEpoch",value:function(e){return new s.c(3)}},{key:"getOriginStateByEpoch",value:function(e){return new r.a}},{key:"transformStateVectorByEpoch",value:function(t,a,n){var i=n instanceof e?n:c.a.starSystem.getReferenceFrame(n);return this===i?a:this.id===o.a?i.stateVectorFromBaseReferenceFrameByEpoch(t,a):i.id===o.a?this.stateVectorToBaseReferenceFrameByEpoch(t,a):i.stateVectorFromBaseReferenceFrameByEpoch(t,this.stateVectorToBaseReferenceFrameByEpoch(t,a))}},{key:"transformPositionByEpoch",value:function(e,t,a){return this.transformStateVectorByEpoch(e,new r.a(t),a).position}},{key:"rotateVectorByEpoch",value:function(t,a,n){var i=n instanceof e?n:c.a.starSystem.getReferenceFrame(n);return this===i?a.copy():i.getQuaternionByEpoch(t).invert_().mul_(this.getQuaternionByEpoch(t)).rotate(a)}},{key:"stateVectorFromBaseReferenceFrameByEpoch",value:function(e,t){}},{key:"stateVectorToBaseReferenceFrameByEpoch",value:function(e,t){}},{key:"mu",get:function(){if(void 0===this._mu){var e=c.a.starSystem.getObject(this.originId);this._mu=e.physicalModel?e.physicalModel.mu:null}return this._mu}}]),e}()},,function(e,t,a){"use strict";a.d(t,"a",function(){return v});var n=a(2),i=a(3),s=a(7),r=a(4),o=a(12),c=a(6),l=a(5),h=a(44),u=a(9),m=a(1),d=a(21),p=a(40),f=a(8),v=function(e){function t(){return Object(n.a)(this,t),Object(s.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(i.a)(t,[{key:"render",value:function(e){Object(o.a)(Object(r.a)(t.prototype),"render",this).call(this,e);var a=this.getRenderingEpoch(e);if(null!==a){var n=this.trajectory.getKeplerianObjectByEpoch(a);n.isElliptic?this.renderEllipse(n,a,e):this.renderHyperbola(n,a,e)}else this.threeObj.visible=!1}},{key:"renderHyperbola",value:function(e,t,a){var n=e.getAsymptoteTa(),i=-n;null!==this.trajectory.minEpoch&&!1!==this.trajectory.minEpoch&&(i=e.getTrueAnomalyByEpoch(this.trajectory.minEpoch)),null!==this.trajectory.maxEpoch&&!1!==this.trajectory.maxEpoch&&(n=e.getTrueAnomalyByEpoch(this.trajectory.maxEpoch));var s=this.trajectory.pericentricReferenceFrame.getQuaternionByEpoch(t),r=e.getTrueAnomalyByEpoch(t),o=(n-i)/101,c=[],h=[],u=i+o,m=0;u>(i+r)/2&&(u=(i+r)/2);for(var d=(Math.max(n-o,r)-u)/99,p=0;m<100+p;){var v=e.getOwnCoordsByTrueAnomaly(u);c[m]=(new l.E).fromArray([v[0],v[1]]),h[m]=u>r?0:r==i?1:(u-i)/(r-i),m+=1,(u+=d)-d<=r&&r<u&&(v=e.getOwnCoordsByTrueAnomaly(r),c[m]=(new l.E).fromArray([v[0],v[1]]),h[m]=1,c[m+=1]=(new l.E).fromArray([v[0],v[1]]),h[m]=0,m+=1,p+=2)}this.threeObj.visible=!0,this.updateGeometry(c,h,.35),this.threeObj.quaternion.copy(s.toThreejs()),this.threeObj.position.copy(f.a.getVisualCoords(this.trajectory.referenceFrame.getOriginPositionByEpoch(a)))}},{key:"renderEllipse",value:function(e,t,a){var n=this,i=new p.a(new d.a(function(e){return n.trajectory.getReferenceFrameByEpoch(e).getOriginStateByEpoch(a)}),this.trajectory.pericentricReferenceFrame.getQuaternionByEpoch(t)),s=this.trajectory.pericentricReferenceFrame.getQuaternionByEpoch(t),r=f.a.starSystem.getReferenceFrame(u.a).transformPositionByEpoch(a,f.a.camera.lastPosition,i),o=new m.c([r.x,r.y,0]),c=i.transformPositionByEpoch(a,o,u.a),h=e.getTrueAnomalyByEpoch(t),v=o.y/o.mag,y=o.x/o.mag,b=Object(m.g)(v,y),g=e.getOwnCoordsByTrueAnomaly(b).sub(r).mag,E=e.getOwnCoordsByTrueAnomaly(b+Math.PI).sub(r).mag,j=Math.acos((e.e+Math.cos(b))/(1+e.e*Math.cos(b))),O=Math.acos((e.e+Math.cos(h))/(1+e.e*Math.cos(h)));h>Math.PI&&(O=2*Math.PI-O),b>Math.PI&&(j=2*Math.PI-j);var _=this.getEllipsePoints(new l.h(-e.sma*e.e-o.x,-o.y,e.sma,e.sma*Math.sqrt(1-e.e*e.e),O,2*Math.PI+O-1e-13,!1,0),100,((j-O)/(2*Math.PI)+1)%1,E/g);this.threeObj.visible=!0,this.updateGeometry(_.coords,_.angs,.35),this.threeObj.quaternion.copy(s.toThreejs()),this.threeObj.position.copy(f.a.getVisualCoords(c))}},{key:"getEllipsePoints",value:function(e,t,a,n){var i=.25;n>30&&(i=1/((Math.min(n,530)-30)/60+4),n=30);var s=[],r=[],o=t-3,c=(1-i)/3,l=Math.floor(o/(n+2*Math.sqrt(n)+1)),h=Math.floor(Math.sqrt(n)*l),u=o-l-2*h,m=a-i/2;m<0&&(m+=1),s.push(e.getPoint(m)),r.push(m);for(var d=[[u,i],[h,c],[l,c],[h,c]],p=0;p<d.length;p++)for(var f=d[p],v=0;v<f[0];++v)(m+=f[1]/f[0])>1&&(s.push(e.getPoint(1)),r.push(1),s.push(e.getPoint(0)),r.push(0),m-=1),s.push(e.getPoint(m)),r.push(m);return{coords:s,angs:r}}}]),t}(h.a)},function(e,t,a){"use strict";a.d(t,"a",function(){return s});var n=a(2),i=a(3),s=function(){function e(){Object(n.a)(this,e)}return Object(i.a)(e,[{key:"evaluate",value:function(e){return null}}]),e}()},,,,function(e,t,a){"use strict";a.d(t,"a",function(){return u});var n=a(2),i=a(3),s=a(7),r=a(4),o=a(12),c=a(6),l=a(36),h=a(42),u=function(e){function t(){var e;return Object(n.a)(this,t),(e=Object(s.a)(this,Object(r.a)(t).call(this))).components=[],e.lastUsedTrajectory=null,e.isSelected=!1,e}return Object(c.a)(t,e),Object(i.a)(t,[{key:"select",value:function(){this.isSelected=!0,this.visualModel&&this.visualModel.select(),this.components.map(function(e){return e.select()})}},{key:"deselect",value:function(){Object(o.a)(Object(r.a)(t.prototype),"deselect",this).call(this),this.components.map(function(e){return e.deselect()})}},{key:"drop",value:function(){Object(o.a)(Object(r.a)(t.prototype),"drop",this).call(this),this.components.map(function(e){return e.drop()})}},{key:"isEditableAtEpoch",value:function(e){return this.getComponentByEpoch(e).isEditableAtEpoch(e)}},{key:"getReferenceFrameByEpoch",value:function(e){return this.getComponentByEpoch(e).getReferenceFrameByEpoch(e)}},{key:"getStateInOwnFrameByEpoch",value:function(e){return this.getComponentByEpoch(e).getStateInOwnFrameByEpoch(e)}},{key:"getKeplerianObjectByEpoch",value:function(e){return this.getComponentByEpoch(e).getKeplerianObjectByEpoch(e)}},{key:"getStateByEpoch",value:function(e,t){return this.getComponentByEpoch(e).getStateByEpoch(e,t)}},{key:"getComponentByEpoch",value:function(e){if(this.lastUsedTrajectory&&(this.lastUsedTrajectory.minEpoch<=e||!1===this.lastUsedTrajectory.minEpoch)&&(this.lastUsedTrajectory.maxEpoch>=e||!1===this.lastUsedTrajectory.maxEpoch))return this.lastUsedTrajectory;var t=!0,a=!1,n=void 0;try{for(var i,s=this.components[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var r=i.value;if((r.minEpoch<=e||!1===r.minEpoch)&&(r.maxEpoch>=e||!1===r.maxEpoch))return this.lastUsedTrajectory=r,r}}catch(o){a=!0,n=o}finally{try{t||null==s.return||s.return()}finally{if(a)throw n}}throw new h.a(this.object,e,this.minEpoch,this.maxEpoch)}},{key:"addComponent",value:function(e){this.components.push(e),e.setParent(this),this.isSelected&&e.select(),(null===this.minEpoch||null!==e.minEpoch&&!1!==e.minEpoch&&this.minEpoch>e.minEpoch)&&(this.minEpoch=e.minEpoch),(null===this.maxEpoch||null!==e.maxEpoch&&!1!==e.maxEpoch&&this.maxEpoch<e.maxEpoch)&&(this.maxEpoch=e.maxEpoch)}},{key:"clearAfterEpoch",value:function(e){for(;this.components[this.components.length-1].minEpoch>=e;)this.components[this.components.length-1].drop(),this.components.pop()}}]),t}(l.a)},,function(e,t,a){"use strict";var n=a(2),i=a(3),s=a(17),r=a(9),o=a(22),c=a(42),l=a(21),h=a(37),u=a(1),m=a(7),d=a(4),p=a(12),f=a(6),v=a(5),y=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(m.a)(this,Object(d.a)(t).call(this))).value=e,a}return Object(f.a)(t,e),Object(i.a)(t,[{key:"evaluate",value:function(e){return this.value}}]),t}(a(30).a),b=a(18),g=function(e){function t(){return Object(n.a)(this,t),Object(m.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(i.a)(t,[{key:"raycast",value:function(e,t){this.visible=!0;var a=this.normal.x,n=this.normal.y,i=this.normal.z,s=new v.F(this.constant*a/Math.sqrt(a*a+n*n+i*i),this.constant*n/Math.sqrt(a*a+n*n+i*i),this.constant*i/Math.sqrt(a*a+n*n+i*i)).dot(this.normal)/e.ray.direction.dot(this.normal),r=e.ray.direction.clone().multiplyScalar(s);t.push({distance:r.length(),point:r,index:0,face:null,faceIndex:null,object:this})}}]),t}(v.s),E=a(43),j=function(e){function t(e,a,i,s,r,o){var c;return Object(n.a)(this,t),(c=Object(m.a)(this,Object(d.a)(t).call(this,e,a,i,s,r,o))).remove(c.line),c.line=new E.a(c.line.geometry,c.line.material),c.add(c.line),c}return Object(f.a)(t,e),t}(v.b),O=a(8),_=function(e){function t(e,a,i,s,r,o,c,l){var h;return Object(n.a)(this,t),(h=Object(m.a)(this,Object(d.a)(t).call(this)))._referenceFrame=e,h._position=a,h._orientation=i,h._value=s,h.color=r,h.type=c,h.arcSize=o,h.editingCallback=l,h.isEditMode=!!l,h.orientationUpdated=!1,h.valueUpdated=!1,h.isHidden=!1,h.sizeNeedsUpdate=!1,h.init(),h}return Object(f.a)(t,e),Object(i.a)(t,[{key:"hide",value:function(){this.threeObj.visible=!1,this.isHidden=!0}},{key:"show",value:function(){this.threeObj.visible=!0,this.isHidden=!1}},{key:"getReferenceFrame",value:function(e){return this._referenceFrame.evaluate(e)}},{key:"getPosition",value:function(e){return this._position.evaluate(e)}},{key:"getOrientation",value:function(e){return this._orientation.evaluate(e)}},{key:"getValue",value:function(e){return this._value.evaluate(e)}},{key:"init",value:function(){this.onWheelListener=this.onMouseWheel.bind(this),document.addEventListener("wheel",this.onWheelListener),this.isEditMode&&(this.mouseDownListener=this.onMouseDown.bind(this),document.addEventListener("mousedown",this.mouseDownListener)),this.size=O.a.camera.position.mag/6*this.arcSize,this.type===t.TYPE_ARC?this.createArcObject():this.createSectorObject(),this.valueUpdated=!0,this.orientationUpdated=!0}},{key:"onMouseWheel",value:function(){this.sizeNeedsUpdate=!0}},{key:"onMouseDown",value:function(e){(this.type===t.TYPE_ARC?O.a.raycaster.intersectObjects([this.threeAngle.line])[0]:O.a.raycaster.intersectObjects([this.threeAngle.children[0].line,this.threeAngle.children[0].cone])[0])&&0==e.button&&(this.mouseUpListener=this.onMouseUp.bind(this),document.addEventListener("mouseup",this.mouseUpListener),this.mouseMoveListener=this.onMouseMove.bind(this),O.a.addEventListener("mousemove",this.mouseMoveListener,2))}},{key:"onMouseUp",value:function(e){document.removeEventListener("mouseup",this.mouseUpListener),O.a.removeEventListener("mousemove",this.mouseMoveListener)}},{key:"onMouseMove",value:function(){var e=this.getVirtualPlane(),t=O.a.raycaster.intersectObjects([e])[0];if(t){var a=t.point.clone().sub(this.threeObj.position).normalize(),n=new v.F(1,0,0);n.applyQuaternion(this.threeObj.quaternion);var i=Math.acos(n.dot(a)/n.length()/a.length());n.cross(a),this._value=new y(n.dot(e.normal)>0?i:u.b-i),this.valueUpdated=!0,this.editingCallback&&this.editingCallback(this._value.value)}}},{key:"getVirtualPlane",value:function(){var e=new v.F(0,0,1);e.applyQuaternion(this.threeObj.quaternion);var t=Math.acos(e.dot(this.threeObj.position)/this.threeObj.position.length()/e.length()),a=this.threeObj.position.length()*Math.cos(t);return this.virtualPlane?(this.virtualPlane.normal.copy(e),this.virtualPlane.constant=a):this.virtualPlane=new g(e,a),this.virtualPlane}},{key:"createArcObject",value:function(){var e=new v.k({color:this.color}),t=new v.q;this.threeArc=new v.j(new v.i,e),this.threeMainAxis=new v.j(new v.i,e),this.threeAngle=new v.j(new v.i,e),this.threeMainAxis.geometry.vertices.push(new v.F(0,0,0),new v.F(1,0,0)),this.threeAngle.geometry.vertices.push(new v.F(0,0,0),new v.F(1,0,0)),t.add(this.threeArc),t.add(this.threeMainAxis),t.add(this.threeAngle),t.scale.set(this.size,this.size,this.size),this.setThreeObj(t)}},{key:"updateArcObject",value:function(e){e<0&&(e-=2*Math.PI*Math.floor(e/2/Math.PI)),this.threeArc.geometry.dispose(),this.threeArc.geometry=new v.i,this.threeArc.geometry.setFromPoints(new v.h(0,0,1/3,1/3,0,e,!1,0).getPoints(Math.ceil(30*e)))}},{key:"createSectorObject",value:function(){var e=new v.o({color:this.color,opacity:.175,transparent:!0,side:v.g}),t=new v.q;this.threeArc=new v.n(new v.i,e),this.threeMainAxis=new j(new v.F(1,0,0),new v.F(0,0,0),1,this.color),this.threeAngle=new v.q,this.threeAngle.add(new j(new v.F(1,0,0),new v.F(0,0,0),1,this.isEditMode?12776514:this.color)),t.add(this.threeArc),t.add(this.threeMainAxis),t.add(this.threeAngle),t.scale.set(this.size,this.size,this.size),this.setThreeObj(t)}},{key:"updateSectorObject",value:function(e){e<0&&(e-=2*Math.PI*Math.floor(e/2/Math.PI)),this.threeArc.geometry.dispose(),this.threeArc.geometry=new v.e(1,Math.ceil(30*e),0,e)}},{key:"drop",value:function(){Object(p.a)(Object(d.a)(t.prototype),"drop",this).call(this),delete this.threeMainAxis,delete this.threeAngle,delete this.threeArc,document.removeEventListener("wheel",this.onWheelListener),this.mouseDownListener&&document.removeEventListener("mousedown",this.mouseDownListener)}},{key:"render",value:function(e){if(!this.isHidden){var a=this.getReferenceFrame(e),n=a.transformPositionByEpoch(e,this.getPosition(e),r.a);if(this.threeObj.position.copy(O.a.getVisualCoords(n)),this.threeObj.visible=!0,this.valueUpdated||!(this._value instanceof y)){var i=this.getValue(e);this.type===t.TYPE_ARC?this.updateArcObject(i):this.updateSectorObject(i),this.threeAngle.rotation.z=i,this.valueUpdated=!1}!this.orientationUpdated&&this._orientation instanceof y||(this.threeObj.quaternion.copy(a.getQuaternionByEpoch(e).mul_(this.getOrientation(e)).toThreejs()),this.orientationUpdated=!1),this.sizeNeedsUpdate&&(this.size=this.threeObj.position.length()/6*this.arcSize,this.threeObj.scale.set(this.size,this.size,this.size),this.sizeNeedsUpdate=!1)}}}]),t}(b.a);_.TYPE_ARC="arc",_.TYPE_SECTOR="sector";var M=function(e){function t(e,a,i,s,r,o,c){var l;return Object(n.a)(this,t),(l=Object(m.a)(this,Object(d.a)(t).call(this)))._referenceFrame=e,l._value=a,l.color=i,l.size=s,l.editingCallback=r,l.minBound=o,l.maxBound=c,l.isEditMode=!!r,l.isHidden=!1,l.mouseMoved=!1,l.init(),l}return Object(f.a)(t,e),Object(i.a)(t,[{key:"hide",value:function(){this.threeObj.visible=!1,this.isHidden=!0}},{key:"show",value:function(){this.threeObj.visible=!0,this.isHidden=!1}},{key:"getReferenceFrame",value:function(e){return this._referenceFrame.evaluate(e)}},{key:"init",value:function(){this.setThreeObj(new v.n(new v.A(1,8,8),new v.o({color:this.color}))),this.isEditMode&&(this.mouseDownListener=this.onMouseDown.bind(this),document.addEventListener("mousedown",this.mouseDownListener))}},{key:"drop",value:function(){Object(p.a)(Object(d.a)(t.prototype),"drop",this).call(this),this.mouseDownListener&&document.removeEventListener("mousedown",this.mouseDownListener)}},{key:"onMouseDown",value:function(e){0==e.button&&(O.a.raycaster.intersectObjects([this.threeObj])[0]&&0==e.button&&(this.mouseUpListener=this.onMouseUp.bind(this),document.addEventListener("mouseup",this.mouseUpListener),this.mouseMoveListener=this.onMouseMove.bind(this),O.a.addEventListener("mousemove",this.mouseMoveListener,2)))}},{key:"onMouseUp",value:function(e){document.removeEventListener("mouseup",this.mouseUpListener),O.a.removeEventListener("mousemove",this.mouseMoveListener)}},{key:"onMouseMove",value:function(){this.mouseMoved=!0}},{key:"updateValue",value:function(e){var t=this.getVirtualPlane(e),a=O.a.raycaster.intersectObjects([t])[0];if(a){this._value=r.b.transformPositionByEpoch(e,O.a.getSimCoords(a.point),this.getReferenceFrame(e));for(var n=[0,1,2],i=0;i<n.length;i++){var s=n[i];this._value[s]<this.minBound[s]?this._value[s]=this.minBound[s]:this._value[s]>this.maxBound[s]&&(this._value[s]=this.maxBound[s])}this.editingCallback&&this.editingCallback(this._value)}}},{key:"getVirtualPlane",value:function(e){var t=(new v.F).fromArray(this.getReferenceFrame(e).getQuaternionByEpoch(e).rotate_(new u.c([0,0,1]))),a=O.a.getVisualCoords(this.getReferenceFrame(e).getOriginPositionByEpoch(e)),n=Math.acos(t.dot(a)/a.length()/t.length()),i=a.length()*Math.cos(n);return this.virtualPlane?(this.virtualPlane.normal.copy(t),this.virtualPlane.constant=i):this.virtualPlane=new g(t,i),this.virtualPlane}},{key:"render",value:function(e){this.mouseMoved&&(this.updateValue(e),this.mouseMoved=!1),this.threeObj.position.copy(O.a.getVisualCoords(this.getReferenceFrame(e).transformPositionByEpoch(e,this._value,r.a)));var t=this.size*this.threeObj.position.length()*O.a.raycaster.getPixelAngleSize();this.threeObj.scale.x=t,this.threeObj.scale.y=t,this.threeObj.scale.z=t}}]),t}(b.a),k=function(){function e(t){Object(n.a)(this,e),this.isEditMode=t.isEditable,this.trajectory=t,this.colorRaan=8388564,this.colorAop=10053324,this.colorInc=11534336,this.colorTa=16519104,O.a.settings.ui.showAnglesOfSelectedOrbit&&this.init()}return Object(i.a)(e,[{key:"init",value:function(){var e=this,t=new l.a(function(t){return e.trajectory.getReferenceFrameByEpoch(t)}),a=new y(new u.c(3));this.angleRaan=new _(t,a,new y(new u.a),new l.a(function(t){return e.trajectory.getKeplerianObjectByEpoch(t).raan}),this.colorRaan,1.5,this.isEditMode?_.TYPE_SECTOR:_.TYPE_ARC,this.isEditMode?function(t){e.trajectory.raan=t}:null),this.angleInc=new _(t,a,new l.a(function(t){var a=e.trajectory.getKeplerianObjectByEpoch(t);return new u.a(new u.c([0,0,1]),a.raan+Math.PI/2).mul_(new u.a(new u.c([1,0,0]),Math.PI/2))}),new l.a(function(t){return e.trajectory.getKeplerianObjectByEpoch(t).inc}),this.colorInc,2,this.isEditMode?_.TYPE_SECTOR:_.TYPE_ARC,this.isEditMode?function(t){e.trajectory.inc=t}:null),this.angleAop=new _(t,a,new l.a(function(t){var a=e.trajectory.getKeplerianObjectByEpoch(t);return new u.a(new u.c([0,0,1]),a.raan).mul_(new u.a(new u.c([1,0,0]),a.inc))}),new l.a(function(t){return e.trajectory.getKeplerianObjectByEpoch(t).aop}),this.colorAop,2.5,this.isEditMode?_.TYPE_SECTOR:_.TYPE_ARC,this.isEditMode?function(t){e.trajectory.aop=t}:null),this.angleTa=new _(t,a,new l.a(function(t){var a=e.trajectory.getKeplerianObjectByEpoch(t);return new u.a(new u.c([0,0,1]),a.raan).mul_(new u.a(new u.c([1,0,0]),a.inc)).mul_(new u.a(new u.c([0,0,1]),a.aop))}),new l.a(function(t){return e.trajectory.getKeplerianObjectByEpoch(t).getTrueAnomalyByEpoch(t)}),this.colorTa,3,_.TYPE_ARC),this.isEditMode&&(this.pointApoapsis=new M(new y(this.trajectory.pericentricReferenceFrame),new u.c([-this.trajectory.sma*(1+this.trajectory.ecc),0,0]),"red",10,function(t){var a=e.trajectory.sma*(1-e.trajectory.ecc),n=(-t.x+a)/2;e.trajectory.sma=n,e.trajectory.ecc=1-a/n},new u.c([-1e12,0,0]),new u.c([0,0,0])))}},{key:"remove",value:function(){this.angleRaan&&this.angleRaan.drop(),this.angleAop&&this.angleAop.drop(),this.angleInc&&this.angleInc.drop(),this.angleTa&&this.angleTa.drop(),this.pointApoapsis&&this.pointApoapsis.drop()}}]),e}(),w=a(27),S=a(10);a.d(t,"a",function(){return T});var T=function(){function e(){var t=this;Object(n.a)(this,e),this.minEpoch=null,this.maxEpoch=null,this.cachedEpoch=null,this.cachedState=null,this.visualModel=null,this.object=null,this.parent=null,this.referenceFrame=null,this.isEditable=!1,this.isSelected=!1,this.propagator=null,this.showOrbitAnglesListener=this._onShowOrbitAnglesChange.bind(this),this.orbitalReferenceFrame=new h.a(new l.a(function(e){return t.getStateByEpoch(e)}),new l.a(function(e){var a=t.getStateInOwnFrameByEpoch(e);return u.a.twoAxis(a.velocity,null,a.position)})),this.pericentricReferenceFrame=new h.a(new l.a(function(e){return t.getReferenceFrameByEpoch(e).getOriginStateByEpoch(e)}),new l.a(function(e){var a=t.getReferenceFrameByEpoch(e).getQuaternionByEpoch(e),n=t.getKeplerianObjectByEpoch(e);return a.mul_(n.getOrbitalFrameQuaternion())}))}return Object(i.a)(e,[{key:"isEditableAtEpoch",value:function(e){return this.isEditable}},{key:"setReferenceFrame",value:function(e){this.referenceFrame=O.a.starSystem.getReferenceFrame(e)}},{key:"getReferenceFrameByEpoch",value:function(e){return this.referenceFrame}},{key:"_transformKeplerianObject",value:function(e,t,a){if(void 0===t)return e;var n=t instanceof w.a?t:O.a.starSystem.getReferenceFrame(t);return void 0===a&&(a=e.epoch),o.a.createFromState(this.referenceFrame.transformStateVectorByEpoch(a,e.getStateByEpoch(a),n),n.mu,a)}},{key:"getKeplerianObjectByEpoch",value:function(e,t){var a=t instanceof w.a?t:void 0!==t?O.a.starSystem.getReferenceFrame(t):this.getReferenceFrameByEpoch(e);return o.a.createFromState(this.getStateByEpoch(e,a),a.mu,e)}},{key:"setVisualModel",value:function(e){this.visualModel=e}},{key:"setParent",value:function(e){this.parent=e}},{key:"setObject",value:function(e){this.object=e}},{key:"drop",value:function(){this.isSelected&&this.deselect(),this.visualModel&&this.visualModel.drop()}},{key:"select",value:function(){this.isSelected=!0,this.visualModel&&this.visualModel.select(),this.keplerianEditor=new k(this),S.a.addListener(S.a.SHOW_ORBIT_ANGLES_CHANGED,this.showOrbitAnglesListener)}},{key:"deselect",value:function(){this.isSelected=!1,this.visualModel&&this.visualModel.deselect(),this.keplerianEditor&&(this.keplerianEditor.remove(),delete this.keplerianEditor,S.a.removeListener(S.a.SHOW_ORBIT_ANGLES_CHANGED,this.showOrbitAnglesListener))}},{key:"_onShowOrbitAnglesChange",value:function(e){e.detail.value?this.keplerianEditor.init():this.keplerianEditor.remove()}},{key:"isValidAtEpoch",value:function(e){return!(null!==this.minEpoch&&!1!==this.minEpoch&&e<this.minEpoch)&&!(null!==this.maxEpoch&&!1!==this.maxEpoch&&e>this.maxEpoch)}},{key:"validateEpoch",value:function(e){if(!this.isValidAtEpoch(e))throw new c.a(this.object,this,e,this.minEpoch,this.maxEpoch)}},{key:"getStateInOwnFrameByEpoch",value:function(e){return this.validateEpoch(e),new s.a}},{key:"getStateByEpoch",value:function(e,t){var a;return null===this.referenceFrame?null:(void 0===t&&(t=r.a),t===r.a&&e===this.cachedEpoch?a=this.cachedState:(a=this.getStateInOwnFrameByEpoch(e),t===r.a&&e===O.a.currentEpoch&&(this.cachedState=a,this.cachedEpoch=e)),null===a?null:this.referenceFrame.transformStateVectorByEpoch(e,a,t))}},{key:"getPositionByEpoch",value:function(e,t){return this.getStateByEpoch(e,t).position}},{key:"getVelocityByEpoch",value:function(e,t){return this.getStateByEpoch(e,t).velocity}}]),e}()},function(e,t,a){"use strict";a.d(t,"a",function(){return c});var n=a(2),i=a(3),s=a(7),r=a(4),o=a(6),c=function(e){function t(e,a){var i;return Object(n.a)(this,t),(i=Object(s.a)(this,Object(r.a)(t).call(this,e))).quaternionOfEpoch=a,i}return Object(o.a)(t,e),Object(i.a)(t,[{key:"getQuaternionByEpoch",value:function(e){return this.quaternionOfEpoch.evaluate(e)}}]),t}(a(41).a)},,function(e,t,a){"use strict";a.d(t,"a",function(){return c});var n=a(2),i=a(3),s=a(7),r=a(4),o=a(6),c=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(s.a)(this,Object(r.a)(t).call(this))).setReferenceFrame(e),a}return Object(o.a)(t,e),Object(i.a)(t,[{key:"getStateInOwnFrameByEpoch",value:function(e){return this.getKeplerianObjectByEpoch(e).getStateByEpoch(e)}}]),t}(a(36).a)},function(e,t,a){"use strict";a.d(t,"a",function(){return h});var n=a(2),i=a(3),s=a(7),r=a(4),o=a(6),c=a(41),l=a(1),h=function(e){function t(e,a){var i;return Object(n.a)(this,t),(i=Object(s.a)(this,Object(r.a)(t).call(this,e))).quaternion=a,i}return Object(o.a)(t,e),Object(i.a)(t,[{key:"getQuaternionByEpoch",value:function(e){return l.a.copy(this.quaternion)}}]),t}(c.a)},function(e,t,a){"use strict";a.d(t,"a",function(){return h});var n=a(2),i=a(3),s=a(7),r=a(4),o=a(6),c=a(27),l=a(17),h=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(s.a)(this,Object(r.a)(t).call(this))).stateOfEpoch=e,a}return Object(o.a)(t,e),Object(i.a)(t,[{key:"getOriginPositionByEpoch",value:function(e){return this.stateOfEpoch.evaluate(e).position}},{key:"getOriginStateByEpoch",value:function(e){return this.stateOfEpoch.evaluate(e)}},{key:"stateVectorFromBaseReferenceFrameByEpoch",value:function(e,t){var a=this.stateOfEpoch.evaluate(e),n=this.getQuaternionByEpoch(e).invert_();return new l.a(n.rotate(t.position.sub_(a.position)),n.rotate(t.velocity.sub_(a.velocity)))}},{key:"stateVectorToBaseReferenceFrameByEpoch",value:function(e,t){var a=this.stateOfEpoch.evaluate(e),n=this.getQuaternionByEpoch(e);return new l.a(n.rotate(t.position).add_(a.position),n.rotate(t.velocity).add_(a.velocity))}}]),t}(c.a)},function(e,t,a){"use strict";a.d(t,"a",function(){return i});var n=a(2),i=function e(t,a,i,s,r){Object(n.a)(this,e),this.object=t,this.trajectory=a,this.epoch=i,this.minEpoch=s,this.maxEpoch=r}},function(e,t,a){"use strict";a.d(t,"a",function(){return l});var n=a(2),i=a(3),s=a(7),r=a(4),o=a(6),c=a(5),l=function(e){function t(){return Object(n.a)(this,t),Object(s.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(o.a)(t,e),Object(i.a)(t,[{key:"raycast",value:function(e,t){for(var a,n=this.geometry.isBufferGeometry,i=n?this.geometry.attributes.position.count:this.geometry.vertices.length,s=(new c.x).copy(e.ray).applyMatrix4((new c.m).getInverse(this.matrixWorld)),r=0;r<i-1;r++){var o=void 0,l=void 0;if(n){var h=3*r,u=(r+1)%i*3,m=this.geometry.attributes.position.array;o=new c.F(m[h],m[h+1],m[h+2]),l=new c.F(m[u],m[u+1],m[u+2])}else o=(new c.F).copy(this.geometry.vertices[r]),l=(new c.F).copy(this.geometry.vertices[(r+1)%i]);var d=(new c.F).subVectors(o,l),p=(new c.F).crossVectors(d,s.direction),f=(new c.F).crossVectors(s.direction,p),v=(new c.F).subVectors(s.origin,o).dot(f);v/=f.clone().dot(d);var y=(new c.F).addVectors(o,d.multiplyScalar(v));(new c.F).subVectors(o,y).dot((new c.F).subVectors(y,l))<0&&(y=y.distanceTo(o)<y.distanceTo(l)?o:l);var b=(new c.F).crossVectors((new c.F).subVectors(y,s.origin),s.direction).length();(!a||a.distance>b)&&(a={distance:b,point:y,index:r,face:null,faceIndex:null,object:this})}a&&a.distance/s.origin.distanceTo(a.point)<e.pixelPrecision*e.pixelAngleSize&&(a.point.applyMatrix4(this.matrixWorld),t.push(a))}}]),t}(c.j)},function(e,t,a){"use strict";a.d(t,"a",function(){return d});var n=a(2),i=a(3),s=a(7),r=a(4),o=a(12),c=a(6),l=a(5),h=a(18),u=a(43),m=a(8),d=function(e){function t(e,a){var i;return Object(n.a)(this,t),(i=Object(s.a)(this,Object(r.a)(t).call(this))).trajectory=e,i.standardColor=a.color,i.color=a.color,i.minEpoch=void 0!==a.minEpoch?a.minEpoch:e.minEpoch||null,i.maxEpoch=void 0!==a.maxEpoch?a.maxEpoch:e.maxEpoch||null,i.setThreeObj(new u.a(new l.i,new l.k({vertexColors:l.G}))),i.point=new l.n(new l.A(1,8,8),new l.o({color:i.color})),i.scene.add(i.point),i.pointSize=4,i.threeObj.userData={trajectory:e},m.a.selection.addSelectableObject(i.threeObj),i}return Object(c.a)(t,e),Object(i.a)(t,[{key:"updateGeometry",value:function(e,t,a){var n=new l.f(this.color);this.threeObj.geometry.dispose(),this.threeObj.geometry=(new l.i).setFromPoints(e);for(var i=0;i<t.length;i++){var s=(new l.f).copy(n),r=a+(1-a)*t[i];this.threeObj.geometry.colors.push(s.multiplyScalar(r))}}},{key:"getRenderingEpoch",value:function(e){if(null!==this.minEpoch&&e<this.minEpoch||null!==this.maxEpoch&&e>this.maxEpoch)return null;if(!this.trajectory.isValidAtEpoch(e)){if(null!==this.trajectory.minEpoch&&e<this.trajectory.minEpoch)return this.trajectory.minEpoch;if(null!==this.trajectory.maxEpoch&&e>this.trajectory.maxEpoch)return this.trajectory.maxEpoch}return e}},{key:"render",value:function(e){if(this.trajectory.isValidAtEpoch(e)){this.point.visible=!0,this.point.position.copy(m.a.getVisualCoords(this.trajectory.getPositionByEpoch(e)));var t=this.pointSize*this.point.position.length()*m.a.raycaster.getPixelAngleSize();this.point.scale.x=t,this.point.scale.y=t,this.point.scale.z=t}else this.point.visible=!1}},{key:"select",value:function(){this.setColor(16777215)}},{key:"deselect",value:function(){this.setColor(this.standardColor)}},{key:"setColor",value:function(e){this.color=e,this.point.material.color.set(this.color),this.point.material.needsUpdate=!0}},{key:"drop",value:function(){m.a.selection.removeSelectableObject(this.threeObj),this.scene.remove(this.point),this.point.geometry&&this.point.geometry.dispose(),this.point.material&&this.point.material.dispose(),delete this.point,Object(o.a)(Object(r.a)(t.prototype),"drop",this).call(this)}}]),t}(h.a)},,,function(e,t,a){"use strict";a.d(t,"a",function(){return s});var n=a(2),i=a(3),s=function(){function e(){Object(n.a)(this,e)}return Object(i.a)(e,[{key:"getQuaternionByEpoch",value:function(e){}}]),e}()},,,,,,function(e,t,a){"use strict";var n=a(2),i=a(3),s=a(15),r=a.n(s),o=a(9),c=a(23),l=a(7),h=a(4),u=a(6),m=a(47),d=a(1),p=function(e){function t(e){var a;Object(n.a)(this,t),a=Object(l.a)(this,Object(h.a)(t).call(this));var i=new d.c(e.vector);return a.axisQuaternion=d.a.transfer(new d.c([0,0,1]),i),a.angularSpeed=i.mag,a.initialAngle=e.angle||0,a.initialEpoch=e.epoch||0,a}return Object(u.a)(t,e),Object(i.a)(t,[{key:"getQuaternionByEpoch",value:function(e){return this.axisQuaternion.mul(new d.a([0,0,1],this.initialAngle+(e-this.initialEpoch)*this.angularSpeed))}}]),t}(m.a),f=function e(t){Object(n.a)(this,e),this.mu=t.mu,this.radius=t.radius,this.eqRadius=t.eqRadius,this.j2=t.j2||0},v=a(16),y=a(39),b=a(22),g=a(17),E=function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(l.a)(this,Object(h.a)(t).call(this,e))).keplerianObjects=[],a}return Object(u.a)(t,e),Object(i.a)(t,[{key:"addState",value:function(e){this.keplerianObjects.push(e)}},{key:"getKeplerianObjectByEpoch",value:function(e,t){this.validateEpoch(e);for(var a=Math.ceil((e-this.minEpoch)/(this.maxEpoch-this.minEpoch)*(this.keplerianObjects.length-1)),n=this.keplerianObjects[a].epoch>e?-1:1;a<this.keplerianObjects.length&&a>=0;){if(this.keplerianObjects[a].epoch==e)return this.keplerianObjects[a];if(this.keplerianObjects[a].epoch>e&&this.keplerianObjects[a-1].epoch<e)break;a+=n}return a!==this.keplerianObjects.length&&0!==a||(a-=n),this._transformKeplerianObject(this.approximateKeplerianObject(this.keplerianObjects[a-1],this.keplerianObjects[a],e),t)}},{key:"approximateKeplerianObject",value:function(e,t,a){var n=(a-e.epoch)/(t.epoch-e.epoch);if(.95<e.e&&e.e<1.05||.95<t.e&&t.e<1.05||e.isElliptic!==t.isElliptic){var i=e.getStateByEpoch(a),s=t.getStateByEpoch(a);return b.a.createFromState(new g.a(i.position.mul_(1-n).add_(s.position.mul_(n)),i.velocity.mul_(1-n).add_(s.velocity.mul_(n))),Object(d.e)(e.mu,t.mu,n),a)}var r=e.isElliptic?Object(d.d)(e.getMeanAnomalyByEpoch(a),t.getMeanAnomalyByEpoch(a),n):Object(d.e)(e.getMeanAnomalyByEpoch(a),t.getMeanAnomalyByEpoch(a),n);return new b.a(Object(d.e)(e.e,t.e,n),Object(d.e)(e.sma,t.sma,n),Object(d.d)(e.aop,t.aop,n),Object(d.d)(e.inc,t.inc,n),Object(d.d)(e.raan,t.raan,n),r,a,Object(d.e)(e.mu,t.mu,n),!1)}}]),t}(y.a),j=a(12),O=function(e){function t(e,a,i){var s;return Object(n.a)(this,t),(s=Object(l.a)(this,Object(h.a)(t).call(this,e))).r=a,s.j2=i,s}return Object(u.a)(t,e),Object(i.a)(t,[{key:"approximateKeplerianObject",value:function(e,a,n){var i=e.copy(),s=a.copy();return i.raan+=i.getNodalPrecessionByEpoch(this.r,this.j2,n),s.raan+=s.getNodalPrecessionByEpoch(this.r,this.j2,n),Object(j.a)(Object(h.a)(t.prototype),"approximateKeplerianObject",this).call(this,i,s,n)}}]),t}(E),_=a(25),M=function(e){function t(e,a,i,s){var r;return Object(n.a)(this,t),(r=Object(l.a)(this,Object(h.a)(t).call(this,e,a))).r=i,r.j2=s,r}return Object(u.a)(t,e),Object(i.a)(t,[{key:"getKeplerianObjectByEpoch",value:function(e,t){return this.validateEpoch(e),this._transformKeplerianObject(this.keplerianObject.addPrecession(this.r,this.j2,e),t)}}],[{key:"createFromState",value:function(e,a,n,i,s,r,o){return new t(e,b.a.createFromState(a,n,r),i,s,o)}}]),t}(_.a),k=a(34),w=a(44),S=a(8),T=function(e){function t(e,a){var i;return Object(n.a)(this,t),(i=Object(l.a)(this,Object(h.a)(t).call(this,e,a))).referenceFrame=S.a.starSystem.getReferenceFrame(a.pointArrayModel.referenceFrame),i.showAhead=a.pointArrayModel.showAhead,i.showBehind=a.pointArrayModel.showBehind,i.trailPeriod=a.pointArrayModel.trailPeriod,i.minCos=Math.cos(Object(d.f)(a.pointArrayModel.maxAngle||2)),i.minStep=a.pointArrayModel.minStep||180,i.threeObj.position.set(0,0,0),i.initVertices(),i}return Object(u.a)(t,e),Object(i.a)(t,[{key:"render",value:function(e){if(Object(j.a)(Object(h.a)(t.prototype),"render",this).call(this,e),null!==(e=this.getRenderingEpoch(e))){for(var a=this.referenceFrame.getOriginPositionByEpoch(e),n=[],i=[],s=0;s<this.positions.length;++s)if(this.epochs[s]<e-this.trailPeriod?(this.showBehind&&(n.push(this.positions[s]),i.push(0)),this.epochs[s+1]>e-this.trailPeriod&&(n.push(this.trajectory.getPositionByEpoch(e-this.trailPeriod,this.referenceFrame)),i.push(0))):this.epochs[s]<e?(n.push(this.positions[s]),i.push(1-(e-this.epochs[s])/this.trailPeriod)):this.epochs[s]>e&&this.showAhead&&(n.push(this.positions[s]),i.push(0)),this.epochs[s]<e&&this.epochs[s+1]>=e){var r=this.trajectory.getPositionByEpoch(e,this.referenceFrame);n.push(r),n.push(r),i.push(1),i.push(0)}this.threeObj.visible=!0,this.updateGeometry(n,i,.4),this.threeObj.position.copy(S.a.getVisualCoords(a)),this.threeObj.quaternion.copy(this.referenceFrame.getQuaternionByEpoch(e).toThreejs()),Object(j.a)(Object(h.a)(t.prototype),"render",this).call(this,e)}else this.threeObj.visible=!1}},{key:"findPointByEpoch",value:function(e){var t=0,a=this.epochs.length-1,n=Math.floor((t+a)/2);do{if(this.epochs[n]<e)t=n;else{if(!(this.epochs[n]>e))return n;a=n}n=Math.floor((t+a)/2)}while(n!=t);return e-this.epochs[n]>this.epochs[n+1]-e?n+1:n}},{key:"initVertices",value:function(){var e=this.trajectory,t=this.minStep,a=e.minEpoch,n=e.getStateByEpoch(a,this.referenceFrame),i=n.velocity.unit_();this.positions=[n.position],this.epochs=[a];for(var s=1;a<e.maxEpoch;){for(var r=void 0,o=void 0,c=null,l=20;;){var h=a+t>e.maxEpoch?e.maxEpoch:a+t;t=h-a;var u=e.getStateByEpoch(h,this.referenceFrame),m=u._position.sub(n._position),d=m.mag,p=m.dot(i)/d;if(h!=e.maxEpoch){var f=h+t>e.maxEpoch?e.maxEpoch:h+t,v=e.getStateByEpoch(f,this.referenceFrame)._position.sub(u._position);p=Math.min(p,m.dot(v)/d/v.mag)}if(p<this.minCos){if(!0===c)break;t/=2,c=!1}else{if(r=u,o=h,d,!1===c||h===e.maxEpoch)break;t*=2,c=!0}if(0===--l||Math.abs(t)<this.minStep){t=this.minStep*Math.sign(t),void 0===r&&(r=u,o=h,d);break}}this.epochs[s]=o,this.positions[s]=r.position,i=(n=r).velocity.unit_(),a=o,s++}}}]),t}(w.a),A=a(29),P=function(e){function t(e,a){var i;return Object(n.a)(this,t),(i=Object(l.a)(this,Object(h.a)(t).call(this))).setReferenceFrame(e),i.pos=a,i}return Object(u.a)(t,e),Object(i.a)(t,[{key:"getStateInOwnFrameByEpoch",value:function(e){return this.validateEpoch(e),new g.a(this.pos)}}]),t}(a(36).a),N=function(){function e(){Object(n.a)(this,e)}return Object(i.a)(e,null,[{key:"create",value:function(e){var t,a,n=e.type;if("keplerian"===n)t=this.createKeplerianBasic(e);else if("keplerian_precessing"===n)t=this.createKeplerianPrecessing(e);else if("keplerian_array"===n)t=this.createKeplerianArray(e);else if("keplerian_precessing_array"===n)t=this.createKeplerianPrecessingArray(e);else if("composite"===n)t=this.createComposite(e);else if("static"===n)t=this.createStatic(e);else{t=new(S.a.getClass(n))(e.data)}return void 0!==e.periodStart&&(t.minEpoch=e.periodStart),void 0!==e.periodEnd&&(t.maxEpoch=e.periodEnd),e.rendering&&(e.visual=e.rendering),void 0!==e.visual&&(e.visual.keplerianModel?a=new A.a(t,e.visual):e.visual.pointArrayModel&&(a=new T(t,e.visual))),a&&t.setVisualModel(a),t}},{key:"createComposite",value:function(e){var t=new k.a,a=!0,n=!1,i=void 0;try{for(var s,r=e.data[Symbol.iterator]();!(a=(s=r.next()).done);a=!0){var o=s.value;t.addComponent(this.create(o))}}catch(c){n=!0,i=c}finally{try{a||null==r.return||r.return()}finally{if(n)throw i}}return t}},{key:"createKeplerianArray",value:function(e){var t=new E(e.data.referenceFrame),a=!0,n=!1,i=void 0;try{for(var s,r=e.data.elementsArray[Symbol.iterator]();!(a=(s=r.next()).done);a=!0){var o=s.value;t.addState(this.createKeplerianObject(o,e.data.mu))}}catch(c){n=!0,i=c}finally{try{a||null==r.return||r.return()}finally{if(n)throw i}}return t}},{key:"createKeplerianPrecessingArray",value:function(e){var t=new O(e.data.referenceFrame,e.data.radius,e.data.j2),a=!0,n=!1,i=void 0;try{for(var s,r=e.data.elementsArray[Symbol.iterator]();!(a=(s=r.next()).done);a=!0){var o=s.value;t.addState(this.createKeplerianObject(o,e.data.mu))}}catch(c){n=!0,i=c}finally{try{a||null==r.return||r.return()}finally{if(n)throw i}}return t}},{key:"createKeplerianBasic",value:function(e){return new _.a(e.data.referenceFrame,this.createKeplerianObject(e.data.elements))}},{key:"createKeplerianPrecessing",value:function(e){return new M(e.data.referenceFrame,this.createKeplerianObject(e.data.elements),e.data.radius,e.data.j2)}},{key:"createStatic",value:function(e){return new P(e.data.referenceFrame,new d.c(e.data.position))}},{key:"createKeplerianObject",value:function(e,t){return new b.a(e[0],e[1]/(1-e[0]),e[2],e[3],e[4],e[5],e[6],t||e[7],!1)}}]),e}(),B=a(5),C=a(18),D=function(e){function t(e){var a;Object(n.a)(this,t),a=Object(l.a)(this,Object(h.a)(t).call(this));var i=new B.i,s=!0,r=!1,o=void 0;try{for(var c,u=e[Symbol.iterator]();!(s=(c=u.next()).done);s=!0){var m=c.value;i.vertices.push(new B.F(1e12*Math.cos(Object(d.f)(m[0]))*Math.cos(Object(d.f)(m[1])),1e12*Math.sin(Object(d.f)(m[0]))*Math.cos(Object(d.f)(m[1])),1e12*Math.sin(Object(d.f)(m[1])))),i.colors.push(new B.f(m[2]/50,m[2]/50,m[2]/50))}}catch(p){r=!0,o=p}finally{try{s||null==u.return||u.return()}finally{if(r)throw o}}return a.setThreeObj(new B.u(i,new B.v({vertexColors:B.G,size:2,sizeAttenuation:!1}))),a.threeObj.quaternion.copy(new d.a([-1,0,0],Object(d.f)(23.4)).toThreejs()),a}return Object(u.a)(t,e),t}(C.a),x=function(e){function t(e,a){var i;return Object(n.a)(this,t),(i=Object(l.a)(this,Object(h.a)(t).call(this))).visible=!0,i.parameters=Object.assign({},t.DEFAULT_SETTINGS,a),i.functionOfEpoch=e,i.canvas=document.createElement("canvas"),i.setThreeObj(new B.B(new B.C({map:new B.d(i.canvas)}))),i.setText(i.parameters.text),i}return Object(u.a)(t,e),Object(i.a)(t,[{key:"setText",value:function(e){var t=this.canvas.getContext("2d");t.font=this.parameters.fontSize+"px "+this.parameters.font;var a=t.measureText(e).width,n=this.parameters.fontSize*(1+this.parameters.margin)*2;this.canvas.width=B.l.ceilPowerOfTwo(a),this.canvas.height=B.l.ceilPowerOfTwo(n),t.font=this.parameters.fontSize+"px "+this.parameters.font,t.fillStyle=this.parameters.color,t.textAlign="center",t.textBaseline="bottom",t.fillText(e,this.canvas.width/2,this.parameters.fontSize+(this.canvas.height-n)/2),this.threeObj.material.map.needsUpdate=!0}},{key:"render",value:function(e){if(this.visible){this.threeObj.position.copy(S.a.getVisualCoords(this.functionOfEpoch.evaluate(e)));var t=this.threeObj.position.length(),a=this.calculateScaleCoeff(t,this.parameters.scaling)/2;this.threeObj.scale.x=this.canvas.width*a,this.threeObj.scale.y=this.canvas.height*a,this.threeObj.visible=1<Math.max(this.threeObj.scale.x,this.threeObj.scale.y)/(t*S.a.raycaster.getPixelAngleSize())/2}else this.threeObj.visible=!1}},{key:"calculateScaleCoeff",value:function(e,a){return"string"===typeof a.callback?t.scalingFunctions[a.callback](e,a.range):a.callback(e,a.range)}}]),t}(C.a);x.DEFAULT_SETTINGS={text:"",font:"Arial",color:"white",fontSize:32,margin:0,scaling:{range:{from:3e4,to:7e5},callback:"range"}},x.scalingFunctions={alwaysVisible:function(e){return e*S.a.raycaster.getPixelAngleSize()},range:function(e,t){return e<t.from?t.from*S.a.raycaster.getPixelAngleSize():e>t.to?t.to*S.a.raycaster.getPixelAngleSize():e*S.a.raycaster.getPixelAngleSize()}};var I=a(10),L=a(21),R=function(e){function t(e,a){var i;return Object(n.a)(this,t),(i=Object(l.a)(this,Object(h.a)(t).call(this))).shape=e,i.color=a.color,i.body=null,i.setThreeObj(i.getThreeObj()),i.threeObj.add(new B.c(2*e.radius)),i}return Object(u.a)(t,e),Object(i.a)(t,[{key:"getThreeObj",value:function(){return new B.n(this.shape.getThreeGeometry(),this.getMaterial({color:this.color,wireframe:!0}))}},{key:"setObject",value:function(e){var t=this;this.body=e,this.label=new x(new L.a(function(a){return e.getPositionByEpoch(a).add_(S.a.camera.getTopDirection(a).mul_(t.shape.getMaxDimension()/2))}),{text:this.body.name,margin:.3,scaling:this.body.type===v.a.TYPE_STAR||this.body.type===v.a.TYPE_PLANET?{callback:"alwaysVisible"}:this.body.type===v.a.TYPE_PLANETOID||this.body.type===v.a.TYPE_SATELLITE?{callback:"range",range:{from:5*this.shape.getMaxDimension(),to:1e3*this.shape.getMaxDimension()}}:x.DEFAULT_SETTINGS.scaling})}},{key:"getMaterial",value:function(e){return new B.p(e)}},{key:"drop",value:function(){this.label&&this.label.drop(),Object(j.a)(Object(h.a)(t.prototype),"drop",this).call(this)}},{key:"render",value:function(e){this.label&&(this.label.visible=S.a.settings.ui.showBodyLabels),this.threeObj.position.copy(S.a.getVisualCoords(this.body.getPositionByEpoch(e))),this.threeObj.quaternion.copy(this.body.orientation.getQuaternionByEpoch(e).toThreejs())}}]),t}(C.a),F=function(e){function t(e,a){var i;return Object(n.a)(this,t),(i=Object(l.a)(this,Object(h.a)(t).call(this,e,a))).texturePath=a.texturePath,i.isTextureRequested=!1,i}return Object(u.a)(t,e),Object(i.a)(t,[{key:"getMaterial",value:function(e){return e.metalness=0,e.roughness=1,new B.p(e)}},{key:"render",value:function(e){var a=this;Object(j.a)(Object(h.a)(t.prototype),"render",this).call(this,e),!this.isTextureRequested&&this.texturePath&&this.shape.getMaxDimension()/this.threeObj.position.length()>S.a.raycaster.getPixelAngleSize()&&(this.isTextureRequested=!0,S.a.textureLoader.load(C.a.texturePath+this.texturePath,function(e){a.threeObj.material.dispose(),a.threeObj.material=a.getMaterial({map:e})},void 0,function(e){console.log(e)}))}}]),t}(R),q=function(e){function t(e,a){var i;return Object(n.a)(this,t),(i=Object(l.a)(this,Object(h.a)(t).call(this,e,a))).light=new B.t(a.lightColor,a.lightIntensity,a.lightDistance||null,a.lightDecay||null),i.scene.add(i.light),i}return Object(u.a)(t,e),Object(i.a)(t,[{key:"render",value:function(e){Object(j.a)(Object(h.a)(t.prototype),"render",this).call(this,e),this.light.position.copy(S.a.getVisualCoords(this.body.getPositionByEpoch(e)))}},{key:"getMaterial",value:function(e){return new B.o(e)}},{key:"drop",value:function(){this.scene.remove(this.light),Object(j.a)(Object(h.a)(t.prototype),"drop",this).call(this)}}]),t}(F),V=function(e){function t(e,a){var i;return Object(n.a)(this,t),(i=Object(l.a)(this,Object(h.a)(t).call(this,e,a))).texturePath=a.texturePath,i.ringsRadius=a.ringsRadius,i.ringsColorMapPath=a.ringsColorMapPath,i.ringsAlphaMapPath=a.ringsAlphaMapPath,i.isTextureRequested=!1,i}return Object(u.a)(t,e),Object(i.a)(t,[{key:"getThreeObj",value:function(){var e=new B.q;return this.bodyThreeObj=new B.n(this.shape.getThreeGeometry(),this.getMaterial({color:this.color,wireframe:!0})),this.ringsThreeObj=new B.n(new B.e(140220,64),this.getMaterial({color:this.color,wireframe:!0})),e.add(this.bodyThreeObj),e.add(this.ringsThreeObj),e}},{key:"updateRingsMaterial",value:function(){this.ringsColorMap&&this.ringsAlphaMap&&(this.ringsThreeObj.material.dispose(),this.ringsThreeObj.material=this.getMaterial({map:this.ringsColorMap,alphaMap:this.ringsAlphaMap,side:B.g,transparent:!0}))}},{key:"getMaterial",value:function(e){return e.metalness=0,e.roughness=1,new B.p(e)}},{key:"render",value:function(e){var a=this;Object(j.a)(Object(h.a)(t.prototype),"render",this).call(this,e),!this.isTextureRequested&&this.texturePath&&this.shape.getMaxDimension()/this.threeObj.position.length()>S.a.raycaster.getPixelAngleSize()&&(this.isTextureRequested=!0,S.a.textureLoader.load(C.a.texturePath+this.texturePath,function(e){a.bodyThreeObj.material.dispose(),a.bodyThreeObj.material=a.getMaterial({map:e})},void 0,function(e){console.log(e)}),S.a.textureLoader.load(C.a.texturePath+this.ringsColorMapPath,function(e){a.ringsColorMap=e,a.updateRingsMaterial()},void 0,function(e){console.log(e)}),S.a.textureLoader.load(C.a.texturePath+this.ringsAlphaMapPath,function(e){a.ringsAlphaMap=e,a.updateRingsMaterial()},void 0,function(e){console.log(e)}))}}]),t}(R),Y=function(e){function t(e,a){var i;return Object(n.a)(this,t),(i=Object(l.a)(this,Object(h.a)(t).call(this))).radius=e,i.segments=a,i}return Object(u.a)(t,e),Object(i.a)(t,[{key:"getThreeGeometry",value:function(){return this.threeGeometry||(this.threeGeometry=new B.A(this.radius,2*this.segments,this.segments),this.threeGeometry.rotateX(Math.PI/2)),this.threeGeometry}},{key:"getMaxDimension",value:function(){return 2*this.radius}}]),t}(function(){function e(){Object(n.a)(this,e)}return Object(i.a)(e,[{key:"getThreeGeometry",value:function(){}},{key:"getMaxDimension",value:function(){}}]),e}());a.d(t,"a",function(){return U});var U=function(){function e(){Object(n.a)(this,e)}return Object(i.a)(e,null,[{key:"loadFromConfig",value:function(e,t){e.name=t.name,e.mainObject=t.mainObject,e.addObject(0,new v.a(0,v.a.TYPE_POINT,"Star system barycenter"));var a=!0,n=!1,i=void 0;try{for(var s,r=t.objects[Symbol.iterator]();!(a=(s=r.next()).done);a=!0){var c=s.value;this._loadObject(e,c)}}catch(O){n=!0,i=O}finally{try{a||null==r.return||r.return()}finally{if(n)throw i}}I.a.dispatch(I.a.LOADING_BODIES_DONE),e.addReferenceFrame(o.b);var l=!0,h=!1,u=void 0;try{for(var m,d=t.referenceFrames[Symbol.iterator]();!(l=(m=d.next()).done);l=!0){var p=m.value;e.addReferenceFrame(o.d.create(p.id,p.type,p.config))}}catch(O){h=!0,u=O}finally{try{l||null==d.return||d.return()}finally{if(h)throw u}}I.a.dispatch(I.a.LOADING_FRAMES_DONE);var f=!0,y=!1,b=void 0;try{for(var g,E=t.objects[Symbol.iterator]();!(f=(g=E.next()).done);f=!0){var j=g.value;e.getObject(j.id).setTrajectory(N.create(j.trajectory))}}catch(O){y=!0,b=O}finally{try{f||null==E.return||E.return()}finally{if(y)throw b}}I.a.dispatch(I.a.LOADING_TRAJECTORIES_DONE),e.addStars(new D(t.stars))}},{key:"loadObjectByUrl",value:function(e,t){var a=this;r.a.getJSON(t,function(t){a._loadObject(e,t),e.getObject(t.id).setTrajectory(N.create(t.trajectory))})}},{key:"_loadObject",value:function(e,t){var a,n=null,i=null,s=null;if(t.visual){var r=new Y(t.visual.config.radius,t.visual.config.texturePath?32:12),o={basic:F,light:q,rings:V}[t.visual.model];void 0!==o&&(n=new o(r,t.visual.config))}(t.physical||t.orientation)&&(t.orientation||(t.orientation={type:"constantAxis",config:{vector:[0,0,1e-11]}}),s=new("constantAxis"===t.orientation.type?p:S.a.getClass(t.orientation.type))(t.orientation.config));t.physical&&(i=new f(t.physical)),a=n||i||s?new c.a(t.id,t.type||v.a.TYPE_UNKNOWN,t.name,t.data,n,i,s):new v.a(t.id,t.type||v.a.TYPE_UNKNOWN,t.name,t.data),e.addObject(t.id,a)}}]),e}()},,,,,,,,,,,,,,function(e,t,a){e.exports=a(125)},,,,,function(e,t,a){var n={"./KSP/ModuleKSP":[65,1],"./KSP/ModuleKSP.js":[65,1],"./PatchedConics/ModulePatchedConics":[66,2],"./PatchedConics/ModulePatchedConics.js":[66,2],"./PatchedConics/PropagatorPatchedConics":[62,3],"./PatchedConics/PropagatorPatchedConics.js":[62,3],"./SolarSystem/ModuleSolarSystem":[60,0],"./SolarSystem/ModuleSolarSystem.js":[60,0],"./SolarSystem/Orientation/IAUModel":[61,4],"./SolarSystem/Orientation/IAUModel.js":[61,4],"./SolarSystem/Trajectory/ELP2000":[63,0],"./SolarSystem/Trajectory/ELP2000.js":[63,0],"./SolarSystem/Trajectory/VSOP87":[64,0],"./SolarSystem/Trajectory/VSOP87.js":[64,0]};function i(e){var t=n[e];return t?a.e(t[1]).then(function(){var e=t[0];return a(e)}):Promise.resolve().then(function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t})}i.keys=function(){return Object.keys(n)},i.id=72,e.exports=i},function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,,,,,,,,,,,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){},,function(e,t,a){"use strict";a.r(t);var n=a(2),i=a(3),s=a(7),r=a(4),o=a(6),c=a(0),l=a.n(c),h=a(31),u=a.n(h),m=a(26),d=a(33);var p=a(28),f={SIMULATION:"Simulation",EDIT:"Edit",VIEW:"View",SETTINGS:"Settings",HELP:"Help"},v="https://github.com/tossha/urbain/wiki/%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-Urbain";var y={NONE:0,LINK:1,DROPDOWN:2},b=function(){function e(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:y.NONE;Object(n.a)(this,e),this.label=t,this.type=a}return Object(i.a)(e,[{key:"isClickable",get:function(){return!0}}]),e}(),g=function(e){function t(e){var a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=i.href,c=void 0===o?"":o,l=i.target,h=void 0===l?"_self":l;return Object(n.a)(this,t),(a=Object(s.a)(this,Object(r.a)(t).call(this,e,y.LINK))).href=c,a.target=h,a}return Object(o.a)(t,e),Object(i.a)(t,[{key:"isClickable",get:function(){return Boolean(this.href)}}]),t}(b),E=function(e){function t(e){var a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Object(n.a)(this,t),(a=Object(s.a)(this,Object(r.a)(t).call(this,e,y.DROPDOWN))).onSelect=function(e){a.options=a.options.map(function(t){var a=Object(p.a)({},t,{selected:e===t.label?!t.selected:t.selected});return e===t.label&&t.onUpdate&&t.onUpdate(a),a})},a.options=i,a}return Object(o.a)(t,e),t}(b),j=function(){function e(t){var a=this;Object(n.a)(this,e),this.viewSettings={showStatistics:!1,showBodyLabels:!0,showOrbitCreationPanel:!1,showTransferCalculationPanel:!1},this.topMenu=[new E(f.SIMULATION,[{label:"Orbit creation panel",selected:this.viewSettings.showOrbitCreationPanel,onUpdate:function(e){var t=e.selected;a.viewSettings.showOrbitCreationPanel=t}},{label:"Transfer calculation panel",selected:this.viewSettings.showTransferCalculationPanel,onUpdate:function(e){var t=e.selected;a.viewSettings.showTransferCalculationPanel=t}}]),new g(f.EDIT),new E(f.VIEW,[{label:"Body Labels",selected:this.viewSettings.showBodyLabels,onUpdate:function(e){var t=e.selected;a._simulation.settings.ui.showBodyLabels=t,a.viewSettings.showBodyLabels=t}},{label:"Statistics badge",selected:!1,onUpdate:function(e){var t=e.selected;a.viewSettings.showStatistics=t}}]),new g(f.HELP,{href:v,target:"_blank"})],this._simulation=t}return Object(i.a)(e,[{key:"starSystemSelectorSettings",get:function(){var e=this._simulation.starSystemManager;return{options:e.starSystems,defaultValue:e.defaultStarSystem,onSelect:function(t){return e.loadByIdx(t.idx)}}}}]),e}(),O=function(e){var t=l.a.createContext(e);return{Provider:t.Provider,Consumer:t.Consumer}}(),_=O.Provider,M=O.Consumer,k=a(20),w=a(54),S=a.n(w),T=(a(73),function(e){function t(){var e,a;Object(n.a)(this,t);for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];return(a=Object(s.a)(this,(e=Object(r.a)(t)).call.apply(e,[this].concat(o)))).elementRef=l.a.createRef(),a}return Object(o.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){this.elementRef.current.appendChild(this.props.stats.dom)}},{key:"componentWillUnmount",value:function(){this.elementRef=null}},{key:"render",value:function(){return l.a.createElement("div",{ref:this.elementRef,className:"statistics-badge"})}}]),t}(c.Component)),A=function(){return l.a.createElement(M,null,function(e){var t=e.store,a=e.stats;return t.viewSettings.showStatistics?l.a.createElement(T,{stats:a}):null})};a(75);var P=a(14),N=a.n(P),B=(a(77),function(e){var t=e.className;return l.a.createElement("div",{className:t})}),C=a(11),D=a.n(C),x=a(38),I="var(--black)",L="var(--white-text)",R=24,F={container:function(e){return Object(p.a)({},e,{background:I,color:L,minHeight:R,height:R,minWidth:50})},control:function(e){return Object(p.a)({},e,{background:I,borderRadius:0,borderStyle:"none",minHeight:R,height:R})},menu:function(e){return Object(p.a)({},e,{borderRadius:0,marginTop:0,marginBottom:0})},menuList:function(e){return Object(p.a)({},e,{background:"var(--dark-gray)"})},option:function(e,t){return Object(p.a)({},e,{backgroundColor:t.isFocused?"var(--gray)":"transparent"})},singleValue:function(e,t){var a=t.isDisabled?.5:1;return Object(p.a)({},e,{color:L,opacity:a,transition:"opacity 300ms"})},dropdownIndicator:function(){return{padding:0,background:'url("/images/chevron-down-solid.svg") 0 0 no-repeat',marginRight:5,height:10,width:10}},indicatorSeparator:function(){return{display:"none"}}},q=function(e){return x.a.IndicatorsContainer&&l.a.createElement(x.a.IndicatorsContainer,e)},V=function(e){return x.a.DropdownIndicator&&l.a.createElement(x.a.DropdownIndicator,e,l.a.createElement("span",null))},Y=(D.a.shape({label:D.a.string,value:D.a.string}),function(e){var t=e.id,a=e.className,n=e.options,i=e.value,s=e.onSelect,r=void 0===s?function(){}:s;return l.a.createElement(x.b,{id:t,className:a,classNamePrefix:"select",placeholder:"",styles:F,isSearchable:!1,options:n,defaultValue:i,components:{IndicatorsContainer:q,DropdownIndicator:V},onChange:r})});a(89);function U(e){var t=e.options,a=e.defaultValue,n=e.onSelect;return l.a.createElement("div",{className:"star-system-selector"},l.a.createElement("div",{className:"star-system-selector__label"},"Star system"),l.a.createElement(Y,{className:"star-system-selector__selector",options:t,value:a||t[0],onSelect:n}))}var z=function(){return l.a.createElement(M,null,function(e){var t=e.store.starSystemSelectorSettings,a=t.options,n=t.defaultValue,i=t.onSelect;return l.a.createElement(U,{options:a,defaultValue:n,onSelect:i})})},H=(a(91),a(24)),Q=function(e){function t(){var e,a;Object(n.a)(this,t);for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];return(a=Object(s.a)(this,(e=Object(r.a)(t)).call.apply(e,[this].concat(o)))).handleClick=function(){a.props.onClick(a.props.text)},a}return Object(o.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.text,a=e.selected;return l.a.createElement("li",{className:"drop-down-menu__menu-item",onClick:this.handleClick},l.a.createElement("span",{className:"drop-down-menu__menu-item-icon"},a&&l.a.createElement(H.a,{icon:"check"})),t)}}]),t}(c.Component),K=(a(93),function(e){function t(){var e,a;Object(n.a)(this,t);for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];return(a=Object(s.a)(this,(e=Object(r.a)(t)).call.apply(e,[this].concat(o)))).handleSelect=function(e){var t=a.props,n=t.store,i=t.updateStore,s=t.text;n.topMenu.find(function(e){return e.label===s}).onSelect(e),i(n)},a}return Object(o.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this,t=this.props,a=t.text,n=t.options,i=n.length>0;return l.a.createElement("ul",{className:"drop-down-menu"},l.a.createElement("li",null,l.a.createElement("span",{className:"drop-down-menu__toggler"},a,i&&l.a.createElement(H.a,{className:"drop-down-menu__caret",icon:"chevron-down"})),i&&l.a.createElement("ul",{className:"drop-down-menu__menu"},n.map(function(t){var a=t.label,n=t.selected,i=t.onClick;return l.a.createElement(Q,{key:a,selected:n,text:a,onClick:i||e.handleSelect})}))))}}]),t}(c.Component)),G=function(e){return l.a.createElement(M,null,function(t){var a=t.store,n=t.updateStore,i=a.topMenu.find(function(t){return t.label===e.text}),s=i?i.options:[];return l.a.createElement(K,Object.assign({},e,{store:a,updateStore:n,options:s}))})},W=function(e){var t=e.text,a=e.href,n=e.className,i=void 0===n?"":n,s=e.target,r=void 0===s?"_self":s;return l.a.createElement("a",{className:"main-menu__link ".concat(i),href:a,target:r},t)};function X(e){var t=e.menuItem,a=e.clickable;return l.a.createElement("div",{className:"main-menu__item"},l.a.createElement("div",{className:N()(a&&"main-menu__clickable-zone")},t.type===y.LINK&&l.a.createElement(W,Object.assign({text:t.label},t)),t.type===y.DROPDOWN&&l.a.createElement(G,Object.assign({text:t.label},t))))}var Z=function(){return l.a.createElement("nav",{className:"main-menu"},l.a.createElement(M,null,function(e){return e.store.topMenu.map(function(e){return l.a.createElement(X,{key:e.label,menuItem:e,clickable:e.isClickable})})}))},J=function(e){var t=e.className;return l.a.createElement("header",{className:N()(t,"header","noselect")},l.a.createElement("div",{className:"header__logo-wrapper"},l.a.createElement(B,{className:"header__logo"})),l.a.createElement("div",{className:"header__top-menu"},l.a.createElement(Z,null)),l.a.createElement("div",{className:"header__star-system-selector"},l.a.createElement(z,null)))};a(95),a(97),a(99),a(101);function $(e){var t=e.direction,a=N()("arrow-logo","arrow-logo--to-".concat(t));return l.a.createElement("svg",{className:a,role:"img",width:"10",height:"8",viewBox:"0 0 10 8",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l.a.createElement("path",{d:"M1.50359 3.64645C1.30833 3.84171 1.30833 4.15829 1.50359 4.35355L4.68557 7.53553C4.88083 7.7308 5.19741 7.7308 5.39268 7.53553C5.58794 7.34027 5.58794 7.02369 5.39268 6.82843L2.56425 4L5.39268 1.17157C5.58794 0.97631 5.58794 0.659728 5.39268 0.464466C5.19741 0.269204 4.88083 0.269203 4.68557 0.464466L1.50359 3.64645ZM1.5 8V0H0.5V8H1.5ZM10 3.5L1.85714 3.5L1.85714 4.5L10 4.5L10 3.5Z",fill:"#8F9193"}))}var ee=function(){return l.a.createElement("svg",{role:"img",width:"10",height:"8",viewBox:"0 0 10 8",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l.a.createElement("path",{d:"M3 3V1H9V5H7M7 5V7H1V3H7V5Z",stroke:"#8F9193",strokeWidth:"0.5"}))},te=function(e){var t=e.isCollapsed,a=e.onClick,n=(e.isToRight,e.className),i=void 0===n?"":n,s=e.collapseDirection,r=void 0===s?"left":s;return l.a.createElement("button",{type:"button",className:i,onClick:a},t?l.a.createElement(ee,null):l.a.createElement($,{direction:r}))},ae=(a(103),function(e){function t(){var e,a;Object(n.a)(this,t);for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];return(a=Object(s.a)(this,(e=Object(r.a)(t)).call.apply(e,[this].concat(o)))).state={isCollapsed:a.props.collapsedByDefault},a.handleToggle=function(){a.setState(function(e){return{isCollapsed:!e.isCollapsed}})},a}return Object(o.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.id,a=e.className,n=e.caption,i=e.hideCollapseButton,s=e.children,r=e.titleIcon,o=e.hidden,c=e.collapseDirection,h=this.state.isCollapsed,u=N()("panel","noselect",{"panel--hidden":o,"panel--collapsed":h},a);return l.a.createElement("div",{id:t,className:u},l.a.createElement("div",{className:"panel__header"},l.a.createElement("div",{className:"panel__caption"},r&&l.a.createElement("span",{className:"panel__caption-icon"},r),l.a.createElement("span",{className:"panel__caption-text"},n)),!i&&l.a.createElement(te,{className:"panel__collapse-button",onClick:this.handleToggle,isCollapsed:h,collapseDirection:c})),l.a.createElement("div",{style:{display:h?"none":"block"},className:"panel__content"},s))}}]),t}(c.Component));ae.defaultProps={caption:"",hideCollapseButton:!1,className:"",id:"",collapsedByDefault:!1,hidden:!1,collapseDirection:"left"};var ne=ae,ie=function(e){var t=e.className;return l.a.createElement(ne,{id:"cameraPanel",className:"camera-panel ".concat(t),caption:"Camera",titleIcon:l.a.createElement(H.a,{icon:"expand"}),collapseDirection:"right"},l.a.createElement("div",{className:"camera-panel__content"},l.a.createElement("label",{className:"panel__field camera-panel__field"},l.a.createElement("span",{className:"panel__field-label"},"Target:"),l.a.createElement("select",{className:"camera-panel__field-control",id:"targetSelect"})),l.a.createElement("label",{className:"panel__field camera-panel__field"},l.a.createElement("span",{className:"panel__field-label"},"Frame type:"),l.a.createElement("select",{className:"camera-panel__field-control",id:"rfTypeSelect"}))))};a(105);var se=function(e){var t=e.className;return l.a.createElement("canvas",{className:"time-line ".concat(t),id:"timeLineCanvas"})},re=(a(107),function(e){function t(e){var a;return Object(n.a)(this,t),(a=Object(s.a)(this,Object(r.a)(t).call(this,e))).state={isTimeRunning:!0},a.handleClick=function(){var e=k.c.time;e&&e.togglePause()},document.addEventListener(k.a.TIME_PAUSED,function(){a.setState({isTimeRunning:!1})}),document.addEventListener(k.a.TIME_UNPAUSED,function(){a.setState({isTimeRunning:!0})}),a}return Object(o.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.state.isTimeRunning;return l.a.createElement("div",{role:"button",className:N()("pause-button","noselect",{"pause-button--paused":!e},this.props.className),onClick:this.handleClick},l.a.createElement("div",null,l.a.createElement(H.a,{className:"pause-button__icon",icon:e?"pause":"play"})),l.a.createElement("div",null,e?"Pause":"Resume"))}}]),t}(c.Component)),oe=function(e){var t=e.className;return l.a.createElement("svg",{className:t,role:"img",width:"4",height:"9",viewBox:"0 0 4 9",fill:"none",xmlns:"http://www.w3.org/2000/svg"},l.a.createElement("path",{d:"M3.71197 2.33602L3.58397 3.42402H2.35197L1.96797 6.14402C1.92531 6.38936 1.92531 6.57069 1.96797 6.68802C2.01064 6.80536 2.11731 6.86402 2.28797 6.86402C2.46931 6.86402 2.62397 6.84269 2.75197 6.80002C2.87997 6.74669 2.96531 6.71469 3.00797 6.70402V7.76002C2.96531 7.77069 2.90131 7.79736 2.81597 7.84002C2.73064 7.88269 2.63464 7.92536 2.52797 7.96802C2.26131 8.08536 1.96264 8.14402 1.63197 8.14402C1.11997 8.14402 0.773306 8.01069 0.591973 7.74402C0.410639 7.46669 0.362639 7.00269 0.447973 6.35202L0.879973 3.42402H0.271973L0.415973 2.33602H1.02397L1.21597 0.976023L2.73597 0.736023L2.49597 2.33602H3.71197Z",fill:"#A1A1A3"}))};a(109);var ce=function(e){var t=e.className;return l.a.createElement(ne,{className:"time-settings-panel ".concat(t),id:"timePanel","data-panel-name":"time",caption:"Time",titleIcon:l.a.createElement(oe,{className:"time-settings-panel__logo"})},l.a.createElement("div",{className:"time-settings-panel__content"},l.a.createElement("label",{className:"panel__field time-settings-panel__field"},l.a.createElement("span",{className:"panel__field-label"},"Current:"),l.a.createElement("time",{id:"currentDateValue"},"01.01.2000 12:00:00"),l.a.createElement("button",{type:"button",className:"panel__button",id:"useCurrentTime"},"Now")),l.a.createElement("label",{className:"panel__field time-settings-panel__field"},l.a.createElement("span",{className:"panel__field-label"},"Rate:"),l.a.createElement("span",{id:"timeScaleValue"}),l.a.createElement("button",{type:"button",className:"panel__button",id:"setRealTimeScale"},"Real")),l.a.createElement("label",{className:"panel__field time-settings-panel__field"},l.a.createElement("input",{id:"timeScaleSlider",type:"range",className:"time-settings-panel__scale-slider",min:"-1",max:"1",step:"0.001",defaultValue:"0.001",style:{width:"100%"}}))))};var le=function(e){var t=e.className;return l.a.createElement("div",{className:N()(t,"bottom-panel")},l.a.createElement(ce,{className:"bottom-panel__time-settings-panel"}),l.a.createElement(re,{className:"bottom-panel__pause-button"}),l.a.createElement("div",{className:"bottom-panel__time-line-container"},l.a.createElement(se,{className:"bottom-panel__time-line"})),l.a.createElement(ie,{className:"bottom-panel__camera-panel"}),l.a.createElement(A,null))},he=function(e){var t=e.className;return l.a.createElement(M,null,function(e){var a=e.store;return l.a.createElement(ne,{className:t,id:"creationPanel","data-panel-name":"creation",caption:"Orbit creation",hidden:!a.viewSettings.showOrbitCreationPanel},l.a.createElement("div",{style:{height:44}},l.a.createElement("label",{className:"panel__field"},"Create Orbit: ",l.a.createElement("button",{id:"createOrbit"},"Create"))))})},ue=(a(111),function(e){var t=e.className;return l.a.createElement(M,null,function(e){var a=e.store;return l.a.createElement(ne,{className:N()(t,"transfer-calculation-panel"),id:"lambertPanel",caption:"Transfer calculation",hidden:!a.viewSettings.showTransferCalculationPanel},l.a.createElement("div",{className:"panel__field-set"},l.a.createElement("label",{className:"panel__field"},l.a.createElement("span",{className:"panel__field-label"},"Origin:"),l.a.createElement("select",{className:"panel__field-control",id:"originSelect"})),l.a.createElement("label",{className:"panel__field"},l.a.createElement("span",{className:"panel__field-label"},"Target:"),l.a.createElement("select",{className:"panel__field-control",id:"targetSelect"})),l.a.createElement("label",{className:"panel__field"},l.a.createElement("span",{className:"panel__field-label"},"Transfer type:"),l.a.createElement("span",{className:"panel__field-control"},"Ballistic")),l.a.createElement("label",{className:"panel__field"},l.a.createElement("span",{className:"panel__field-label"},"Departure:"),l.a.createElement("time",{id:"departureDateValue"},"01.01.2000 12:00:00"),l.a.createElement("button",{type:"button",className:"panel__button",id:"useCurrentTime"},"Now")),l.a.createElement("label",{className:"panel__field"},l.a.createElement("span",{className:"panel__field-label"},"Transfer time:"),l.a.createElement("span",{id:"transferTimeValue"})),l.a.createElement("label",{className:"panel__field"},l.a.createElement("input",{id:"transferTimeSlider",type:"range",min:"0",max:"1",step:"0.001",defaultValue:"0.5",style:{width:"100%"}}))),l.a.createElement("div",{className:"transfer-calculation-panel__delta-v-calc panel__field-set","data-panel-name":"lambert"},l.a.createElement("div",{className:"panel__field panel__field-header"},"Delta-V"),l.a.createElement("div",{className:"panel__field"},l.a.createElement("span",{className:"panel__field-label"},"Ejection:"),l.a.createElement("span",{className:"panel__field-control",id:"deltaVEjection"},"0"),l.a.createElement("span",{className:"transfer-calculation-panel__dimension"},"km/s")),l.a.createElement("div",{className:"panel__field"},l.a.createElement("span",{className:"panel__field-label"},"Insertion:"),l.a.createElement("span",{className:"panel__field-control",id:"deltaVInsertion"},"0"),l.a.createElement("span",{className:"transfer-calculation-panel__dimension"},"km/s")),l.a.createElement("div",{className:"panel__field"},l.a.createElement("span",{className:"panel__field-label"},"Total:"),l.a.createElement("span",{className:"panel__field-control",id:"deltaVTotal"},"0"),l.a.createElement("span",{className:"transfer-calculation-panel__dimension"},"km/s"))))})});a(113),a(115);function me(e){var t=e.className,a=void 0===t?"":t;return l.a.createElement("div",{className:N()(a,"keplerian-view")},l.a.createElement("div",{className:"keplerian-view__column"},l.a.createElement("div",{className:"keplerian-view__field"},l.a.createElement("span",{className:"panel__field-label keplerian-view__field-label"},"Ecc"),l.a.createElement("span",{className:"panel__field-control",id:"elements-ecc"}),l.a.createElement("span",{className:"metrics-panel__dimension"})),l.a.createElement("div",{className:"keplerian-view__field"},l.a.createElement("span",{className:"panel__field-label keplerian-view__field-label"},"SMA"),l.a.createElement("span",{className:"panel__field-control",id:"elements-sma"}),l.a.createElement("span",{className:"metrics-panel__dimension"},"km")),l.a.createElement("div",{className:"keplerian-view__field"},l.a.createElement("span",{className:"panel__field-label keplerian-view__field-label"},"Inc"),l.a.createElement("span",{className:"panel__field-control",id:"elements-inc"}),l.a.createElement("span",{className:"metrics-panel__dimension"},"deg.")),l.a.createElement("div",{className:"keplerian-view__field"},l.a.createElement("span",{className:"panel__field-label keplerian-view__field-label"},"AoP"),l.a.createElement("span",{className:"panel__field-control",id:"elements-aop"}),l.a.createElement("span",{className:"metrics-panel__dimension"},"deg."))),l.a.createElement("div",{className:"keplerian-view__column"},l.a.createElement("div",{className:"keplerian-view__field"},l.a.createElement("span",{className:"panel__field-label keplerian-view__field-label"},"RAAN"),l.a.createElement("span",{className:"panel__field-control",id:"elements-raan"}),l.a.createElement("span",{className:"metrics-panel__dimension"},"deg.")),l.a.createElement("div",{className:"keplerian-view__field"},l.a.createElement("span",{className:"panel__field-label keplerian-view__field-label"},"TA"),l.a.createElement("span",{className:"panel__field-control",id:"elements-ta"}),l.a.createElement("span",{className:"metrics-panel__dimension"},"deg.")),l.a.createElement("div",{className:"keplerian-view__field"},l.a.createElement("span",{className:"panel__field-label keplerian-view__field-label"},"Period"),l.a.createElement("span",{className:"panel__field-control",id:"elements-period"}),l.a.createElement("span",{className:"metrics-panel__dimension"},"days"))))}a(117);var de=function(e){var t=e.className,a=e.label,n=void 0===a?"x":a,i=e.valueClassName,s=void 0===i?"vec-x":i,r=e.dimension,o=void 0===r?"km":r;return l.a.createElement("div",{className:N()(t,"vector-component")},l.a.createElement("span",{className:"vector-component__label"},n),l.a.createElement("span",{className:N()("vector-component__value",s)}),l.a.createElement("span",{className:"metrics-panel__dimension vector-component__dimension"},o))};a(119);var pe=function(e){var t=e.className,a=e.onClick,n=e.expanded,i=void 0!==n&&n;return l.a.createElement("button",{type:"button",className:N()(t,"expand-button",{"expand-button--expanded":i}),onClick:a},l.a.createElement(H.a,{className:"expand-button__icon",icon:"chevron-down"}))},fe=(a(121),function(e){function t(){var e,a;Object(n.a)(this,t);for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];return(a=Object(s.a)(this,(e=Object(r.a)(t)).call.apply(e,[this].concat(o)))).state={isExpanded:a.props.isExpanded},a.handleToggle=function(){a.setState(function(e){return{isExpanded:!e.isExpanded}})},a}return Object(o.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.state.isExpanded,t=this.props,a=t.className,n=t.vectorMagnitudeLabel,i=t.dimension;return l.a.createElement("div",{className:N()(a,"panel__field cartesian-vector-view")},l.a.createElement("header",{className:"cartesian-vector-view__header"},l.a.createElement(de,{label:n,valueClassName:"vec-magnitude",dimension:i}),l.a.createElement(pe,{className:"cartesian-vector-view__expand-button",expanded:e,onClick:this.handleToggle})),l.a.createElement("div",{className:N()("cartesian-vector-view__vector-components",{hidden:!e})},l.a.createElement(de,{label:"x",valueClassName:"vec-x",dimension:i}),l.a.createElement(de,{label:"y",valueClassName:"vec-y",dimension:i}),l.a.createElement(de,{label:"z",valueClassName:"vec-z",dimension:i})))}}]),t}(c.Component));fe.defaultProps={isExpanded:!1};var ve=fe,ye=function(){return l.a.createElement(ne,{id:"metricsPanel",className:"metrics-panel",caption:"Metrics",titleIcon:l.a.createElement(H.a,{icon:"bars"}),collapseDirection:"right"},l.a.createElement("div",{className:"metrics-panel__content"},l.a.createElement("div",{className:"panel__field-set"},l.a.createElement("div",{className:"panel__field"},l.a.createElement("span",{className:"panel__field-label"},"Object"),l.a.createElement("span",{className:"panel__field-control",id:"metricsOf"})),l.a.createElement("div",{className:"panel__field"},l.a.createElement("span",{className:"panel__field-label"},"Relative to"),l.a.createElement("span",{className:"panel__field-control",id:"relativeTo"}))),l.a.createElement("div",{className:"panel__field-set"},l.a.createElement("label",{className:"panel__field panel__field--left-aligned"},l.a.createElement("input",{className:"metrics-panel__angles-checker",type:"checkbox",id:"showAnglesOfSelectedOrbit",defaultChecked:!0}),l.a.createElement("span",{className:"panel__field-label"},"Visualize angles"),l.a.createElement("button",{className:"metrics-panel__unload-object-button",type:"button",id:"unloadObject"},"Unload object"))),l.a.createElement("div",{className:"panel__field-set"},l.a.createElement("div",{className:"panel__field panel__field-header"},"Main"),l.a.createElement("div",{className:"panel__field"},l.a.createElement("span",{className:"panel__field-label"},"Orbit"),l.a.createElement("span",{className:"panel__field-control",id:"elements-orbit-alt"}),l.a.createElement("span",{className:"metrics-panel__dimension"},"km")),l.a.createElement("div",{className:"panel__field"},l.a.createElement("span",{className:"panel__field-label"},"Avg height"),l.a.createElement("span",{className:"panel__field-control",id:"elements-orbit-avg"}),l.a.createElement("span",{className:"metrics-panel__dimension"},"km")),l.a.createElement("div",{className:"panel__field"},l.a.createElement("span",{className:"panel__field-label"},"Altitude"),l.a.createElement("span",{className:"panel__field-control",id:"elements-alt"}),l.a.createElement("span",{className:"metrics-panel__dimension"},"km")),l.a.createElement("div",{className:"panel__field"},l.a.createElement("span",{className:"panel__field-label"},"Speed"),l.a.createElement("span",{className:"panel__field-control",id:"elements-speed"}),l.a.createElement("span",{className:"metrics-panel__dimension"},"m/s")),l.a.createElement("div",{className:"panel__field"},l.a.createElement("span",{className:"panel__field-label"},"Precession"),l.a.createElement("span",{className:"panel__field-control",id:"elements-precession"}),l.a.createElement("span",{className:"metrics-panel__dimension"},"deg/day")),l.a.createElement("div",{className:"panel__field",id:"row-node-time",style:{display:"none"}},l.a.createElement("span",{className:"panel__field-label"},"Node local time"),l.a.createElement("span",{className:"panel__field-control",id:"elements-node-time"}),l.a.createElement("span",{className:"metrics-panel__dimension"}))),l.a.createElement("div",{className:"panel__field-set"},l.a.createElement("div",{className:"panel__field panel__field-header"},"Keplerian"),l.a.createElement(me,{className:"panel__field"})),l.a.createElement("div",{className:"panel__field-set"},l.a.createElement("div",{className:"panel__field panel__field-header"},"Cartesian"),l.a.createElement(ve,{className:"metrics-panel__cartesian-position-vector js-metrics-panel-cartesian-position-vector",vectorMagnitudeLabel:"Position",dimension:"km"}),l.a.createElement(ve,{className:"metrics-panel__cartesian-velocity-vector js-metrics-panel-cartesian-velocity-vector",vectorMagnitudeLabel:"Velocity",dimension:"km/s"}))))},be=(a(123),function(e){var t=e.className,a=(e.right,e.children);return l.a.createElement("aside",{className:N()(t,"side-bar")},a)}),ge=function(e){var t=e.className,a=e.children;return l.a.createElement("main",{className:N()(t,"main-view")},l.a.createElement("div",{id:"viewport-id"}),a,l.a.createElement(be,{className:"main-view__left-side-bar"},l.a.createElement(he,{className:"main-view__creation-panel"}),l.a.createElement(ue,{className:"main-view__transfer-calculation-panel"})),l.a.createElement(be,{className:"main-view__right-side-bar",right:!0},l.a.createElement(ye,null)),l.a.createElement(le,{className:"main-view__bottom-panel"}))},Ee=function(e){var t=e.className;return l.a.createElement("footer",{className:"".concat(t," footer")})},je=function(e){function t(){return Object(n.a)(this,t),Object(s.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(o.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return l.a.createElement("div",{className:"app-layout"},l.a.createElement(ge,{className:"app-layout__main"},l.a.createElement(J,{className:"app-layout__header"})),l.a.createElement(Ee,{className:"app-layout__footer"}))}}]),t}(l.a.Component),Oe=function(e){k.c.getModule("SolarSystem").loadTLE(k.c.starSystem,e)},_e=function(){k.c.loadModule("KSP")},Me=function(){function e(t){Object(n.a)(this,e),this._store=new j(t)}return Object(i.a)(e,[{key:"init",value:function(e){Object(k.b)(e)}},{key:"getInitialState",value:function(){return this._store}},{key:"getApi",value:function(){return{loadTLE:Oe,loadKSP:_e}}}]),e}();m.b.add(d.d),m.b.add(d.f),m.b.add(d.e),m.b.add(d.c),m.b.add(d.b),m.b.add(d.a);var ke=function(){var e=new S.a;return e.dom.classList.add("stats-badge"),e}(),we=new Me(k.c),Se=we.getInitialState();window.api=we.getApi();var Te=function(e){function t(){var e,a;Object(n.a)(this,t);for(var i=arguments.length,o=new Array(i),c=0;c<i;c++)o[c]=arguments[c];return(a=Object(s.a)(this,(e=Object(r.a)(t)).call.apply(e,[this].concat(o)))).state={stats:ke,store:a.props.store,updateStore:function(e){a.setState({store:e})}},a}return Object(o.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){return l.a.createElement(_,{value:this.state},l.a.createElement(je,null))}}]),t}(l.a.Component);u.a.render(l.a.createElement(Te,{store:Se}),document.getElementById("root")),we.init(ke)}],[[67,7,6]]]);
//# sourceMappingURL=main.2197a7b8.chunk.js.map