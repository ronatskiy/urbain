(window.webpackJsonp=window.webpackJsonp||[]).push([[2,3],{126:function(e,t,a){"use strict";a.d(t,"a",function(){return o});var i=a(2),r=a(3),o=function(){function e(){Object(i.a)(this,e),this._classes={}}return Object(r.a)(e,[{key:"_addClass",value:function(e,t){this._classes[e]=t}},{key:"getClass",value:function(e){if(void 0===this._classes[e])throw new Error("Unknown module class: "+e);return this._classes[e]}},{key:"init",value:function(){}}]),e}()},62:function(e,t,a){"use strict";a.r(t);var i=a(2),r=a(3),o=a(7),n=a(4),c=a(6),s=function(){function e(){Object(i.a)(this,e)}return Object(r.a)(e,[{key:"propagate",value:function(e,t,a){}}]),e}(),u=a(34),l=a(9),h=a(25),p=a(22),f=a(29),d=a(1),y=a(8);a.d(t,"default",function(){return g});var g=function(e){function t(){var e;return Object(i.a)(this,t),(e=Object(o.a)(this,Object(n.a)(t).call(this))).soiSafetyCoefficient=1.5,e.maxStep=3600,e.minStepCount=100,e.maxPatchError=.001,e}return Object(c.a)(t,e),Object(r.a)(t,[{key:"propagate",value:function(e,t,a){if(!e instanceof u.a)throw new Error("Patched conics propagation requires TrajectoryComposite instance");if(!a.epoch)throw new Error("Patched conics propagation requires epoch in stop condition");e.clearAfterEpoch(t);var i,r=e.getComponentByEpoch(t),o=Math.max(t,r.epoch);r.maxEpoch=!1;do{(i=this._findNextTrajectory(r,o,a.epoch))&&(e.addComponent(i),o=i.epoch,r.maxEpoch=o,r=i)}while(i&&o<a.epoch)}},{key:"_findNextTrajectory",value:function(e,t,a){var i=y.a.starSystem.getObject(e.referenceFrame.originId),r=this._findOwnSoiCrossing(i,e,t),o=this._findChildSoiCrossing(i,e,t,a);if(!1===o&&!1===r)return!1;var n=!o||r&&r.epoch<o.epoch?r:o;return this._createExtensionTrajectory(e,n.newSoi,n.epoch)}},{key:"_findOwnSoiCrossing",value:function(e,t,a){var i=t.keplerianObject,r=i.getSphereCrossingTrueAnomaly(e.data.patchedConics.soiRadius);if(!r)return!1;for(var o=i.getEpochByTrueAnomaly(r[0]);o<a;)o+=i.period;return{epoch:o,newSoi:e.data.patchedConics.parentSoi}}},{key:"_findChildSoiCrossing",value:function(e,t,a,i){var r=t.keplerianObject,o=[],n=!0,c=!1,s=void 0;try{for(var u,l=e.data.patchedConics.childSois[Symbol.iterator]();!(n=(u=l.next()).done);n=!0){var h=u.value,p=h.trajectory.getKeplerianObjectByEpoch(a,t.referenceFrame),f=h.data.patchedConics.soiRadius,y=this._getPotentialApproachIntervals(p,r,a,i,f*this.soiSafetyCoefficient);if(!1!==y){var g=this._getPotentialApproachIntervals(r,p,a,i,f*this.soiSafetyCoefficient),v=Object(d.i)(y,g);if(!1!==v){!0===v&&(v=[[a,i]]),v.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0});var b=!1,m=!0,S=!1,E=void 0;try{for(var C,j=v[Symbol.iterator]();!(m=(C=j.next()).done);m=!0){var w=C.value;if(w[0]>i)break;if(!(w[1]<a)){w[0]<a&&(w[0]=a),w[1]>i&&(w[1]=i);for(var _=!0,O=Math.min(this.maxStep,(w[1]-w[0])/this.minStepCount),k=w[0],T=0;k<w[1];){var P=t.getPositionByEpoch(k).sub_(h.getPositionByEpoch(k)).mag-f;if(P<0){if(_){do{(k+=O)>w[1]&&(k=w[1]),P=t.getPositionByEpoch(k).sub_(h.getPositionByEpoch(k)).mag-f}while(P<0&&k<w[1]);if(P<0)break;continue}for(;Math.abs(P)>this.maxPatchError;)k+=O*=P/(T-P),T=P,P=t.getPositionByEpoch(k).sub_(h.getPositionByEpoch(k)).mag-f;o.push({epoch:k,newSoi:h}),b=!0;break}T=P,_=!1,k+=O}if(b)break}}}catch(I){S=!0,E=I}finally{try{m||null==j.return||j.return()}finally{if(S)throw E}}}}}}catch(I){c=!0,s=I}finally{try{n||null==l.return||l.return()}finally{if(c)throw s}}if(!o.length)return!1;for(var B=o[0],A=0;A<o.length;A++){var x=o[A];x.epoch<B.epoch&&(B=x)}return B}},{key:"_getPotentialApproachIntervals",value:function(e,t,a,i,r){var o=this._getRadialTaBounds(e,t,r);if(!1===o)return!1;var n,c=this._getVerticalTaBounds(e,t,a,r);if(c)n=Object(d.h)(c,o);else{if(!0===o)return!0;n=o}if(!1===n)return!1;var s,u,l=t.period,h=t.isElliptic?Math.floor((a-t.epoch)/l)*l:0,p=0,f=[];do{var y=!0,g=!1,v=void 0;try{for(var b,m=n[Symbol.iterator]();!(y=(b=m.next()).done);y=!0){var S=b.value;if(s=t.getEpochByTrueAnomaly(S[0])+h,(u=t.getEpochByTrueAnomaly(S[1])+h)<s&&(s-=l),u>p&&(p=u),!(u<a)){if(f.length>1e4)throw new Error("Infinite loop detected");f.push([s,u])}}}catch(E){g=!0,v=E}finally{try{y||null==m.return||m.return()}finally{if(g)throw v}}h+=l}while(p<i&&t.isElliptic);return f}},{key:"_getVerticalTaBounds",value:function(e,t,a,i){var r=e.getNormalVector(),o=t.getNormalVector(),n=e.getPeriapsisVector(),c=r.cross(o),s=t.getPeriapsisVector(),u=r.angle(o),l=c.angle(n);n.cross(c).angle(r)>Math.PI/2&&(l=d.b-l);var h=c.angle(s);return c.cross(s).angle(o)>Math.PI/2&&(h=d.b-h),new p.a(t.ecc,t.sma,h,u,l,t.m0,t.epoch,t.mu,!1).getPlaneCrossingTrueAnomaly(i)}},{key:"_getRadialTaBounds",value:function(e,t,a){var i=e.getPeriapsisRadius()-a,r=e.getApoapsisRadius()+a,o=t.getSphereCrossingTrueAnomaly(i),n=t.getSphereCrossingTrueAnomaly(r);return e.isHyperbolic?t.isHyperbolic?!o||[[-1/0,o[1]-d.b],[o[0],1/0]]:o?[o]:t.getApoapsisRadius()>=i:t.isHyperbolic?!!n&&(o?[[n[1]-d.b,o[1]-d.b],[o[0],n[0]]]:[[n[1]-d.b,n[0]]]):o?n?[[o[0],n[0]],[n[1],o[1]]]:[o]:n?[[n[1],n[0]]]:t.getPeriapsisRadius()<r&&t.getApoapsisRadius()>i}},{key:"_createExtensionTrajectory",value:function(e,t,a){var i=y.a.starSystem.getReferenceFrame(l.d.buildId(t.id,l.c.INERTIAL_ECLIPTIC)),r=i.stateVectorFromBaseReferenceFrameByEpoch(a,e.getStateByEpoch(a)),o=new h.a(i.id,p.a.createFromState(r,t.physicalModel.mu,a));return o.minEpoch=a,o.maxEpoch=!1,o.isEditable=!1,o.setVisualModel(new f.a(o,{color:e.visualModel.standardColor,minEpoch:null,maxEpoch:null})),o}}]),t}(s)},66:function(e,t,a){"use strict";a.r(t),a.d(t,"default",function(){return f});var i=a(2),r=a(3),o=a(7),n=a(4),c=a(6),s=a(126),u=a(10),l=a(23),h=a(62),p=a(8),f=function(e){function t(){return Object(i.a)(this,t),Object(o.a)(this,Object(n.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(r.a)(t,[{key:"init",value:function(){p.a.addPropagator("patchedConics",h.default),u.a.addListener(u.a.STAR_SYSTEM_LOADED,this.fillSoiTree),p.a.starSystem&&this.fillSoiTree()}},{key:"fillSoiTree",value:function(){var e=p.a.starSystem;for(var t in e.objects){var a=e.objects[t];if(a instanceof l.a&&void 0!==a.data.patchedConics){var i=e.getObject(a.data.patchedConics.parentSoiId);i instanceof l.a&&(a.data.patchedConics.parentSoi=i,i.data.patchedConics.childSois.push(a))}}}}]),t}(s.a)}}]);
//# sourceMappingURL=2.43fec244.chunk.js.map