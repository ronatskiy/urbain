(window.webpackJsonp=window.webpackJsonp||[]).push([[3,4],{192:function(e,t,r){"use strict";r.d(t,"a",function(){return i});var a=r(1),o=r(3),i=function(){function e(){Object(a.a)(this,e),this._classes={}}return Object(o.a)(e,[{key:"_addClass",value:function(e,t){this._classes[e]=t}},{key:"getClass",value:function(e){if(void 0===this._classes[e])throw new Error("Unknown module class: "+e);return this._classes[e]}},{key:"init",value:function(){}}]),e}()},95:function(e,t,r){"use strict";r.r(t);var a=r(1),o=r(3),i=r(5),n=r(4),c=r(6),s=function(){function e(){Object(a.a)(this,e)}return Object(o.a)(e,[{key:"propagate",value:function(e,t,r){}}]),e}(),l=(r(37),r(9)),u=r(28),p=r(22),d=r(30),h=r(2),f=r(8),y=r(49),v=r(48),g=r(18),m=r(54),S=r(55);r.d(t,"default",function(){return b});var b=function(e){function t(){var e;return Object(a.a)(this,t),(e=Object(i.a)(this,Object(n.a)(t).call(this))).soiSafetyCoefficient=1.5,e.maxPatchError=.001,e}return Object(c.a)(t,e),Object(o.a)(t,[{key:"propagate",value:function(e,t){if(!e instanceof m.a)throw new Error("Patched conics propagation requires TrajectoryDynamic instance");e.clearAfterEpoch(t);var r=e.flightEvents.filter(function(e){return e instanceof S.a&&e.epoch>=t}),a=0,o=r.length>0&&r[0].epoch,i=e.getComponentByEpoch(t),n=Math.max(t,i.epoch),c=!1;i.maxEpoch=!1;do{o!==n&&(c=this._findNextTrajectory(i,n+1,o)),c?(e.addComponent(c.trajectory),i.addFlightEvent(new v.default(c.epoch,c.oldSoi,c.newSoi)),n=c.epoch,i.maxEpoch=n,(i=c.trajectory).addFlightEvent(new y.default(c.epoch,c.oldSoi,c.newSoi))):!1!==o&&(i.maxEpoch=o,i=this._createAfterBurnTrajectory(i,r[a].vector,o),e.addComponent(i),c=!0,o=void 0!==r[a+=1]&&r[a].epoch)}while(c)}},{key:"_findNextTrajectory",value:function(e,t,r){var a=f.a.starSystem.getObject(e.referenceFrame.originId),o=a.type!==g.a.TYPE_STAR&&this._findOwnSoiCrossing(a,e,t),i=this._findChildSoiCrossing(a,e,t,!1===r?t+e.period:r);if(!1===i&&!1===o)return!1;var n=!i||o&&o.epoch<i.epoch?o:i;return!(!1!==r&&n.epoch>r)&&{trajectory:this._createNextSoiTrajectory(e,n.newSoi,n.epoch),oldSoi:a,newSoi:n.newSoi,epoch:n.epoch}}},{key:"_findOwnSoiCrossing",value:function(e,t,r){var a=t.keplerianObject,o=a.getSphereCrossingTrueAnomaly(e.data.patchedConics.soiRadius);if(!o)return!1;for(var i=a.getEpochByTrueAnomaly(o[0]);i<r;)i+=a.period;return{epoch:i,newSoi:e.data.patchedConics.parentSoi}}},{key:"_findChildSoiCrossing",value:function(e,t,r,a){var o=this,i=t.keplerianObject,n=[];if(i.isHyperbolic&&r===a){var c=0,s=!0,l=!1,u=void 0;try{for(var p,d=e.data.patchedConics.childSois[Symbol.iterator]();!(s=(p=d.next()).done);s=!0){var f=p.value,y=f.trajectory.getKeplerianObjectByEpoch(r,t.referenceFrame).getApoapsisRadius()+f.data.patchedConics.soiRadius*this.soiSafetyCoefficient;y>c&&(c=y)}}catch(C){l=!0,u=C}finally{try{s||null==d.return||d.return()}finally{if(l)throw u}}if(0===c)return!1;var v=i.getSphereCrossingTrueAnomaly(c);a=i.getEpochByTrueAnomaly(v[0])}var g=!0,m=!1,S=void 0;try{for(var b,j=function(){var e=b.value,c=e.trajectory.getKeplerianObjectByEpoch(r,t.referenceFrame),s=e.data.patchedConics.soiRadius,l=o._getPotentialApproachIntervals(c,i,r,a,s*o.soiSafetyCoefficient);if(!1===l)return"continue";var u=o._getPotentialApproachIntervals(i,c,r,a,s*o.soiSafetyCoefficient),p=Object(h.i)(l,u);if(!1===p)return"continue";!0===p&&(p=[[r,a]]),p.sort(function(e,t){return e[0]<t[0]?-1:e[0]>t[0]?1:0});var d=!0,f=!1,y=void 0;try{for(var v,g=p[Symbol.iterator]();!(d=(v=g.next()).done);d=!0){var m=v.value;if(m[0]>a)break;if(!(m[1]<r)){m[0]<r&&(m[0]=r),m[1]>a&&(m[1]=a);for(var S=i.isElliptic&&c.isElliptic?Math.min(Math.min(i.period,c.period),m[1]-m[0])/10:(m[1]-m[0])/10,j=void 0,E=void 0,_=m[0],w=!1,O=!1,T=function(e){return e[0].position.sub_(e[1]._position).mag},k=function(e,t){return(e[0]._position.mag*e[0]._velocity.projectionOn(e[0]._position)+e[1]._position.mag*e[1]._velocity.projectionOn(e[1]._position)-e[1]._position.dot(e[0]._velocity)-e[0]._position.dot(e[1]._velocity))/t},A=function(r){return[t.getStateInOwnFrameByEpoch(r),e.getStateByEpoch(r,t.referenceFrame)]};_<m[1];){var x=A(_),B=T(x);if(B<s){j=_-S,E=_,O=!0;break}var I=k(x,B);if(!1!==w&&w<0&&I>0){j=_-S,E=_;var P=void 0,R=void 0,F=w,M=I;do{if((B=T(x=A(P=j+(E-j)*F/(F-M))))<s){E=P,O=!0;break}(R=k(x,B))>0?(E=P,M=R):(j=P,F=R)}while(Math.abs(R)>1e-6&&E-j>1);if(O)break}w=I,_+=S}if(O){if(j<m[0]){n.push({epoch:m[0],newSoi:e});break}var N=void 0,V=T(A(j))-s,D=T(A(E))-s;do{(N=T(A(_=j+(E-j)*V/(V-D)))-s)<0?(E=_,D=N):(j=_,V=N)}while(Math.abs(N)>o.maxPatchError);n.push({epoch:_,newSoi:e});break}}}}catch(C){f=!0,y=C}finally{try{d||null==g.return||g.return()}finally{if(f)throw y}}},E=e.data.patchedConics.childSois[Symbol.iterator]();!(g=(b=E.next()).done);g=!0)j()}catch(C){m=!0,S=C}finally{try{g||null==E.return||E.return()}finally{if(m)throw S}}if(!n.length)return!1;for(var _=n[0],w=0;w<n.length;w++){var O=n[w];O.epoch<_.epoch&&(_=O)}return _}},{key:"_getPotentialApproachIntervals",value:function(e,t,r,a,o){var i=this._getRadialTaBounds(e,t,o);if(!1===i)return!1;var n,c=this._getVerticalTaBounds(e,t,o);if(c)n=Object(h.h)(c,i);else{if(!0===i)return!0;n=i}if(!1===n)return!1;var s,l,u=t.period,p=t.isElliptic?Math.floor((r-t.epoch)/u)*u:0,d=0,f=[];do{var y=!0,v=!1,g=void 0;try{for(var m,S=n[Symbol.iterator]();!(y=(m=S.next()).done);y=!0){var b=m.value;if(s=t.getEpochByTrueAnomaly(b[0])+p,(l=t.getEpochByTrueAnomaly(b[1])+p)<s&&(s-=u),l>d&&(d=l),!(l<r)){if(f.length>1e4)throw new Error("Infinite loop detected");f.push([s,l])}}}catch(j){v=!0,g=j}finally{try{y||null==S.return||S.return()}finally{if(v)throw g}}p+=u}while(d<a&&t.isElliptic);return f}},{key:"_getVerticalTaBounds",value:function(e,t,r){var a=e.getNormalVector(),o=t.getNormalVector(),i=e.getPeriapsisVector(),n=a.cross(o),c=t.getPeriapsisVector(),s=a.angle(o),l=n.angle(i);i.cross(n).angle(a)>Math.PI/2&&(l=h.b-l);var u=n.angle(c);return n.cross(c).angle(o)>Math.PI/2&&(u=h.b-u),new p.a(t.ecc,t.sma,u,s,l,t.m0,t.epoch,t.mu,!1).getPlaneCrossingTrueAnomaly(r)}},{key:"_getRadialTaBounds",value:function(e,t,r){var a=e.getPeriapsisRadius()-r,o=e.getApoapsisRadius()+r,i=t.getSphereCrossingTrueAnomaly(a),n=t.getSphereCrossingTrueAnomaly(o);return e.isHyperbolic?t.isHyperbolic?!i||[[-1/0,i[1]-h.b],[i[0],1/0]]:i?[i]:t.getApoapsisRadius()>=a:t.isHyperbolic?!!n&&(i?[[n[1]-h.b,i[1]-h.b],[i[0],n[0]]]:[[n[1]-h.b,n[0]]]):i?n?[[i[0],n[0]],[n[1],i[1]]]:[i]:n?[[n[1],n[0]]]:t.getPeriapsisRadius()<o&&t.getApoapsisRadius()>a}},{key:"_createNextSoiTrajectory",value:function(e,t,r){var a=f.a.starSystem.getReferenceFrame(l.d.buildId(t.id,l.c.INERTIAL_ECLIPTIC)),o=a.stateVectorFromBaseReferenceFrameByEpoch(r,e.getStateByEpoch(r)),i=new u.a(a.id,p.a.createFromState(o,t.physicalModel.mu,r));return i.minEpoch=r,i.maxEpoch=!1,i.setVisualModel(new d.a(i,{color:e.visualModel.config.color,minEpoch:!1,maxEpoch:"copy"})),i}},{key:"_createAfterBurnTrajectory",value:function(e,t,r){var a=e.getStateInOwnFrameByEpoch(r);a._velocity.add_(h.a.twoAxis(a._velocity,null,a._position).rotate_(t));var o=new u.a(e.referenceFrame.id,p.a.createFromState(a,e.mu,r));return o.minEpoch=r,o.maxEpoch=!1,o.setVisualModel(new d.a(o,{color:e.visualModel.config.color,minEpoch:!1,maxEpoch:"copy"})),o}}]),t}(s)},99:function(e,t,r){"use strict";r.r(t),r.d(t,"default",function(){return v});var a=r(1),o=r(3),i=r(5),n=r(4),c=r(6),s=r(192),l=r(10),u=r(18),p=r(23),d=r(95),h=r(8),f=r(53),y=r(52),v=function(e){function t(){return Object(a.a)(this,t),Object(i.a)(this,Object(n.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(o.a)(t,[{key:"init",value:function(){var e=this;this.root=null,h.a.addPropagator("patchedConics",d.default),l.a.addListener(l.a.LOADING_BODIES_DONE,function(){return e.fillSoiTree()}),h.a.starSystem&&this.fillSoiTree(),f.default.preloadTexture(),y.default.preloadTexture()}},{key:"fillSoiTree",value:function(){var e=h.a.starSystem;for(var t in e.objects){var r=e.objects[t];if(r instanceof p.a&&void 0!==r.data.patchedConics){r.type===u.a.TYPE_STAR&&(this.root=r);var a=e.getObject(r.data.patchedConics.parentSoiId);a instanceof p.a&&(r.data.patchedConics.parentSoi=a,a.data.patchedConics.childSois.push(r))}}}},{key:"getRootSoi",value:function(){return this.root}},{key:"getCommonParent",value:function(e,t){for(var r,a=[e];r=h.a.starSystem.getObject(a[a.length-1]).data.patchedConics.parentSoiId;)a.push(r);r=t;do{if(-1!==a.indexOf(r))return h.a.starSystem.getObject(r);r=h.a.starSystem.getObject(r).data.patchedConics.parentSoiId}while(r);return null}},{key:"getRelativePeriod",value:function(e,t,r){for(var a,o,i=[e];a=h.a.starSystem.getObject(i[i.length-1]).data.patchedConics.parentSoiId;){if(a==t)return null;i.push(a)}for(var n=t;a=h.a.starSystem.getObject(n).data.patchedConics.parentSoiId;){if(-1!==(o=i.indexOf(a))){if(0===o)return null;var c=h.a.starSystem.getObject(i[o-1]).trajectory.getKeplerianObjectByEpoch(r).period,s=h.a.starSystem.getObject(n).trajectory.getKeplerianObjectByEpoch(r).period;return{period1:c,period2:s,relativePeriod:1/Math.abs(1/c-1/s)}}n=a}return null}}]),t}(s.a)}}]);
//# sourceMappingURL=3.e1653939.chunk.js.map