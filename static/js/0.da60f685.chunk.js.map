{"version":3,"sources":["../static/js/0.da60f685.chunk.js","core/Propagator/Abstract.js","core/Module.js","modules/PatchedConics/PropagatorPatchedConics.js","modules/PatchedConics/ModulePatchedConics.js"],"names":["webpackJsonp","190","module","__webpack_exports__","__webpack_require__","_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","PropagatorAbstract","this","value","trajectory","epochFrom","stopCondition","191","Module","55","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","create","constructor","setPrototypeOf","__proto__","__WEBPACK_IMPORTED_MODULE_0__core_Propagator_Abstract__","__WEBPACK_IMPORTED_MODULE_1__core_Trajectory_Composite__","__WEBPACK_IMPORTED_MODULE_2__core_ReferenceFrame_Factory__","__WEBPACK_IMPORTED_MODULE_3__core_Trajectory_KeplerianBasic__","__WEBPACK_IMPORTED_MODULE_4__core_KeplerianObject__","__WEBPACK_IMPORTED_MODULE_5__core_visual_TrajectoryModel_Keplerian__","__WEBPACK_IMPORTED_MODULE_6__core_algebra__","__WEBPACK_IMPORTED_MODULE_7__core_Simulation__","PropagatorPatchedConics","_PropagatorAbstract","_this","getPrototypeOf","soiSafetyCoefficient","maxStep","minStepCount","maxPatchError","Error","epoch","clearAfterEpoch","lastComponent","getComponentByEpoch","Math","max","nextComponent","maxEpoch","_findNextTrajectory","addComponent","epochTo","soi","starSystem","getObject","referenceFrame","originId","ownSoiCrossing","_findOwnSoiCrossing","childSoiCrossing","_findChildSoiCrossing","nextSoiCrossing","_createExtensionTrajectory","newSoi","parent","ko","keplerianObject","sphereCrossing","getSphereCrossingTrueAnomaly","data","patchedConics","soiRadius","getEpochByTrueAnomaly","period","parentSoi","crossings","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","childSois","Symbol","iterator","next","done","childKo","getKeplerianObjectByEpoch","intervals1","_getPotentialApproachIntervals","intervals2","potentialApproachIntervals","sort","i1","i2","crossingFound","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","interval","isFirstStep","step","min","t","prevDistance","distance","getPositionByEpoch","sub_","mag","abs","push","err","return","closestCrossing","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","crossing","keplerianObjectBase","keplerianObjectActive","radialTa","_getRadialTaBounds","verticalTa","_getVerticalTaBounds","taIntervals","inEpoch","outEpoch","adding","isElliptic","floor","maxProcessedEpoch","epochIntervals","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","taInterval","createFromState","getStateByEpoch","rotate_","getOrbitalFrameQuaternion","invert_","mu","getPlaneCrossingTrueAnomaly","r1","getPeriapsisRadius","r2","getApoapsisRadius","radialTa1","radialTa2","isHyperbolic","Infinity","originalTrajectory","newSoiBody","newReferenceFrame","getReferenceFrame","buildId","id","INERTIAL_ECLIPTIC","newSoiState","stateVectorFromBaseReferenceFrameByEpoch","traj","physicalModel","minEpoch","isEditable","setVisualModel","color","visualModel","standardColor","56","__WEBPACK_IMPORTED_MODULE_0__core_Module__","__WEBPACK_IMPORTED_MODULE_1__core_Events__","__WEBPACK_IMPORTED_MODULE_2__core_Body__","__WEBPACK_IMPORTED_MODULE_3__PropagatorPatchedConics__","__WEBPACK_IMPORTED_MODULE_4__core_Simulation__","ModulePatchedConics","_Module","apply","arguments","addPropagator","addListener","LOADING_BODIES_DONE","fillSoiTree","ss","bodyId","objects","obj","parentSoiId"],"mappings":"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","file":"static/js/0.da60f685.chunk.js","sourcesContent":["webpackJsonp([0,1],{\n\n/***/ 190:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nvar _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\");}}var PropagatorAbstract=function(){function PropagatorAbstract(){_classCallCheck(this,PropagatorAbstract);}_createClass(PropagatorAbstract,[{key:\"propagate\",value:function propagate(trajectory,epochFrom,stopCondition){}}]);return PropagatorAbstract;}();/* harmony default export */ __webpack_exports__[\"a\"] = (PropagatorAbstract);\n\n/***/ }),\n\n/***/ 191:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nvar _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\");}}var Module=function(){function Module(){_classCallCheck(this,Module);}_createClass(Module,[{key:\"init\",value:function init(){}}]);return Module;}();/* harmony default export */ __webpack_exports__[\"a\"] = (Module);\n\n/***/ }),\n\n/***/ 55:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__core_Propagator_Abstract__ = __webpack_require__(190);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__core_Trajectory_Composite__ = __webpack_require__(26);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__core_ReferenceFrame_Factory__ = __webpack_require__(3);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__core_Trajectory_KeplerianBasic__ = __webpack_require__(19);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__core_KeplerianObject__ = __webpack_require__(11);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__core_visual_TrajectoryModel_Keplerian__ = __webpack_require__(27);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__core_algebra__ = __webpack_require__(2);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__core_Simulation__ = __webpack_require__(1);\nvar _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");}return call&&(typeof call===\"object\"||typeof call===\"function\")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!==\"function\"&&superClass!==null){throw new TypeError(\"Super expression must either be null or a function, not \"+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}// import VisualPoint from \"../../visual/Point\";\n// import Constant from \"../../core/FunctionOfEpoch/Constant\";\nvar PropagatorPatchedConics=function(_PropagatorAbstract){_inherits(PropagatorPatchedConics,_PropagatorAbstract);function PropagatorPatchedConics(){_classCallCheck(this,PropagatorPatchedConics);var _this=_possibleConstructorReturn(this,(PropagatorPatchedConics.__proto__||Object.getPrototypeOf(PropagatorPatchedConics)).call(this));_this.soiSafetyCoefficient=1.5;_this.maxStep=3600;_this.minStepCount=100;_this.maxPatchError=1e-3;// 1 meter\n// this.debugPoints = [];\nreturn _this;}_createClass(PropagatorPatchedConics,[{key:\"propagate\",value:function propagate(trajectory,epochFrom,stopCondition){if(!trajectory instanceof __WEBPACK_IMPORTED_MODULE_1__core_Trajectory_Composite__[\"a\" /* default */]){throw new Error('Patched conics propagation requires TrajectoryComposite instance');}if(!stopCondition.epoch){throw new Error('Patched conics propagation requires epoch in stop condition');}trajectory.clearAfterEpoch(epochFrom);var lastComponent=trajectory.getComponentByEpoch(epochFrom);var epoch=Math.max(epochFrom,lastComponent.epoch);var nextComponent=void 0;lastComponent.maxEpoch=false;/*\r\n        for (let point of this.debugPoints) {\r\n            point.drop();\r\n        }\r\n        this.debugPoints = [];\r\n*/// console.log('Propagating...');\ndo{// console.log('Looking for next component...');\nnextComponent=this._findNextTrajectory(lastComponent,epoch,stopCondition.epoch);if(nextComponent){// console.log('Component found', nextComponent);\ntrajectory.addComponent(nextComponent);epoch=nextComponent.epoch;lastComponent.maxEpoch=epoch;lastComponent=nextComponent;}}while(nextComponent&&epoch<stopCondition.epoch);}},{key:\"_findNextTrajectory\",value:function _findNextTrajectory(trajectory,epochFrom,epochTo){var soi=__WEBPACK_IMPORTED_MODULE_7__core_Simulation__[\"a\" /* sim */].starSystem.getObject(trajectory.referenceFrame.originId);var ownSoiCrossing=this._findOwnSoiCrossing(soi,trajectory,epochFrom);var childSoiCrossing=this._findChildSoiCrossing(soi,trajectory,epochFrom,epochTo);if(childSoiCrossing===false&&ownSoiCrossing===false){return false;}var nextSoiCrossing=!childSoiCrossing||ownSoiCrossing&&ownSoiCrossing.epoch<childSoiCrossing.epoch?ownSoiCrossing:childSoiCrossing;return this._createExtensionTrajectory(trajectory,nextSoiCrossing.newSoi,nextSoiCrossing.epoch);}},{key:\"_findOwnSoiCrossing\",value:function _findOwnSoiCrossing(parent,trajectory,epochFrom){var ko=trajectory.keplerianObject;var sphereCrossing=ko.getSphereCrossingTrueAnomaly(parent.data.patchedConics.soiRadius);if(!sphereCrossing){return false;}var epoch=ko.getEpochByTrueAnomaly(sphereCrossing[0]);while(epoch<epochFrom){epoch+=ko.period;}return{epoch:epoch,newSoi:parent.data.patchedConics.parentSoi};}},{key:\"_findChildSoiCrossing\",value:function _findChildSoiCrossing(parent,trajectory,epochFrom,epochTo){var ko=trajectory.keplerianObject;var crossings=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=parent.data.patchedConics.childSois[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var soi=_step.value;var childKo=soi.trajectory.getKeplerianObjectByEpoch(epochFrom,trajectory.referenceFrame);var soiRadius=soi.data.patchedConics.soiRadius;var intervals1=this._getPotentialApproachIntervals(childKo,ko,epochFrom,epochTo,soiRadius*this.soiSafetyCoefficient);var intervals2=this._getPotentialApproachIntervals(ko,childKo,epochFrom,epochTo,soiRadius*this.soiSafetyCoefficient);/*\r\n            if (this.debugPoints.length === 0) {\r\n                if (intervals1 && intervals1 instanceof Array)\r\n                    for (let interval of intervals1) {\r\n                        this.debugPoints.push(new VisualPoint(new Constant(trajectory.getPositionByEpoch(interval[0], 39901000).add_(parent.getPositionByEpoch(sim.currentEpoch))), 'blue', 6));\r\n                        this.debugPoints.push(new VisualPoint(new Constant(trajectory.getPositionByEpoch(interval[1], 39901000).add_(parent.getPositionByEpoch(sim.currentEpoch))), 'blue', 10));\r\n                    }\r\n\r\n                if (intervals2 && intervals2 instanceof Array)\r\n                    for (let interval of intervals2) {\r\n                        this.debugPoints.push(new VisualPoint(new Constant(soi.trajectory.getPositionByEpoch(interval[0], 39901000).add_(parent.getPositionByEpoch(sim.currentEpoch))), 'yellow', 6));\r\n                        this.debugPoints.push(new VisualPoint(new Constant(soi.trajectory.getPositionByEpoch(interval[1], 39901000).add_(parent.getPositionByEpoch(sim.currentEpoch))), 'yellow', 10));\r\n                    }\r\n            }\r\n*/var potentialApproachIntervals=Object(__WEBPACK_IMPORTED_MODULE_6__core_algebra__[\"i\" /* getEpochIntervalsIntersection */])(intervals1,intervals2);if(potentialApproachIntervals===false){continue;}if(potentialApproachIntervals===true){// TODO optimize this case\npotentialApproachIntervals=[[epochFrom,epochTo]];}potentialApproachIntervals.sort(function(i1,i2){return i1[0]<i2[0]?-1:i1[0]>i2[0]?1:0;});var crossingFound=false;// console.log('Iterating...');\nvar _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=potentialApproachIntervals[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var interval=_step3.value;if(interval[1]<epochFrom){continue;}if(interval[0]<epochFrom){interval[0]=epochFrom;}if(interval[1]>epochTo){interval[1]=epochTo;}var isFirstStep=true;var step=Math.min(this.maxStep,(interval[1]-interval[0])/this.minStepCount);var t=interval[0];var prevDistance=0;// console.log('Iterating interval...', interval[1] - interval[0], step);\nwhile(t<interval[1]){var distance=trajectory.getPositionByEpoch(t).sub_(soi.getPositionByEpoch(t)).mag-soiRadius;// console.log('T Distance', t, distance);\nif(distance<0){// found a point in time when we are inside SOI\n// console.log('Found');\nif(isFirstStep){// console.log('Iterating forward');\ndo{t+=step;if(t>interval[1]){t=interval[1];}distance=trajectory.getPositionByEpoch(t).sub_(soi.getPositionByEpoch(t)).mag-soiRadius;}while(distance<0&&t<interval[1]);// console.log('Distance', distance);\nif(distance<0){break;}continue;}// console.log('Looking for boundary');\nwhile(Math.abs(distance)>this.maxPatchError){// looking for SOI crossing time now\nstep*=distance/(prevDistance-distance);t+=step;prevDistance=distance;distance=trajectory.getPositionByEpoch(t).sub_(soi.getPositionByEpoch(t)).mag-soiRadius;// console.log('T Step distance', t, step, distance);\n}// console.log('Boundary found');\ncrossings.push({epoch:t,newSoi:soi});crossingFound=true;break;}prevDistance=distance;isFirstStep=false;t+=step;}if(crossingFound){break;}// console.log('Crossing not found');\n}}catch(err){_didIteratorError3=true;_iteratorError3=err;}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return();}}finally{if(_didIteratorError3){throw _iteratorError3;}}}}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}if(!crossings.length){return false;}var closestCrossing=crossings[0];var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=crossings[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var crossing=_step2.value;if(crossing.epoch<closestCrossing.epoch){closestCrossing=crossing;}}}catch(err){_didIteratorError2=true;_iteratorError2=err;}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally{if(_didIteratorError2){throw _iteratorError2;}}}return closestCrossing;}},{key:\"_getPotentialApproachIntervals\",value:function _getPotentialApproachIntervals(keplerianObjectBase,keplerianObjectActive,epochFrom,epochTo,distance){var radialTa=this._getRadialTaBounds(keplerianObjectBase,keplerianObjectActive,distance);var verticalTa=this._getVerticalTaBounds(keplerianObjectBase,keplerianObjectActive,epochFrom,distance);var taIntervals=void 0;if(verticalTa){taIntervals=Object(__WEBPACK_IMPORTED_MODULE_6__core_algebra__[\"h\" /* getAngleIntervalsIntersection */])(verticalTa,radialTa);}else{if(radialTa===true){return true;}else{taIntervals=radialTa;}}if(taIntervals===false){return false;}var period=keplerianObjectActive.period;var inEpoch=void 0,outEpoch=void 0;var adding=keplerianObjectActive.isElliptic?Math.floor((epochFrom-keplerianObjectActive.epoch)/period)*period:0;var maxProcessedEpoch=0;var epochIntervals=[];do{var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=taIntervals[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var taInterval=_step4.value;inEpoch=keplerianObjectActive.getEpochByTrueAnomaly(taInterval[0])+adding;outEpoch=keplerianObjectActive.getEpochByTrueAnomaly(taInterval[1])+adding;if(outEpoch<inEpoch){inEpoch-=period;}if(outEpoch>maxProcessedEpoch){maxProcessedEpoch=outEpoch;}if(outEpoch<epochFrom){continue;}epochIntervals.push([inEpoch,outEpoch]);}}catch(err){_didIteratorError4=true;_iteratorError4=err;}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return();}}finally{if(_didIteratorError4){throw _iteratorError4;}}}adding+=period;}while(maxProcessedEpoch<epochTo&&keplerianObjectActive.isElliptic);return epochIntervals;}},{key:\"_getVerticalTaBounds\",value:function _getVerticalTaBounds(keplerianObjectBase,keplerianObjectActive,epochFrom,distance){// this is only to recalculate inc, raan and aop. probably can be optimized.\nvar relKeplerianObject=__WEBPACK_IMPORTED_MODULE_4__core_KeplerianObject__[\"a\" /* default */].createFromState(keplerianObjectActive.getStateByEpoch(epochFrom).rotate_(keplerianObjectBase.getOrbitalFrameQuaternion().invert_()),keplerianObjectActive.mu,epochFrom);return relKeplerianObject.getPlaneCrossingTrueAnomaly(distance);}},{key:\"_getRadialTaBounds\",value:function _getRadialTaBounds(keplerianObjectBase,keplerianObjectActive,distance){var r1=keplerianObjectBase.getPeriapsisRadius()-distance;var r2=keplerianObjectBase.getApoapsisRadius()+distance;var radialTa1=keplerianObjectActive.getSphereCrossingTrueAnomaly(r1);var radialTa2=keplerianObjectActive.getSphereCrossingTrueAnomaly(r2);if(keplerianObjectBase.isHyperbolic){if(keplerianObjectActive.isHyperbolic){return radialTa1?[[-Infinity,radialTa1[1]-__WEBPACK_IMPORTED_MODULE_6__core_algebra__[\"b\" /* TWO_PI */]],[radialTa1[0],Infinity]]:true;}else{return radialTa1?[radialTa1]:keplerianObjectActive.getApoapsisRadius()>=r1;}}// keplerianObjectBase is elliptic\nif(keplerianObjectActive.isHyperbolic){if(!radialTa2){return false;}else if(!radialTa1){return[[radialTa2[1]-__WEBPACK_IMPORTED_MODULE_6__core_algebra__[\"b\" /* TWO_PI */],radialTa2[0]]];}return[[radialTa2[1]-__WEBPACK_IMPORTED_MODULE_6__core_algebra__[\"b\" /* TWO_PI */],radialTa1[1]-__WEBPACK_IMPORTED_MODULE_6__core_algebra__[\"b\" /* TWO_PI */]],[radialTa1[0],radialTa2[0]]];}// keplerianObjectActive is elliptic\nif(radialTa1){return radialTa2?[[radialTa1[0],radialTa2[0]],[radialTa2[1],radialTa1[1]]]:[radialTa1];}else if(radialTa2){return[[radialTa2[1],radialTa2[0]]];}return keplerianObjectActive.getPeriapsisRadius()<r2&&keplerianObjectActive.getApoapsisRadius()>r1;}},{key:\"_createExtensionTrajectory\",value:function _createExtensionTrajectory(originalTrajectory,newSoiBody,epoch){var newReferenceFrame=__WEBPACK_IMPORTED_MODULE_7__core_Simulation__[\"a\" /* sim */].starSystem.getReferenceFrame(__WEBPACK_IMPORTED_MODULE_2__core_ReferenceFrame_Factory__[\"d\" /* default */].buildId(newSoiBody.id,__WEBPACK_IMPORTED_MODULE_2__core_ReferenceFrame_Factory__[\"c\" /* ReferenceFrame */].INERTIAL_ECLIPTIC));var newSoiState=newReferenceFrame.stateVectorFromBaseReferenceFrameByEpoch(epoch,originalTrajectory.getStateByEpoch(epoch));var traj=new __WEBPACK_IMPORTED_MODULE_3__core_Trajectory_KeplerianBasic__[\"a\" /* default */](newReferenceFrame.id,__WEBPACK_IMPORTED_MODULE_4__core_KeplerianObject__[\"a\" /* default */].createFromState(newSoiState,newSoiBody.physicalModel.mu,epoch));traj.minEpoch=epoch;traj.maxEpoch=false;traj.isEditable=false;// TODO refactor this\ntraj.setVisualModel(new __WEBPACK_IMPORTED_MODULE_5__core_visual_TrajectoryModel_Keplerian__[\"a\" /* default */](traj,{color:originalTrajectory.visualModel.standardColor,minEpoch:null,maxEpoch:null}));return traj;}}]);return PropagatorPatchedConics;}(__WEBPACK_IMPORTED_MODULE_0__core_Propagator_Abstract__[\"a\" /* default */]);/* harmony default export */ __webpack_exports__[\"default\"] = (PropagatorPatchedConics);\n\n/***/ }),\n\n/***/ 56:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__core_Module__ = __webpack_require__(191);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__core_Events__ = __webpack_require__(7);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__core_Body__ = __webpack_require__(20);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__PropagatorPatchedConics__ = __webpack_require__(55);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__core_Simulation__ = __webpack_require__(1);\nvar _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");}return call&&(typeof call===\"object\"||typeof call===\"function\")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!==\"function\"&&superClass!==null){throw new TypeError(\"Super expression must either be null or a function, not \"+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var ModulePatchedConics=function(_Module){_inherits(ModulePatchedConics,_Module);function ModulePatchedConics(){_classCallCheck(this,ModulePatchedConics);return _possibleConstructorReturn(this,(ModulePatchedConics.__proto__||Object.getPrototypeOf(ModulePatchedConics)).apply(this,arguments));}_createClass(ModulePatchedConics,[{key:\"init\",value:function init(){__WEBPACK_IMPORTED_MODULE_4__core_Simulation__[\"a\" /* sim */].addPropagator('patchedConics',__WEBPACK_IMPORTED_MODULE_3__PropagatorPatchedConics__[\"default\"]);__WEBPACK_IMPORTED_MODULE_1__core_Events__[\"a\" /* default */].addListener(__WEBPACK_IMPORTED_MODULE_1__core_Events__[\"a\" /* default */].LOADING_BODIES_DONE,this.fillSoiTree);return this;}},{key:\"fillSoiTree\",value:function fillSoiTree(){var ss=__WEBPACK_IMPORTED_MODULE_4__core_Simulation__[\"a\" /* sim */].starSystem;for(var bodyId in ss.objects){var obj=ss.objects[bodyId];if(!(obj instanceof __WEBPACK_IMPORTED_MODULE_2__core_Body__[\"a\" /* default */]))continue;var parent=ss.getObject(obj.data.patchedConics.parentSoiId);if(!(parent instanceof __WEBPACK_IMPORTED_MODULE_2__core_Body__[\"a\" /* default */]))continue;obj.data.patchedConics.parentSoi=parent;parent.data.patchedConics.childSois.push(obj);}}}]);return ModulePatchedConics;}(__WEBPACK_IMPORTED_MODULE_0__core_Module__[\"a\" /* default */]);/* harmony default export */ __webpack_exports__[\"default\"] = (ModulePatchedConics);\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// static/js/0.da60f685.chunk.js","export default class PropagatorAbstract\r\n{\r\n    propagate(trajectory, epochFrom, stopCondition) {}\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/core/Propagator/Abstract.js","export default class Module\r\n{\r\n    init() {}\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/core/Module.js","import PropagatorAbstract from \"../../core/Propagator/Abstract\";\r\nimport TrajectoryComposite from \"../../core/Trajectory/Composite\";\r\nimport ReferenceFrameFactory, {ReferenceFrame} from \"../../core/ReferenceFrame/Factory\";\r\nimport TrajectoryKeplerianBasic from \"../../core/Trajectory/KeplerianBasic\";\r\nimport KeplerianObject from \"../../core/KeplerianObject\";\r\nimport VisualTrajectoryModelKeplerian from \"../../core/visual/TrajectoryModel/Keplerian\";\r\nimport {getAngleIntervalsIntersection, getEpochIntervalsIntersection, TWO_PI} from \"../../core/algebra\";\r\nimport { sim } from \"../../core/Simulation\";\r\n// import VisualPoint from \"../../visual/Point\";\r\n// import Constant from \"../../core/FunctionOfEpoch/Constant\";\r\n\r\nexport default class PropagatorPatchedConics extends PropagatorAbstract\r\n{\r\n    constructor() {\r\n        super();\r\n        this.soiSafetyCoefficient = 1.5;\r\n        this.maxStep = 3600;\r\n        this.minStepCount = 100;\r\n        this.maxPatchError = 1e-3; // 1 meter\r\n        // this.debugPoints = [];\r\n    }\r\n\r\n    propagate(trajectory, epochFrom, stopCondition) {\r\n        if (!trajectory instanceof TrajectoryComposite) {\r\n            throw new Error('Patched conics propagation requires TrajectoryComposite instance');\r\n        }\r\n        if (!stopCondition.epoch) {\r\n            throw new Error('Patched conics propagation requires epoch in stop condition');\r\n        }\r\n\r\n        trajectory.clearAfterEpoch(epochFrom);\r\n\r\n        let lastComponent = trajectory.getComponentByEpoch(epochFrom);\r\n        let epoch = Math.max(epochFrom, lastComponent.epoch);\r\n        let nextComponent;\r\n\r\n        lastComponent.maxEpoch = false;\r\n/*\r\n        for (let point of this.debugPoints) {\r\n            point.drop();\r\n        }\r\n        this.debugPoints = [];\r\n*/\r\n        // console.log('Propagating...');\r\n\r\n        do {\r\n            // console.log('Looking for next component...');\r\n            nextComponent = this._findNextTrajectory(lastComponent, epoch, stopCondition.epoch);\r\n            if (nextComponent) {\r\n                // console.log('Component found', nextComponent);\r\n                trajectory.addComponent(nextComponent);\r\n                epoch = nextComponent.epoch;\r\n                lastComponent.maxEpoch = epoch;\r\n                lastComponent = nextComponent;\r\n            }\r\n        } while (nextComponent && epoch < stopCondition.epoch);\r\n    }\r\n\r\n    _findNextTrajectory(trajectory, epochFrom, epochTo) {\r\n        const soi = sim.starSystem.getObject(trajectory.referenceFrame.originId);\r\n        const ownSoiCrossing   = this._findOwnSoiCrossing  (soi, trajectory, epochFrom);\r\n        const childSoiCrossing = this._findChildSoiCrossing(soi, trajectory, epochFrom, epochTo);\r\n\r\n        if (childSoiCrossing === false && ownSoiCrossing === false) {\r\n            return false;\r\n        }\r\n\r\n        let nextSoiCrossing = (!childSoiCrossing || (ownSoiCrossing && ownSoiCrossing.epoch < childSoiCrossing.epoch))\r\n            ? ownSoiCrossing\r\n            : childSoiCrossing;\r\n\r\n        return this._createExtensionTrajectory(trajectory, nextSoiCrossing.newSoi, nextSoiCrossing.epoch);\r\n    }\r\n\r\n    _findOwnSoiCrossing(parent, trajectory, epochFrom) {\r\n        const ko = trajectory.keplerianObject;\r\n        const sphereCrossing = ko.getSphereCrossingTrueAnomaly(parent.data.patchedConics.soiRadius);\r\n\r\n        if (!sphereCrossing) {\r\n            return false;\r\n        }\r\n\r\n        let epoch = ko.getEpochByTrueAnomaly(sphereCrossing[0]);\r\n        while (epoch < epochFrom) {\r\n            epoch += ko.period;\r\n        }\r\n\r\n        return {\r\n            epoch: epoch,\r\n            newSoi: parent.data.patchedConics.parentSoi\r\n        };\r\n    }\r\n\r\n    _findChildSoiCrossing(parent, trajectory, epochFrom, epochTo) {\r\n        const ko = trajectory.keplerianObject;\r\n        let crossings = [];\r\n\r\n        for (let soi of parent.data.patchedConics.childSois) {\r\n            const childKo = soi.trajectory.getKeplerianObjectByEpoch(epochFrom, trajectory.referenceFrame);\r\n            const soiRadius = soi.data.patchedConics.soiRadius;\r\n            const intervals1 = this._getPotentialApproachIntervals(childKo, ko, epochFrom, epochTo, soiRadius * this.soiSafetyCoefficient);\r\n            const intervals2 = this._getPotentialApproachIntervals(ko, childKo, epochFrom, epochTo, soiRadius * this.soiSafetyCoefficient);\r\n/*\r\n            if (this.debugPoints.length === 0) {\r\n                if (intervals1 && intervals1 instanceof Array)\r\n                    for (let interval of intervals1) {\r\n                        this.debugPoints.push(new VisualPoint(new Constant(trajectory.getPositionByEpoch(interval[0], 39901000).add_(parent.getPositionByEpoch(sim.currentEpoch))), 'blue', 6));\r\n                        this.debugPoints.push(new VisualPoint(new Constant(trajectory.getPositionByEpoch(interval[1], 39901000).add_(parent.getPositionByEpoch(sim.currentEpoch))), 'blue', 10));\r\n                    }\r\n\r\n                if (intervals2 && intervals2 instanceof Array)\r\n                    for (let interval of intervals2) {\r\n                        this.debugPoints.push(new VisualPoint(new Constant(soi.trajectory.getPositionByEpoch(interval[0], 39901000).add_(parent.getPositionByEpoch(sim.currentEpoch))), 'yellow', 6));\r\n                        this.debugPoints.push(new VisualPoint(new Constant(soi.trajectory.getPositionByEpoch(interval[1], 39901000).add_(parent.getPositionByEpoch(sim.currentEpoch))), 'yellow', 10));\r\n                    }\r\n            }\r\n*/\r\n            let potentialApproachIntervals = getEpochIntervalsIntersection(intervals1, intervals2);\r\n\r\n            if (potentialApproachIntervals === false) {\r\n                continue;\r\n            }\r\n            if (potentialApproachIntervals === true) {\r\n                // TODO optimize this case\r\n                potentialApproachIntervals = [[epochFrom, epochTo]];\r\n            }\r\n\r\n            potentialApproachIntervals.sort((i1, i2) => (i1[0] < i2[0]) ? -1 : (i1[0] > i2[0] ? 1 : 0));\r\n\r\n            let crossingFound = false;\r\n            // console.log('Iterating...');\r\n            for (let interval of potentialApproachIntervals) {\r\n                if (interval[1] < epochFrom) {\r\n                    continue;\r\n                }\r\n                if (interval[0] < epochFrom) {\r\n                    interval[0] = epochFrom;\r\n                }\r\n                if (interval[1] > epochTo) {\r\n                    interval[1] = epochTo;\r\n                }\r\n                let isFirstStep = true;\r\n                let step = Math.min(this.maxStep, (interval[1] - interval[0]) / this.minStepCount);\r\n                let t = interval[0];\r\n                let prevDistance = 0;\r\n                // console.log('Iterating interval...', interval[1] - interval[0], step);\r\n                while (t < interval[1]) {\r\n                    let distance = trajectory.getPositionByEpoch(t).sub_(soi.getPositionByEpoch(t)).mag - soiRadius;\r\n                    // console.log('T Distance', t, distance);\r\n                    if (distance < 0) { // found a point in time when we are inside SOI\r\n                        // console.log('Found');\r\n                        if (isFirstStep) {\r\n                            // console.log('Iterating forward');\r\n                            do {\r\n                                t += step;\r\n                                if (t > interval[1]) {\r\n                                    t = interval[1];\r\n                                }\r\n                                distance = trajectory.getPositionByEpoch(t).sub_(soi.getPositionByEpoch(t)).mag - soiRadius;\r\n                            } while (distance < 0 && t < interval[1]);\r\n                            // console.log('Distance', distance);\r\n                            if (distance < 0) {\r\n                                break;\r\n                            }\r\n                            continue;\r\n                        }\r\n                        // console.log('Looking for boundary');\r\n                        while (Math.abs(distance) > this.maxPatchError) { // looking for SOI crossing time now\r\n                            step *= distance / (prevDistance - distance);\r\n                            t += step;\r\n                            prevDistance = distance;\r\n                            distance = trajectory.getPositionByEpoch(t).sub_(soi.getPositionByEpoch(t)).mag - soiRadius;\r\n                            // console.log('T Step distance', t, step, distance);\r\n                        }\r\n                        // console.log('Boundary found');\r\n                        crossings.push({\r\n                            epoch: t,\r\n                            newSoi: soi\r\n                        });\r\n                        crossingFound = true;\r\n                        break;\r\n                    }\r\n                    prevDistance = distance;\r\n                    isFirstStep = false;\r\n                    t += step;\r\n                }\r\n\r\n                if (crossingFound) {\r\n                    break;\r\n                }\r\n                // console.log('Crossing not found');\r\n            }\r\n        }\r\n\r\n        if (!crossings.length) {\r\n            return false;\r\n        }\r\n\r\n        let closestCrossing = crossings[0];\r\n        for (let crossing of crossings) {\r\n            if (crossing.epoch < closestCrossing.epoch) {\r\n                closestCrossing = crossing;\r\n            }\r\n        }\r\n\r\n        return closestCrossing;\r\n    }\r\n\r\n    _getPotentialApproachIntervals(keplerianObjectBase, keplerianObjectActive, epochFrom, epochTo, distance) {\r\n        const radialTa = this._getRadialTaBounds(keplerianObjectBase, keplerianObjectActive, distance);\r\n        const verticalTa = this._getVerticalTaBounds(keplerianObjectBase, keplerianObjectActive, epochFrom, distance);\r\n        let taIntervals;\r\n\r\n        if (verticalTa) {\r\n            taIntervals = getAngleIntervalsIntersection(verticalTa, radialTa);\r\n        } else {\r\n            if (radialTa === true) {\r\n                return true;\r\n            } else {\r\n                taIntervals = radialTa;\r\n            }\r\n        }\r\n\r\n        if (taIntervals === false) {\r\n            return false;\r\n        }\r\n\r\n        const period = keplerianObjectActive.period;\r\n        let inEpoch, outEpoch;\r\n        let adding = keplerianObjectActive.isElliptic\r\n            ? Math.floor((epochFrom - keplerianObjectActive.epoch) / period) * period\r\n            : 0;\r\n        let maxProcessedEpoch = 0;\r\n        let epochIntervals = [];\r\n\r\n        do {\r\n            for (let taInterval of taIntervals) {\r\n                inEpoch = keplerianObjectActive.getEpochByTrueAnomaly(taInterval[0]) + adding;\r\n                outEpoch = keplerianObjectActive.getEpochByTrueAnomaly(taInterval[1]) + adding;\r\n\r\n                if (outEpoch < inEpoch) {\r\n                    inEpoch -= period;\r\n                }\r\n\r\n                if (outEpoch > maxProcessedEpoch) {\r\n                    maxProcessedEpoch = outEpoch;\r\n                }\r\n                if (outEpoch < epochFrom) {\r\n                    continue;\r\n                }\r\n\r\n                epochIntervals.push([inEpoch, outEpoch]);\r\n            }\r\n            adding += period;\r\n\r\n        } while (maxProcessedEpoch < epochTo && keplerianObjectActive.isElliptic);\r\n\r\n        return epochIntervals;\r\n    }\r\n\r\n    _getVerticalTaBounds(keplerianObjectBase, keplerianObjectActive, epochFrom, distance) {\r\n        // this is only to recalculate inc, raan and aop. probably can be optimized.\r\n        const relKeplerianObject = KeplerianObject.createFromState(\r\n            keplerianObjectActive.getStateByEpoch(epochFrom)\r\n                .rotate_(keplerianObjectBase.getOrbitalFrameQuaternion().invert_()),\r\n            keplerianObjectActive.mu,\r\n            epochFrom\r\n        );\r\n\r\n        return relKeplerianObject.getPlaneCrossingTrueAnomaly(distance);\r\n    }\r\n\r\n    _getRadialTaBounds(keplerianObjectBase, keplerianObjectActive, distance) {\r\n        const r1 = keplerianObjectBase.getPeriapsisRadius() - distance;\r\n        const r2 = keplerianObjectBase.getApoapsisRadius()  + distance;\r\n        const radialTa1 = keplerianObjectActive.getSphereCrossingTrueAnomaly(r1);\r\n        const radialTa2 = keplerianObjectActive.getSphereCrossingTrueAnomaly(r2);\r\n\r\n        if (keplerianObjectBase.isHyperbolic) {\r\n            if (keplerianObjectActive.isHyperbolic) {\r\n                return radialTa1\r\n                    ? [[-Infinity, radialTa1[1] - TWO_PI],[radialTa1[0], Infinity]]\r\n                    : true;\r\n            } else {\r\n                return radialTa1\r\n                    ? [radialTa1]\r\n                    : (keplerianObjectActive.getApoapsisRadius() >= r1);\r\n            }\r\n        }\r\n        // keplerianObjectBase is elliptic\r\n\r\n        if (keplerianObjectActive.isHyperbolic) {\r\n            if (!radialTa2) {\r\n                return false;\r\n            } else if (!radialTa1) {\r\n                return [[radialTa2[1] - TWO_PI, radialTa2[0]]];\r\n            }\r\n            return [\r\n                [radialTa2[1] - TWO_PI, radialTa1[1] - TWO_PI],\r\n                [radialTa1[0], radialTa2[0]],\r\n            ];\r\n        }\r\n        // keplerianObjectActive is elliptic\r\n\r\n        if (radialTa1) {\r\n            return radialTa2\r\n                ? [[radialTa1[0], radialTa2[0]], [radialTa2[1], radialTa1[1]]]\r\n                : [radialTa1];\r\n        } else if (radialTa2) {\r\n            return [[radialTa2[1], radialTa2[0]]];\r\n        }\r\n        return keplerianObjectActive.getPeriapsisRadius() < r2\r\n            && keplerianObjectActive.getApoapsisRadius()  > r1;\r\n    }\r\n\r\n    _createExtensionTrajectory(originalTrajectory, newSoiBody, epoch) {\r\n        let newReferenceFrame = sim.starSystem.getReferenceFrame(ReferenceFrameFactory.buildId(newSoiBody.id, ReferenceFrame.INERTIAL_ECLIPTIC));\r\n        let newSoiState = newReferenceFrame.stateVectorFromBaseReferenceFrameByEpoch(\r\n            epoch,\r\n            originalTrajectory.getStateByEpoch(epoch)\r\n        );\r\n\r\n        let traj = new TrajectoryKeplerianBasic(\r\n            newReferenceFrame.id,\r\n            KeplerianObject.createFromState(\r\n                newSoiState,\r\n                newSoiBody.physicalModel.mu,\r\n                epoch\r\n            )\r\n        );\r\n        traj.minEpoch = epoch;\r\n        traj.maxEpoch = false;\r\n        traj.isEditable = false;\r\n\r\n        // TODO refactor this\r\n        traj.setVisualModel(new VisualTrajectoryModelKeplerian(\r\n            traj,\r\n            {color: originalTrajectory.visualModel.standardColor, minEpoch: null, maxEpoch: null}\r\n        ));\r\n\r\n        return traj;\r\n    }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/modules/PatchedConics/PropagatorPatchedConics.js","import Module from \"../../core/Module\";\r\nimport Events from \"../../core/Events\";\r\nimport Body from \"../../core/Body\";\r\nimport PropagatorPatchedConics from \"./PropagatorPatchedConics\";\r\nimport { sim } from \"../../core/Simulation\";\r\n\r\nexport default class ModulePatchedConics extends Module\r\n{\r\n    init() {\r\n        sim.addPropagator('patchedConics', PropagatorPatchedConics);\r\n        Events.addListener(Events.LOADING_BODIES_DONE, this.fillSoiTree);\r\n        return this;\r\n    }\r\n\r\n    fillSoiTree() {\r\n        let ss = sim.starSystem;\r\n\r\n        for (let bodyId in ss.objects) {\r\n            let obj = ss.objects[bodyId];\r\n            if (!(obj instanceof Body))\r\n                continue;\r\n\r\n            let parent = ss.getObject(obj.data.patchedConics.parentSoiId);\r\n\r\n            if (!(parent instanceof Body))\r\n                continue;\r\n\r\n            obj.data.patchedConics.parentSoi = parent;\r\n            parent.data.patchedConics.childSois.push(obj);\r\n        }\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/modules/PatchedConics/ModulePatchedConics.js"],"sourceRoot":""}