{"version":3,"sources":["../static/js/1.87aac5a8.chunk.js","core/Module.js","core/Propagator/Abstract.js","modules/PatchedConics/PropagatorPatchedConics.js","modules/PatchedConics/ModulePatchedConics.js"],"names":["webpackJsonp","193","module","__webpack_exports__","__webpack_require__","_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","Module","this","_classes","value","alias","className","undefined","Error","194","PropagatorAbstract","trajectory","epochFrom","stopCondition","52","_possibleConstructorReturn","self","call","ReferenceError","_inherits","subClass","superClass","create","constructor","setPrototypeOf","__proto__","__WEBPACK_IMPORTED_MODULE_0__core_Propagator_Abstract__","__WEBPACK_IMPORTED_MODULE_1__core_Trajectory_Composite__","__WEBPACK_IMPORTED_MODULE_2__core_ReferenceFrame_Factory__","__WEBPACK_IMPORTED_MODULE_3__core_Trajectory_KeplerianBasic__","__WEBPACK_IMPORTED_MODULE_4__core_KeplerianObject__","__WEBPACK_IMPORTED_MODULE_5__core_visual_TrajectoryModel_Keplerian__","__WEBPACK_IMPORTED_MODULE_6__core_algebra__","__WEBPACK_IMPORTED_MODULE_7__core_Simulation__","PropagatorPatchedConics","_PropagatorAbstract","_this","getPrototypeOf","soiSafetyCoefficient","maxStep","minStepCount","maxPatchError","epoch","clearAfterEpoch","lastComponent","getComponentByEpoch","Math","max","nextComponent","maxEpoch","_findNextTrajectory","addComponent","epochTo","soi","starSystem","getObject","referenceFrame","originId","ownSoiCrossing","_findOwnSoiCrossing","childSoiCrossing","_findChildSoiCrossing","nextSoiCrossing","_createExtensionTrajectory","newSoi","parent","ko","keplerianObject","sphereCrossing","getSphereCrossingTrueAnomaly","data","patchedConics","soiRadius","getEpochByTrueAnomaly","period","parentSoi","crossings","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_step","_iterator","childSois","Symbol","iterator","next","done","childKo","getKeplerianObjectByEpoch","intervals1","_getPotentialApproachIntervals","intervals2","potentialApproachIntervals","sort","i1","i2","crossingFound","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","interval","isFirstStep","step","min","t","prevDistance","distance","getPositionByEpoch","sub_","mag","abs","push","err","return","closestCrossing","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","crossing","keplerianObjectBase","keplerianObjectActive","radialTa","_getRadialTaBounds","verticalTa","_getVerticalTaBounds","taIntervals","inEpoch","outEpoch","adding","isElliptic","floor","maxProcessedEpoch","epochIntervals","_iteratorNormalCompletion4","_didIteratorError4","_iteratorError4","_step4","_iterator4","taInterval","baseNormal","getNormalVector","activeNormal","equinoxVector","getPeriapsisVector","raanVector","cross","periapsisVector","inc","angle","raan","PI","aop","ecc","sma","m0","mu","getPlaneCrossingTrueAnomaly","r1","getPeriapsisRadius","r2","getApoapsisRadius","radialTa1","radialTa2","isHyperbolic","Infinity","originalTrajectory","newSoiBody","newReferenceFrame","getReferenceFrame","buildId","id","INERTIAL_ECLIPTIC","newSoiState","stateVectorFromBaseReferenceFrameByEpoch","getStateByEpoch","traj","createFromState","physicalModel","minEpoch","isEditable","setVisualModel","color","visualModel","standardColor","60","__WEBPACK_IMPORTED_MODULE_0__core_Module__","__WEBPACK_IMPORTED_MODULE_1__core_Events__","__WEBPACK_IMPORTED_MODULE_2__core_Body__","__WEBPACK_IMPORTED_MODULE_3__PropagatorPatchedConics__","__WEBPACK_IMPORTED_MODULE_4__core_Simulation__","ModulePatchedConics","_Module","apply","arguments","addPropagator","addListener","STAR_SYSTEM_LOADED","fillSoiTree","ss","bodyId","objects","obj","parentSoiId"],"mappings":"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","file":"static/js/1.87aac5a8.chunk.js","sourcesContent":["webpackJsonp([1,2],{\n\n/***/ 193:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nvar _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\");}}var Module=function(){function Module(){_classCallCheck(this,Module);this._classes={};}_createClass(Module,[{key:'_addClass',value:function _addClass(alias,className){this._classes[alias]=className;}},{key:'getClass',value:function getClass(alias){if(this._classes[alias]===undefined){throw new Error('Unknown module class: '+alias);}return this._classes[alias];}},{key:'init',value:function init(){}}]);return Module;}();/* harmony default export */ __webpack_exports__[\"a\"] = (Module);\n\n/***/ }),\n\n/***/ 194:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nvar _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\");}}var PropagatorAbstract=function(){function PropagatorAbstract(){_classCallCheck(this,PropagatorAbstract);}_createClass(PropagatorAbstract,[{key:\"propagate\",value:function propagate(trajectory,epochFrom,stopCondition){}}]);return PropagatorAbstract;}();/* harmony default export */ __webpack_exports__[\"a\"] = (PropagatorAbstract);\n\n/***/ }),\n\n/***/ 52:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__core_Propagator_Abstract__ = __webpack_require__(194);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__core_Trajectory_Composite__ = __webpack_require__(25);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__core_ReferenceFrame_Factory__ = __webpack_require__(3);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__core_Trajectory_KeplerianBasic__ = __webpack_require__(19);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__core_KeplerianObject__ = __webpack_require__(13);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__core_visual_TrajectoryModel_Keplerian__ = __webpack_require__(26);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__core_algebra__ = __webpack_require__(2);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__core_Simulation__ = __webpack_require__(1);\nvar _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");}return call&&(typeof call===\"object\"||typeof call===\"function\")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!==\"function\"&&superClass!==null){throw new TypeError(\"Super expression must either be null or a function, not \"+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}// import VisualPoint from \"../../visual/Point\";\n// import Constant from \"../../core/FunctionOfEpoch/Constant\";\nvar PropagatorPatchedConics=function(_PropagatorAbstract){_inherits(PropagatorPatchedConics,_PropagatorAbstract);function PropagatorPatchedConics(){_classCallCheck(this,PropagatorPatchedConics);var _this=_possibleConstructorReturn(this,(PropagatorPatchedConics.__proto__||Object.getPrototypeOf(PropagatorPatchedConics)).call(this));_this.soiSafetyCoefficient=1.5;_this.maxStep=3600;_this.minStepCount=100;_this.maxPatchError=1e-3;// 1 meter\n// this.debugPoints = [];\nreturn _this;}_createClass(PropagatorPatchedConics,[{key:\"propagate\",value:function propagate(trajectory,epochFrom,stopCondition){if(!trajectory instanceof __WEBPACK_IMPORTED_MODULE_1__core_Trajectory_Composite__[\"a\" /* default */]){throw new Error('Patched conics propagation requires TrajectoryComposite instance');}if(!stopCondition.epoch){throw new Error('Patched conics propagation requires epoch in stop condition');}trajectory.clearAfterEpoch(epochFrom);var lastComponent=trajectory.getComponentByEpoch(epochFrom);var epoch=Math.max(epochFrom,lastComponent.epoch);var nextComponent=void 0;lastComponent.maxEpoch=false;/*\r\n        for (let point of this.debugPoints) {\r\n            point.drop();\r\n        }\r\n        this.debugPoints = [];\r\n*/// console.log('Propagating...');\ndo{// console.log('Looking for next component...');\nnextComponent=this._findNextTrajectory(lastComponent,epoch,stopCondition.epoch);if(nextComponent){// console.log('Component found', nextComponent);\ntrajectory.addComponent(nextComponent);epoch=nextComponent.epoch;lastComponent.maxEpoch=epoch;lastComponent=nextComponent;}}while(nextComponent&&epoch<stopCondition.epoch);}},{key:\"_findNextTrajectory\",value:function _findNextTrajectory(trajectory,epochFrom,epochTo){var soi=__WEBPACK_IMPORTED_MODULE_7__core_Simulation__[\"a\" /* sim */].starSystem.getObject(trajectory.referenceFrame.originId);var ownSoiCrossing=this._findOwnSoiCrossing(soi,trajectory,epochFrom);var childSoiCrossing=this._findChildSoiCrossing(soi,trajectory,epochFrom,epochTo);if(childSoiCrossing===false&&ownSoiCrossing===false){return false;}var nextSoiCrossing=!childSoiCrossing||ownSoiCrossing&&ownSoiCrossing.epoch<childSoiCrossing.epoch?ownSoiCrossing:childSoiCrossing;return this._createExtensionTrajectory(trajectory,nextSoiCrossing.newSoi,nextSoiCrossing.epoch);}},{key:\"_findOwnSoiCrossing\",value:function _findOwnSoiCrossing(parent,trajectory,epochFrom){var ko=trajectory.keplerianObject;var sphereCrossing=ko.getSphereCrossingTrueAnomaly(parent.data.patchedConics.soiRadius);if(!sphereCrossing){return false;}var epoch=ko.getEpochByTrueAnomaly(sphereCrossing[0]);while(epoch<epochFrom){epoch+=ko.period;}return{epoch:epoch,newSoi:parent.data.patchedConics.parentSoi};}},{key:\"_findChildSoiCrossing\",value:function _findChildSoiCrossing(parent,trajectory,epochFrom,epochTo){var ko=trajectory.keplerianObject;var crossings=[];var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=parent.data.patchedConics.childSois[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var soi=_step.value;var childKo=soi.trajectory.getKeplerianObjectByEpoch(epochFrom,trajectory.referenceFrame);var soiRadius=soi.data.patchedConics.soiRadius;var intervals1=this._getPotentialApproachIntervals(childKo,ko,epochFrom,epochTo,soiRadius*this.soiSafetyCoefficient);if(intervals1===false){continue;}var intervals2=this._getPotentialApproachIntervals(ko,childKo,epochFrom,epochTo,soiRadius*this.soiSafetyCoefficient);/*\r\n            if (this.debugPoints.length === 0) {\r\n                if (intervals1 && intervals1 instanceof Array)\r\n                    for (let interval of intervals1) {\r\n                        this.debugPoints.push(new VisualPoint(new Constant(trajectory.getPositionByEpoch(interval[0], 39901000).add_(parent.getPositionByEpoch(sim.currentEpoch))), 'blue', 6));\r\n                        this.debugPoints.push(new VisualPoint(new Constant(trajectory.getPositionByEpoch(interval[1], 39901000).add_(parent.getPositionByEpoch(sim.currentEpoch))), 'blue', 10));\r\n                    }\r\n\r\n                if (intervals2 && intervals2 instanceof Array)\r\n                    for (let interval of intervals2) {\r\n                        this.debugPoints.push(new VisualPoint(new Constant(soi.trajectory.getPositionByEpoch(interval[0], 39901000).add_(parent.getPositionByEpoch(sim.currentEpoch))), 'yellow', 6));\r\n                        this.debugPoints.push(new VisualPoint(new Constant(soi.trajectory.getPositionByEpoch(interval[1], 39901000).add_(parent.getPositionByEpoch(sim.currentEpoch))), 'yellow', 10));\r\n                    }\r\n            }\r\n*/var potentialApproachIntervals=Object(__WEBPACK_IMPORTED_MODULE_6__core_algebra__[\"i\" /* getEpochIntervalsIntersection */])(intervals1,intervals2);if(potentialApproachIntervals===false){continue;}if(potentialApproachIntervals===true){// TODO optimize this case\npotentialApproachIntervals=[[epochFrom,epochTo]];}potentialApproachIntervals.sort(function(i1,i2){return i1[0]<i2[0]?-1:i1[0]>i2[0]?1:0;});var crossingFound=false;// console.log('Iterating...');\nvar _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=potentialApproachIntervals[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var interval=_step3.value;if(interval[0]>epochTo){break;}if(interval[1]<epochFrom){continue;}if(interval[0]<epochFrom){interval[0]=epochFrom;}if(interval[1]>epochTo){interval[1]=epochTo;}var isFirstStep=true;var step=Math.min(this.maxStep,(interval[1]-interval[0])/this.minStepCount);var t=interval[0];var prevDistance=0;// console.log('Iterating interval...', interval[1] - interval[0], step);\nwhile(t<interval[1]){var distance=trajectory.getPositionByEpoch(t).sub_(soi.getPositionByEpoch(t)).mag-soiRadius;// console.log('T Distance', t, distance);\nif(distance<0){// found a point in time when we are inside SOI\n// console.log('Found');\nif(isFirstStep){// console.log('Iterating forward');\ndo{t+=step;if(t>interval[1]){t=interval[1];}distance=trajectory.getPositionByEpoch(t).sub_(soi.getPositionByEpoch(t)).mag-soiRadius;}while(distance<0&&t<interval[1]);// console.log('Distance', distance);\nif(distance<0){break;}continue;}// console.log('Looking for boundary');\nwhile(Math.abs(distance)>this.maxPatchError){// looking for SOI crossing time now\nstep*=distance/(prevDistance-distance);t+=step;prevDistance=distance;distance=trajectory.getPositionByEpoch(t).sub_(soi.getPositionByEpoch(t)).mag-soiRadius;// console.log('T Step distance', t, step, distance);\n}// console.log('Boundary found', t);\ncrossings.push({epoch:t,newSoi:soi});crossingFound=true;break;}prevDistance=distance;isFirstStep=false;t+=step;}if(crossingFound){break;}// console.log('Crossing not found');\n}}catch(err){_didIteratorError3=true;_iteratorError3=err;}finally{try{if(!_iteratorNormalCompletion3&&_iterator3.return){_iterator3.return();}}finally{if(_didIteratorError3){throw _iteratorError3;}}}}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator.return){_iterator.return();}}finally{if(_didIteratorError){throw _iteratorError;}}}if(!crossings.length){return false;}var closestCrossing=crossings[0];var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=crossings[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var crossing=_step2.value;if(crossing.epoch<closestCrossing.epoch){closestCrossing=crossing;}}}catch(err){_didIteratorError2=true;_iteratorError2=err;}finally{try{if(!_iteratorNormalCompletion2&&_iterator2.return){_iterator2.return();}}finally{if(_didIteratorError2){throw _iteratorError2;}}}return closestCrossing;}},{key:\"_getPotentialApproachIntervals\",value:function _getPotentialApproachIntervals(keplerianObjectBase,keplerianObjectActive,epochFrom,epochTo,distance){var radialTa=this._getRadialTaBounds(keplerianObjectBase,keplerianObjectActive,distance);if(radialTa===false){return false;}var verticalTa=this._getVerticalTaBounds(keplerianObjectBase,keplerianObjectActive,epochFrom,distance);var taIntervals=void 0;if(verticalTa){taIntervals=Object(__WEBPACK_IMPORTED_MODULE_6__core_algebra__[\"h\" /* getAngleIntervalsIntersection */])(verticalTa,radialTa);}else{if(radialTa===true){return true;}else{taIntervals=radialTa;}}if(taIntervals===false){return false;}var period=keplerianObjectActive.period;var inEpoch=void 0,outEpoch=void 0;var adding=keplerianObjectActive.isElliptic?Math.floor((epochFrom-keplerianObjectActive.epoch)/period)*period:0;var maxProcessedEpoch=0;var epochIntervals=[];do{var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=taIntervals[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var taInterval=_step4.value;inEpoch=keplerianObjectActive.getEpochByTrueAnomaly(taInterval[0])+adding;outEpoch=keplerianObjectActive.getEpochByTrueAnomaly(taInterval[1])+adding;if(outEpoch<inEpoch){inEpoch-=period;}if(outEpoch>maxProcessedEpoch){maxProcessedEpoch=outEpoch;}if(outEpoch<epochFrom){continue;}if(epochIntervals.length>10000){debugger;throw new Error('Infinite loop detected');}epochIntervals.push([inEpoch,outEpoch]);}}catch(err){_didIteratorError4=true;_iteratorError4=err;}finally{try{if(!_iteratorNormalCompletion4&&_iterator4.return){_iterator4.return();}}finally{if(_didIteratorError4){throw _iteratorError4;}}}adding+=period;}while(maxProcessedEpoch<epochTo&&keplerianObjectActive.isElliptic);return epochIntervals;}},{key:\"_getVerticalTaBounds\",value:function _getVerticalTaBounds(keplerianObjectBase,keplerianObjectActive,epochFrom,distance){// this is only to recalculate inc, raan and aop. probably can be optimized.\nvar baseNormal=keplerianObjectBase.getNormalVector();var activeNormal=keplerianObjectActive.getNormalVector();var equinoxVector=keplerianObjectBase.getPeriapsisVector();var raanVector=baseNormal.cross(activeNormal);var periapsisVector=keplerianObjectActive.getPeriapsisVector();var inc=baseNormal.angle(activeNormal);var raan=raanVector.angle(equinoxVector);if(equinoxVector.cross(raanVector).angle(baseNormal)>Math.PI/2){raan=__WEBPACK_IMPORTED_MODULE_6__core_algebra__[\"b\" /* TWO_PI */]-raan;}var aop=raanVector.angle(periapsisVector);if(raanVector.cross(periapsisVector).angle(activeNormal)>Math.PI/2){aop=__WEBPACK_IMPORTED_MODULE_6__core_algebra__[\"b\" /* TWO_PI */]-aop;}var relKeplerianObject=new __WEBPACK_IMPORTED_MODULE_4__core_KeplerianObject__[\"a\" /* default */](keplerianObjectActive.ecc,keplerianObjectActive.sma,aop,inc,raan,keplerianObjectActive.m0,keplerianObjectActive.epoch,keplerianObjectActive.mu,false);return relKeplerianObject.getPlaneCrossingTrueAnomaly(distance);}},{key:\"_getRadialTaBounds\",value:function _getRadialTaBounds(keplerianObjectBase,keplerianObjectActive,distance){var r1=keplerianObjectBase.getPeriapsisRadius()-distance;var r2=keplerianObjectBase.getApoapsisRadius()+distance;var radialTa1=keplerianObjectActive.getSphereCrossingTrueAnomaly(r1);var radialTa2=keplerianObjectActive.getSphereCrossingTrueAnomaly(r2);if(keplerianObjectBase.isHyperbolic){if(keplerianObjectActive.isHyperbolic){return radialTa1?[[-Infinity,radialTa1[1]-__WEBPACK_IMPORTED_MODULE_6__core_algebra__[\"b\" /* TWO_PI */]],[radialTa1[0],Infinity]]:true;}else{return radialTa1?[radialTa1]:keplerianObjectActive.getApoapsisRadius()>=r1;}}// keplerianObjectBase is elliptic\nif(keplerianObjectActive.isHyperbolic){if(!radialTa2){return false;}else if(!radialTa1){return[[radialTa2[1]-__WEBPACK_IMPORTED_MODULE_6__core_algebra__[\"b\" /* TWO_PI */],radialTa2[0]]];}return[[radialTa2[1]-__WEBPACK_IMPORTED_MODULE_6__core_algebra__[\"b\" /* TWO_PI */],radialTa1[1]-__WEBPACK_IMPORTED_MODULE_6__core_algebra__[\"b\" /* TWO_PI */]],[radialTa1[0],radialTa2[0]]];}// keplerianObjectActive is elliptic\nif(radialTa1){return radialTa2?[[radialTa1[0],radialTa2[0]],[radialTa2[1],radialTa1[1]]]:[radialTa1];}else if(radialTa2){return[[radialTa2[1],radialTa2[0]]];}return keplerianObjectActive.getPeriapsisRadius()<r2&&keplerianObjectActive.getApoapsisRadius()>r1;}},{key:\"_createExtensionTrajectory\",value:function _createExtensionTrajectory(originalTrajectory,newSoiBody,epoch){var newReferenceFrame=__WEBPACK_IMPORTED_MODULE_7__core_Simulation__[\"a\" /* sim */].starSystem.getReferenceFrame(__WEBPACK_IMPORTED_MODULE_2__core_ReferenceFrame_Factory__[\"d\" /* default */].buildId(newSoiBody.id,__WEBPACK_IMPORTED_MODULE_2__core_ReferenceFrame_Factory__[\"c\" /* ReferenceFrame */].INERTIAL_ECLIPTIC));var newSoiState=newReferenceFrame.stateVectorFromBaseReferenceFrameByEpoch(epoch,originalTrajectory.getStateByEpoch(epoch));var traj=new __WEBPACK_IMPORTED_MODULE_3__core_Trajectory_KeplerianBasic__[\"a\" /* default */](newReferenceFrame.id,__WEBPACK_IMPORTED_MODULE_4__core_KeplerianObject__[\"a\" /* default */].createFromState(newSoiState,newSoiBody.physicalModel.mu,epoch));traj.minEpoch=epoch;traj.maxEpoch=false;traj.isEditable=false;// TODO refactor this\ntraj.setVisualModel(new __WEBPACK_IMPORTED_MODULE_5__core_visual_TrajectoryModel_Keplerian__[\"a\" /* default */](traj,{color:originalTrajectory.visualModel.standardColor,minEpoch:null,maxEpoch:null}));return traj;}}]);return PropagatorPatchedConics;}(__WEBPACK_IMPORTED_MODULE_0__core_Propagator_Abstract__[\"a\" /* default */]);/* harmony default export */ __webpack_exports__[\"default\"] = (PropagatorPatchedConics);\n\n/***/ }),\n\n/***/ 60:\n/***/ (function(module, __webpack_exports__, __webpack_require__) {\n\n\"use strict\";\nObject.defineProperty(__webpack_exports__, \"__esModule\", { value: true });\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__core_Module__ = __webpack_require__(193);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__core_Events__ = __webpack_require__(6);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__core_Body__ = __webpack_require__(20);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__PropagatorPatchedConics__ = __webpack_require__(52);\n/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__core_Simulation__ = __webpack_require__(1);\nvar _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");}return call&&(typeof call===\"object\"||typeof call===\"function\")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!==\"function\"&&superClass!==null){throw new TypeError(\"Super expression must either be null or a function, not \"+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}var ModulePatchedConics=function(_Module){_inherits(ModulePatchedConics,_Module);function ModulePatchedConics(){_classCallCheck(this,ModulePatchedConics);return _possibleConstructorReturn(this,(ModulePatchedConics.__proto__||Object.getPrototypeOf(ModulePatchedConics)).apply(this,arguments));}_createClass(ModulePatchedConics,[{key:\"init\",value:function init(){__WEBPACK_IMPORTED_MODULE_4__core_Simulation__[\"a\" /* sim */].addPropagator('patchedConics',__WEBPACK_IMPORTED_MODULE_3__PropagatorPatchedConics__[\"default\"]);__WEBPACK_IMPORTED_MODULE_1__core_Events__[\"a\" /* default */].addListener(__WEBPACK_IMPORTED_MODULE_1__core_Events__[\"a\" /* default */].STAR_SYSTEM_LOADED,this.fillSoiTree);if(__WEBPACK_IMPORTED_MODULE_4__core_Simulation__[\"a\" /* sim */].starSystem){this.fillSoiTree();}}},{key:\"fillSoiTree\",value:function fillSoiTree(){var ss=__WEBPACK_IMPORTED_MODULE_4__core_Simulation__[\"a\" /* sim */].starSystem;for(var bodyId in ss.objects){var obj=ss.objects[bodyId];if(!(obj instanceof __WEBPACK_IMPORTED_MODULE_2__core_Body__[\"a\" /* default */])||obj.data.patchedConics===undefined)continue;var parent=ss.getObject(obj.data.patchedConics.parentSoiId);if(!(parent instanceof __WEBPACK_IMPORTED_MODULE_2__core_Body__[\"a\" /* default */]))continue;obj.data.patchedConics.parentSoi=parent;parent.data.patchedConics.childSois.push(obj);}}}]);return ModulePatchedConics;}(__WEBPACK_IMPORTED_MODULE_0__core_Module__[\"a\" /* default */]);/* harmony default export */ __webpack_exports__[\"default\"] = (ModulePatchedConics);\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// static/js/1.87aac5a8.chunk.js","export default class Module\r\n{\r\n    constructor() {\r\n        this._classes = {};\r\n    }\r\n\r\n    _addClass(alias, className) {\r\n        this._classes[alias] = className;\r\n    }\r\n\r\n    getClass(alias) {\r\n        if (this._classes[alias] === undefined) {\r\n            throw new Error('Unknown module class: ' + alias);\r\n        }\r\n        return this._classes[alias];\r\n    }\r\n\r\n    init() {}\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/core/Module.js","export default class PropagatorAbstract\r\n{\r\n    propagate(trajectory, epochFrom, stopCondition) {}\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/core/Propagator/Abstract.js","import PropagatorAbstract from \"../../core/Propagator/Abstract\";\r\nimport TrajectoryComposite from \"../../core/Trajectory/Composite\";\r\nimport ReferenceFrameFactory, {ReferenceFrame} from \"../../core/ReferenceFrame/Factory\";\r\nimport TrajectoryKeplerianBasic from \"../../core/Trajectory/KeplerianBasic\";\r\nimport KeplerianObject from \"../../core/KeplerianObject\";\r\nimport VisualTrajectoryModelKeplerian from \"../../core/visual/TrajectoryModel/Keplerian\";\r\nimport {getAngleIntervalsIntersection, getEpochIntervalsIntersection, TWO_PI} from \"../../core/algebra\";\r\nimport { sim } from \"../../core/Simulation\";\r\n// import VisualPoint from \"../../visual/Point\";\r\n// import Constant from \"../../core/FunctionOfEpoch/Constant\";\r\n\r\nexport default class PropagatorPatchedConics extends PropagatorAbstract\r\n{\r\n    constructor() {\r\n        super();\r\n        this.soiSafetyCoefficient = 1.5;\r\n        this.maxStep = 3600;\r\n        this.minStepCount = 100;\r\n        this.maxPatchError = 1e-3; // 1 meter\r\n        // this.debugPoints = [];\r\n    }\r\n\r\n    propagate(trajectory, epochFrom, stopCondition) {\r\n        if (!trajectory instanceof TrajectoryComposite) {\r\n            throw new Error('Patched conics propagation requires TrajectoryComposite instance');\r\n        }\r\n        if (!stopCondition.epoch) {\r\n            throw new Error('Patched conics propagation requires epoch in stop condition');\r\n        }\r\n\r\n        trajectory.clearAfterEpoch(epochFrom);\r\n\r\n        let lastComponent = trajectory.getComponentByEpoch(epochFrom);\r\n        let epoch = Math.max(epochFrom, lastComponent.epoch);\r\n        let nextComponent;\r\n\r\n        lastComponent.maxEpoch = false;\r\n/*\r\n        for (let point of this.debugPoints) {\r\n            point.drop();\r\n        }\r\n        this.debugPoints = [];\r\n*/\r\n        // console.log('Propagating...');\r\n\r\n        do {\r\n            // console.log('Looking for next component...');\r\n            nextComponent = this._findNextTrajectory(lastComponent, epoch, stopCondition.epoch);\r\n            if (nextComponent) {\r\n                // console.log('Component found', nextComponent);\r\n                trajectory.addComponent(nextComponent);\r\n                epoch = nextComponent.epoch;\r\n                lastComponent.maxEpoch = epoch;\r\n                lastComponent = nextComponent;\r\n            }\r\n        } while (nextComponent && epoch < stopCondition.epoch);\r\n    }\r\n\r\n    _findNextTrajectory(trajectory, epochFrom, epochTo) {\r\n        const soi = sim.starSystem.getObject(trajectory.referenceFrame.originId);\r\n        const ownSoiCrossing   = this._findOwnSoiCrossing  (soi, trajectory, epochFrom);\r\n        const childSoiCrossing = this._findChildSoiCrossing(soi, trajectory, epochFrom, epochTo);\r\n\r\n        if (childSoiCrossing === false && ownSoiCrossing === false) {\r\n            return false;\r\n        }\r\n\r\n        let nextSoiCrossing = (!childSoiCrossing || (ownSoiCrossing && ownSoiCrossing.epoch < childSoiCrossing.epoch))\r\n            ? ownSoiCrossing\r\n            : childSoiCrossing;\r\n\r\n        return this._createExtensionTrajectory(trajectory, nextSoiCrossing.newSoi, nextSoiCrossing.epoch);\r\n    }\r\n\r\n    _findOwnSoiCrossing(parent, trajectory, epochFrom) {\r\n        const ko = trajectory.keplerianObject;\r\n        const sphereCrossing = ko.getSphereCrossingTrueAnomaly(parent.data.patchedConics.soiRadius);\r\n\r\n        if (!sphereCrossing) {\r\n            return false;\r\n        }\r\n\r\n        let epoch = ko.getEpochByTrueAnomaly(sphereCrossing[0]);\r\n        while (epoch < epochFrom) {\r\n            epoch += ko.period;\r\n        }\r\n\r\n        return {\r\n            epoch: epoch,\r\n            newSoi: parent.data.patchedConics.parentSoi\r\n        };\r\n    }\r\n\r\n    _findChildSoiCrossing(parent, trajectory, epochFrom, epochTo) {\r\n        const ko = trajectory.keplerianObject;\r\n        let crossings = [];\r\n\r\n        for (let soi of parent.data.patchedConics.childSois) {\r\n            const childKo = soi.trajectory.getKeplerianObjectByEpoch(epochFrom, trajectory.referenceFrame);\r\n            const soiRadius = soi.data.patchedConics.soiRadius;\r\n            const intervals1 = this._getPotentialApproachIntervals(childKo, ko, epochFrom, epochTo, soiRadius * this.soiSafetyCoefficient);\r\n            if (intervals1 === false) {\r\n                continue;\r\n            }\r\n\r\n            const intervals2 = this._getPotentialApproachIntervals(ko, childKo, epochFrom, epochTo, soiRadius * this.soiSafetyCoefficient);\r\n/*\r\n            if (this.debugPoints.length === 0) {\r\n                if (intervals1 && intervals1 instanceof Array)\r\n                    for (let interval of intervals1) {\r\n                        this.debugPoints.push(new VisualPoint(new Constant(trajectory.getPositionByEpoch(interval[0], 39901000).add_(parent.getPositionByEpoch(sim.currentEpoch))), 'blue', 6));\r\n                        this.debugPoints.push(new VisualPoint(new Constant(trajectory.getPositionByEpoch(interval[1], 39901000).add_(parent.getPositionByEpoch(sim.currentEpoch))), 'blue', 10));\r\n                    }\r\n\r\n                if (intervals2 && intervals2 instanceof Array)\r\n                    for (let interval of intervals2) {\r\n                        this.debugPoints.push(new VisualPoint(new Constant(soi.trajectory.getPositionByEpoch(interval[0], 39901000).add_(parent.getPositionByEpoch(sim.currentEpoch))), 'yellow', 6));\r\n                        this.debugPoints.push(new VisualPoint(new Constant(soi.trajectory.getPositionByEpoch(interval[1], 39901000).add_(parent.getPositionByEpoch(sim.currentEpoch))), 'yellow', 10));\r\n                    }\r\n            }\r\n*/\r\n            let potentialApproachIntervals = getEpochIntervalsIntersection(intervals1, intervals2);\r\n\r\n            if (potentialApproachIntervals === false) {\r\n                continue;\r\n            }\r\n            if (potentialApproachIntervals === true) {\r\n                // TODO optimize this case\r\n                potentialApproachIntervals = [[epochFrom, epochTo]];\r\n            }\r\n\r\n            potentialApproachIntervals.sort((i1, i2) => (i1[0] < i2[0]) ? -1 : (i1[0] > i2[0] ? 1 : 0));\r\n\r\n            let crossingFound = false;\r\n            // console.log('Iterating...');\r\n            for (let interval of potentialApproachIntervals) {\r\n                if (interval[0] > epochTo) {\r\n                    break;\r\n                }\r\n                if (interval[1] < epochFrom) {\r\n                    continue;\r\n                }\r\n                if (interval[0] < epochFrom) {\r\n                    interval[0] = epochFrom;\r\n                }\r\n                if (interval[1] > epochTo) {\r\n                    interval[1] = epochTo;\r\n                }\r\n                let isFirstStep = true;\r\n                let step = Math.min(this.maxStep, (interval[1] - interval[0]) / this.minStepCount);\r\n                let t = interval[0];\r\n                let prevDistance = 0;\r\n                // console.log('Iterating interval...', interval[1] - interval[0], step);\r\n                while (t < interval[1]) {\r\n                    let distance = trajectory.getPositionByEpoch(t).sub_(soi.getPositionByEpoch(t)).mag - soiRadius;\r\n                    // console.log('T Distance', t, distance);\r\n                    if (distance < 0) { // found a point in time when we are inside SOI\r\n                        // console.log('Found');\r\n                        if (isFirstStep) {\r\n                            // console.log('Iterating forward');\r\n                            do {\r\n                                t += step;\r\n                                if (t > interval[1]) {\r\n                                    t = interval[1];\r\n                                }\r\n                                distance = trajectory.getPositionByEpoch(t).sub_(soi.getPositionByEpoch(t)).mag - soiRadius;\r\n                            } while (distance < 0 && t < interval[1]);\r\n                            // console.log('Distance', distance);\r\n                            if (distance < 0) {\r\n                                break;\r\n                            }\r\n                            continue;\r\n                        }\r\n                        // console.log('Looking for boundary');\r\n                        while (Math.abs(distance) > this.maxPatchError) { // looking for SOI crossing time now\r\n                            step *= distance / (prevDistance - distance);\r\n                            t += step;\r\n                            prevDistance = distance;\r\n                            distance = trajectory.getPositionByEpoch(t).sub_(soi.getPositionByEpoch(t)).mag - soiRadius;\r\n                            // console.log('T Step distance', t, step, distance);\r\n                        }\r\n                        // console.log('Boundary found', t);\r\n                        crossings.push({\r\n                            epoch: t,\r\n                            newSoi: soi\r\n                        });\r\n                        crossingFound = true;\r\n                        break;\r\n                    }\r\n                    prevDistance = distance;\r\n                    isFirstStep = false;\r\n                    t += step;\r\n                }\r\n\r\n                if (crossingFound) {\r\n                    break;\r\n                }\r\n                // console.log('Crossing not found');\r\n            }\r\n        }\r\n\r\n        if (!crossings.length) {\r\n            return false;\r\n        }\r\n\r\n        let closestCrossing = crossings[0];\r\n        for (let crossing of crossings) {\r\n            if (crossing.epoch < closestCrossing.epoch) {\r\n                closestCrossing = crossing;\r\n            }\r\n        }\r\n\r\n        return closestCrossing;\r\n    }\r\n\r\n    _getPotentialApproachIntervals(keplerianObjectBase, keplerianObjectActive, epochFrom, epochTo, distance) {\r\n        const radialTa = this._getRadialTaBounds(keplerianObjectBase, keplerianObjectActive, distance);\r\n        if (radialTa === false) {\r\n            return false;\r\n        }\r\n\r\n        const verticalTa = this._getVerticalTaBounds(keplerianObjectBase, keplerianObjectActive, epochFrom, distance);\r\n        let taIntervals;\r\n\r\n        if (verticalTa) {\r\n            taIntervals = getAngleIntervalsIntersection(verticalTa, radialTa);\r\n        } else {\r\n            if (radialTa === true) {\r\n                return true;\r\n            } else {\r\n                taIntervals = radialTa;\r\n            }\r\n        }\r\n\r\n        if (taIntervals === false) {\r\n            return false;\r\n        }\r\n\r\n        const period = keplerianObjectActive.period;\r\n        let inEpoch, outEpoch;\r\n        let adding = keplerianObjectActive.isElliptic\r\n            ? Math.floor((epochFrom - keplerianObjectActive.epoch) / period) * period\r\n            : 0;\r\n        let maxProcessedEpoch = 0;\r\n        let epochIntervals = [];\r\n\r\n        do {\r\n            for (let taInterval of taIntervals) {\r\n                inEpoch = keplerianObjectActive.getEpochByTrueAnomaly(taInterval[0]) + adding;\r\n                outEpoch = keplerianObjectActive.getEpochByTrueAnomaly(taInterval[1]) + adding;\r\n\r\n                if (outEpoch < inEpoch) {\r\n                    inEpoch -= period;\r\n                }\r\n\r\n                if (outEpoch > maxProcessedEpoch) {\r\n                    maxProcessedEpoch = outEpoch;\r\n                }\r\n                if (outEpoch < epochFrom) {\r\n                    continue;\r\n                }\r\n\r\n                if (epochIntervals.length > 10000) {\r\n                    debugger;\r\n                    throw new Error('Infinite loop detected');\r\n                }\r\n\r\n                epochIntervals.push([inEpoch, outEpoch]);\r\n            }\r\n            adding += period;\r\n\r\n        } while (maxProcessedEpoch < epochTo && keplerianObjectActive.isElliptic);\r\n\r\n        return epochIntervals;\r\n    }\r\n\r\n    _getVerticalTaBounds(keplerianObjectBase, keplerianObjectActive, epochFrom, distance) {\r\n        // this is only to recalculate inc, raan and aop. probably can be optimized.\r\n        const baseNormal = keplerianObjectBase.getNormalVector();\r\n        const activeNormal = keplerianObjectActive.getNormalVector();\r\n        const equinoxVector = keplerianObjectBase.getPeriapsisVector();\r\n        const raanVector = baseNormal.cross(activeNormal);\r\n        const periapsisVector = keplerianObjectActive.getPeriapsisVector();\r\n\r\n        const inc = baseNormal.angle(activeNormal);\r\n        let raan = raanVector.angle(equinoxVector);\r\n        if (equinoxVector.cross(raanVector).angle(baseNormal) > Math.PI / 2) {\r\n            raan = TWO_PI - raan;\r\n        }\r\n        let aop = raanVector.angle(periapsisVector);\r\n        if (raanVector.cross(periapsisVector).angle(activeNormal) > Math.PI / 2) {\r\n            aop = TWO_PI - aop;\r\n        }\r\n\r\n        const relKeplerianObject = new KeplerianObject(\r\n            keplerianObjectActive.ecc,\r\n            keplerianObjectActive.sma,\r\n            aop,\r\n            inc,\r\n            raan,\r\n            keplerianObjectActive.m0,\r\n            keplerianObjectActive.epoch,\r\n            keplerianObjectActive.mu,\r\n            false\r\n        );\r\n\r\n        return relKeplerianObject.getPlaneCrossingTrueAnomaly(distance);\r\n    }\r\n\r\n    _getRadialTaBounds(keplerianObjectBase, keplerianObjectActive, distance) {\r\n        const r1 = keplerianObjectBase.getPeriapsisRadius() - distance;\r\n        const r2 = keplerianObjectBase.getApoapsisRadius()  + distance;\r\n        const radialTa1 = keplerianObjectActive.getSphereCrossingTrueAnomaly(r1);\r\n        const radialTa2 = keplerianObjectActive.getSphereCrossingTrueAnomaly(r2);\r\n\r\n        if (keplerianObjectBase.isHyperbolic) {\r\n            if (keplerianObjectActive.isHyperbolic) {\r\n                return radialTa1\r\n                    ? [[-Infinity, radialTa1[1] - TWO_PI],[radialTa1[0], Infinity]]\r\n                    : true;\r\n            } else {\r\n                return radialTa1\r\n                    ? [radialTa1]\r\n                    : (keplerianObjectActive.getApoapsisRadius() >= r1);\r\n            }\r\n        }\r\n        // keplerianObjectBase is elliptic\r\n\r\n        if (keplerianObjectActive.isHyperbolic) {\r\n            if (!radialTa2) {\r\n                return false;\r\n            } else if (!radialTa1) {\r\n                return [[radialTa2[1] - TWO_PI, radialTa2[0]]];\r\n            }\r\n            return [\r\n                [radialTa2[1] - TWO_PI, radialTa1[1] - TWO_PI],\r\n                [radialTa1[0], radialTa2[0]],\r\n            ];\r\n        }\r\n        // keplerianObjectActive is elliptic\r\n\r\n        if (radialTa1) {\r\n            return radialTa2\r\n                ? [[radialTa1[0], radialTa2[0]], [radialTa2[1], radialTa1[1]]]\r\n                : [radialTa1];\r\n        } else if (radialTa2) {\r\n            return [[radialTa2[1], radialTa2[0]]];\r\n        }\r\n        return keplerianObjectActive.getPeriapsisRadius() < r2\r\n            && keplerianObjectActive.getApoapsisRadius()  > r1;\r\n    }\r\n\r\n    _createExtensionTrajectory(originalTrajectory, newSoiBody, epoch) {\r\n        let newReferenceFrame = sim.starSystem.getReferenceFrame(ReferenceFrameFactory.buildId(newSoiBody.id, ReferenceFrame.INERTIAL_ECLIPTIC));\r\n        let newSoiState = newReferenceFrame.stateVectorFromBaseReferenceFrameByEpoch(\r\n            epoch,\r\n            originalTrajectory.getStateByEpoch(epoch)\r\n        );\r\n\r\n        let traj = new TrajectoryKeplerianBasic(\r\n            newReferenceFrame.id,\r\n            KeplerianObject.createFromState(\r\n                newSoiState,\r\n                newSoiBody.physicalModel.mu,\r\n                epoch\r\n            )\r\n        );\r\n        traj.minEpoch = epoch;\r\n        traj.maxEpoch = false;\r\n        traj.isEditable = false;\r\n\r\n        // TODO refactor this\r\n        traj.setVisualModel(new VisualTrajectoryModelKeplerian(\r\n            traj,\r\n            {color: originalTrajectory.visualModel.standardColor, minEpoch: null, maxEpoch: null}\r\n        ));\r\n\r\n        return traj;\r\n    }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/modules/PatchedConics/PropagatorPatchedConics.js","import Module from \"../../core/Module\";\r\nimport Events from \"../../core/Events\";\r\nimport Body from \"../../core/Body\";\r\nimport PropagatorPatchedConics from \"./PropagatorPatchedConics\";\r\nimport { sim } from \"../../core/Simulation\";\r\n\r\nexport default class ModulePatchedConics extends Module\r\n{\r\n    init() {\r\n        sim.addPropagator('patchedConics', PropagatorPatchedConics);\r\n        Events.addListener(Events.STAR_SYSTEM_LOADED, this.fillSoiTree);\r\n        if (sim.starSystem) {\r\n            this.fillSoiTree();\r\n        }\r\n    }\r\n\r\n    fillSoiTree() {\r\n        let ss = sim.starSystem;\r\n\r\n        for (let bodyId in ss.objects) {\r\n            let obj = ss.objects[bodyId];\r\n            if (!(obj instanceof Body) || obj.data.patchedConics === undefined)\r\n                continue;\r\n\r\n            let parent = ss.getObject(obj.data.patchedConics.parentSoiId);\r\n\r\n            if (!(parent instanceof Body))\r\n                continue;\r\n\r\n            obj.data.patchedConics.parentSoi = parent;\r\n            parent.data.patchedConics.childSois.push(obj);\r\n        }\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/modules/PatchedConics/ModulePatchedConics.js"],"sourceRoot":""}